






<!doctype html>
<html
  lang="en"
  dir="ltr"
  class="scroll-smooth"
  data-default-appearance="light"
  data-auto-appearance="false"
><head><script src="/livereload.js?mindelay=10&amp;v=2&amp;port=1313&amp;path=livereload" data-no-instant defer></script>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <meta name="theme-color" content="#FFFFFF" />
  
  <title>SL3: Analysis of Prostate Cancer dataset – variable subset selection &middot; Andrea Mortaro</title>
    <meta name="title" content="SL3: Analysis of Prostate Cancer dataset – variable subset selection &middot; Andrea Mortaro" />
  
  
  
  
  
  <script
    type="text/javascript"
    src="http://localhost:1313/js/appearance.min.8a082f81b27f3cb2ee528df0b0bdc39787034cf2cc34d4669fbc9977c929023c.js"
    integrity="sha256-iggvgbJ/PLLuUo3wsL3Dl4cDTPLMNNRmn7yZd8kpAjw="
  ></script>
  
  
  
  
  
  
  
  
  <link
    type="text/css"
    rel="stylesheet"
    href="http://localhost:1313/css/main.bundle.min.2abed97d6210907523664b7e6725ba691bc95b0ee54b6e46cff169dfba68ae29.css"
    integrity="sha256-Kr7ZfWIQkHUjZkt&#43;ZyW6aRvJWw7lS25Gz/Fp37porik="
  />
  
    
    
    
  
  
  
    
    
  
  
  
  
    
    <script
      defer
      type="text/javascript"
      id="script-bundle"
      src="http://localhost:1313/js/main.bundle.min.0b250a079f6c2f7d0e03d1f0aa1308acb88137e3caebe1268f7478f0c87c5bf8.js"
      integrity="sha256-CyUKB59sL30OA9HwqhMIrLiBN&#43;PK6&#43;Emj3R48Mh8W/g="
      data-copy="Copy"
      data-copied="Copied"
    ></script>
  
  
  <meta
    name="description"
    content="
      
        
      
    "
  />
  
  
  
  
    <link rel="canonical" href="http://localhost:1313/posts/some-exercise-about-statistical-learning/sl-ex3-subsetselection/" />
  
  
  
    <link rel="apple-touch-icon" sizes="180x180" href="/apple-touch-icon.png" />
    <link rel="icon" type="image/png" sizes="32x32" href="/favicon-32x32.png" />
    <link rel="icon" type="image/png" sizes="16x16" href="/favicon-16x16.png" />
    <link rel="manifest" href="/site.webmanifest" />
  
  
  
  
  
  
  
  
  <meta property="og:url" content="http://localhost:1313/posts/some-exercise-about-statistical-learning/sl-ex3-subsetselection/">
  <meta property="og:site_name" content="Andrea Mortaro">
  <meta property="og:title" content="SL3: Analysis of Prostate Cancer dataset – variable subset selection">
  <meta property="og:locale" content="en">
  <meta property="og:type" content="article">
    <meta property="article:section" content="posts">

  
  <meta name="twitter:card" content="summary">
  <meta name="twitter:title" content="SL3: Analysis of Prostate Cancer dataset – variable subset selection">

  
  <script type="application/ld+json">
  {
    "@context": "https://schema.org",
    "@type": "Article",
    "articleSection": "Posts",
    "name": "SL3: Analysis of Prostate Cancer dataset – variable subset selection",
    "headline": "SL3: Analysis of Prostate Cancer dataset – variable subset selection",
    
    
    "inLanguage": "en",
    "url" : "http:\/\/localhost:1313\/posts\/some-exercise-about-statistical-learning\/sl-ex3-subsetselection\/",
    "author" : {
      "@type": "Person",
      "name": "Andrea Mortaro"
    },
    
    
    
    
    
    
    
    
    "mainEntityOfPage": "true",
    "wordCount": "6350"
  }
  </script>
    
    
    <script type="application/ld+json">
    {
   "@context": "https://schema.org",
   "@type": "BreadcrumbList",
   "itemListElement": [
     {
       "@type": "ListItem",
       "item": "http://localhost:1313/",
       "name": "Welcome to Congo! Tada",
       "position": 1
     },
     {
       "@type": "ListItem",
       "item": "http://localhost:1313/posts/",
       "name": "Posts",
       "position": 2
     },
     {
       "@type": "ListItem",
       "item": "http://localhost:1313/posts/some-exercise-about-statistical-learning/",
       "name": "Some Exercise About Statistical Learning",
       "position": 3
     },
     {
       "@type": "ListItem",
       "name": "Sl3 Analysis of Prostate Cancer Dataset – Variable Subset Selection",
       "position": 4
     }
   ]
 }
  </script>

  
  
    <meta name="author" content="Andrea Mortaro" />
  
  
    
      <link href="mailto:andrea@mortaro.it" rel="me" />
    
      <link href="https://github.com/andreamortaro" rel="me" />
    
      <link href="https://www.linkedin.com/in/andreamortaro" rel="me" />
    
      <link href="https://mastodon.uno/@andreamortaro" rel="me" />
    
      <link href="https://signal.me/#eu/IrnprJ7u2RFv_tShcdEMMhWzgI3du5GjOncVUlSIAFOp1Sd6LNdK7I6SUbWVfcm4" rel="me" />
    
  
  
  






  
  
  <link
    type="text/css"
    rel="stylesheet"
    href="http://localhost:1313/lib/katex/katex.min.19095127357ed6d29fe0a63a6b000c913a89f7f1963b765dd3715e97c9852e75.css"
    integrity="sha256-GQlRJzV&#43;1tKf4KY6awAMkTqJ9/GWO3Zd03Fel8mFLnU="
  />
  
  
  <script defer src="http://localhost:1313/lib/katex/katex.min.e8d885505949f3a5f4abdd5dd0d53696bd1371ad26ffbf4f310dcd77c8cdae89.js" integrity="sha256-6NiFUFlJ86X0q91d0NU2lr0Tca0m/79PMQ3Nd8jNrok="></script>
  
  
  <script
    defer
    src="http://localhost:1313/lib/katex/auto-render.min.bb53eb953394531aae36fdd537065c4244eb8542901a3ce914601d932675b8ac.js"
    integrity="sha256-u1PrlTOUUxquNv3VNwZcQkTrhUKQGjzpFGAdkyZ1uKw="
    onload="renderMathInElement(document.body);"
  ></script>
  
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  


  
  

  
  
</head>
<body
    class="m-auto flex h-screen max-w-7xl flex-col bg-neutral px-6 text-lg leading-7 text-neutral-900 dark:bg-neutral-800 dark:text-neutral sm:px-14 md:px-24 lg:px-32"
  >
    <div id="the-top" class="absolute flex self-center">
      <a
        class="-translate-y-8 rounded-b-lg bg-primary-200 px-3 py-1 text-sm focus:translate-y-0 dark:bg-neutral-600"
        href="#main-content"
        ><span class="pe-2 font-bold text-primary-600 dark:text-primary-400">&darr;</span
        >Skip to main content</a
      >
    </div>
    
    
      <header class="py-6 font-semibold text-neutral-900 dark:text-neutral sm:py-10 print:hidden">
  <nav class="flex items-start justify-between sm:items-center">
    
    <div class="flex flex-row items-center">
      
  <a
    class="decoration-primary-500 hover:underline hover:decoration-2 hover:underline-offset-2"
    rel="me"
    href="/"
    >Andrea Mortaro</a
  >

    </div>
    
    
      <ul class="flex list-none flex-col text-end sm:flex-row">
        
          
            
            <li class="group mb-1 sm:mb-0 sm:me-7 sm:last:me-0.5">
              
                <a
                  href="/about/"
                  title="About"
                  
                  ><span
                      class="decoration-primary-500 group-hover:underline group-hover:decoration-2 group-hover:underline-offset-2"
                      >About</span
                    >
                  </a
                >
              
            </li>
          
            
            <li class="group mb-1 sm:mb-0 sm:me-7 sm:last:me-0.5">
              
                <a
                  href="/posts/"
                  title="Posts"
                  
                  ><span
                      class="decoration-primary-500 group-hover:underline group-hover:decoration-2 group-hover:underline-offset-2"
                      >Blog</span
                    >
                  </a
                >
              
            </li>
          
            
            <li class="group mb-1 sm:mb-0 sm:me-7 sm:last:me-0.5">
              
                <a
                  href="/tags/"
                  title="Tags"
                  
                  ><span
                      class="decoration-primary-500 group-hover:underline group-hover:decoration-2 group-hover:underline-offset-2"
                      >Tags</span
                    >
                  </a
                >
              
            </li>
          
            
            <li class="group mb-1 sm:mb-0 sm:me-7 sm:last:me-0.5">
              
                <a
                  href="https://github.com/andreamortaro"
                  title=""
                  target="_blank"
                  >
                    <span
                      class="group-dark:hover:text-primary-400 transition-colors group-hover:text-primary-600"
                    ><span class="icon relative inline-block px-1 align-text-bottom"><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 496 512"><path fill="currentColor" d="M165.9 397.4c0 2-2.3 3.6-5.2 3.6-3.3.3-5.6-1.3-5.6-3.6 0-2 2.3-3.6 5.2-3.6 3-.3 5.6 1.3 5.6 3.6zm-31.1-4.5c-.7 2 1.3 4.3 4.3 4.9 2.6 1 5.6 0 6.2-2s-1.3-4.3-4.3-5.2c-2.6-.7-5.5.3-6.2 2.3zm44.2-1.7c-2.9.7-4.9 2.6-4.6 4.9.3 2 2.9 3.3 5.9 2.6 2.9-.7 4.9-2.6 4.6-4.6-.3-1.9-3-3.2-5.9-2.9zM244.8 8C106.1 8 0 113.3 0 252c0 110.9 69.8 205.8 169.5 239.2 12.8 2.3 17.3-5.6 17.3-12.1 0-6.2-.3-40.4-.3-61.4 0 0-70 15-84.7-29.8 0 0-11.4-29.1-27.8-36.6 0 0-22.9-15.7 1.6-15.4 0 0 24.9 2 38.6 25.8 21.9 38.6 58.6 27.5 72.9 20.9 2.3-16 8.8-27.1 16-33.7-55.9-6.2-112.3-14.3-112.3-110.5 0-27.5 7.6-41.3 23.6-58.9-2.6-6.5-11.1-33.3 2.6-67.9 20.9-6.5 69 27 69 27 20-5.6 41.5-8.5 62.8-8.5s42.8 2.9 62.8 8.5c0 0 48.1-33.6 69-27 13.7 34.7 5.2 61.4 2.6 67.9 16 17.7 25.8 31.5 25.8 58.9 0 96.5-58.9 104.2-114.8 110.5 9.2 7.9 17 22.9 17 46.4 0 33.7-.3 75.4-.3 83.6 0 6.5 4.6 14.4 17.3 12.1C428.2 457.8 496 362.9 496 252 496 113.3 383.5 8 244.8 8zM97.2 352.9c-1.3 1-1 3.3.7 5.2 1.6 1.6 3.9 2.3 5.2 1 1.3-1 1-3.3-.7-5.2-1.6-1.6-3.9-2.3-5.2-1zm-10.8-8.1c-.7 1.3.3 2.9 2.3 3.9 1.6 1 3.6.7 4.3-.7.7-1.3-.3-2.9-2.3-3.9-2-.6-3.6-.3-4.3.7zm32.4 35.6c-1.6 1.3-1 4.3 1.3 6.2 2.3 2.3 5.2 2.6 6.5 1 1.3-1.3.7-4.3-1.3-6.2-2.2-2.3-5.2-2.6-6.5-1zm-11.4-14.7c-1.6 1-1.6 3.6 0 5.9 1.6 2.3 4.3 3.3 5.6 2.3 1.6-1.3 1.6-3.9 0-6.2-1.4-2.3-4-3.3-5.6-2z"/></svg>
</span></span></a
                >
              
            </li>
          
            
            <li class="group mb-1 sm:mb-0 sm:me-7 sm:last:me-0.5">
              
                
                
                  <button
                    id="search-button-1"
                    title="Search (/)"
                  >
                    
                      <span
                        class="group-dark:hover:text-primary-400 transition-colors group-hover:text-primary-600"
                      ><span class="icon relative inline-block px-1 align-text-bottom"><svg aria-hidden="true" focusable="false" data-prefix="fas" data-icon="search" class="svg-inline--fa fa-search fa-w-16" role="img" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 512 512"><path fill="currentColor" d="M505 442.7L405.3 343c-4.5-4.5-10.6-7-17-7H372c27.6-35.3 44-79.7 44-128C416 93.1 322.9 0 208 0S0 93.1 0 208s93.1 208 208 208c48.3 0 92.7-16.4 128-44v16.3c0 6.4 2.5 12.5 7 17l99.7 99.7c9.4 9.4 24.6 9.4 33.9 0l28.3-28.3c9.4-9.4 9.4-24.6.1-34zM208 336c-70.7 0-128-57.2-128-128 0-70.7 57.2-128 128-128 70.7 0 128 57.2 128 128 0 70.7-57.2 128-128 128z"/></svg>
</span></span><span
                        class="decoration-primary-500 group-hover:underline group-hover:decoration-2 group-hover:underline-offset-2"
                        ></span
                      >
                    
                  </button>
                
              
            </li>
          
          
        
      </ul>
    
  </nav>
</header>

    
    <div class="relative flex grow flex-col">
      <main id="main-content" class="grow">
        
  <article>
    <header class="max-w-prose">
      
        <ol class="text-sm text-neutral-500 dark:text-neutral-400 print:hidden">
  
  
    
  
    
  
    
  
  <li class="hidden inline">
    <a
      class="dark:underline-neutral-600 decoration-neutral-300 hover:underline"
      href="http://localhost:1313/"
      >Welcome to Congo! :tada:</a
    ><span class="px-1 text-primary-500">/</span>
  </li>

  
  <li class=" inline">
    <a
      class="dark:underline-neutral-600 decoration-neutral-300 hover:underline"
      href="http://localhost:1313/posts/"
      >Posts</a
    ><span class="px-1 text-primary-500">/</span>
  </li>

  
  <li class=" inline">
    <a
      class="dark:underline-neutral-600 decoration-neutral-300 hover:underline"
      href="http://localhost:1313/posts/some-exercise-about-statistical-learning/"
      >Some exercise about Statistical Learning</a
    ><span class="px-1 text-primary-500">/</span>
  </li>

  
  <li class="hidden inline">
    <a
      class="dark:underline-neutral-600 decoration-neutral-300 hover:underline"
      href="http://localhost:1313/posts/some-exercise-about-statistical-learning/sl-ex3-subsetselection/"
      >SL3: Analysis of Prostate Cancer dataset – variable subset selection</a
    ><span class="px-1 text-primary-500">/</span>
  </li>

</ol>


      
      <h1 class="mb-8 mt-0 text-4xl font-extrabold text-neutral-900 dark:text-neutral">
        SL3: Analysis of Prostate Cancer dataset – variable subset selection
      </h1>
      
        <div class="mb-10 text-base text-neutral-500 dark:text-neutral-400 print:hidden">
          





  
  



  

  
  

  

  

  
    
  

  


  <div class="flex flex-row flex-wrap items-center">
    
    
      <span title="Reading time">30 mins</span>
    

    
    
  </div>

  
  
    <div class="my-1 flex flex-wrap text-xs leading-relaxed text-neutral-500 dark:text-neutral-400">
      
        
      
        
      
    </div>
  


        </div>
      
      
    </header>
    <section class="prose mt-0 flex max-w-full flex-col dark:prose-invert lg:flex-row">
      
        <div class="order-first px-0 lg:order-last lg:max-w-xs lg:ps-8">
          <div class="toc pe-5 lg:sticky lg:top-10 print:hidden">
            <details open class="-ms-5 mt-0 overflow-hidden rounded-lg ps-5">
  <summary
    class="block cursor-pointer bg-neutral-100 py-1 ps-5 text-lg font-semibold text-neutral-800 dark:bg-neutral-700 dark:text-neutral-100 lg:hidden"
  >
    Table of Contents
  </summary>
  <div class="border-s border-dotted border-neutral-300 py-2 ps-5 dark:border-neutral-600">
    <nav id="TableOfContents">
  <ul>
    <li><a href="#data-acquisition"><strong>Data acquisition</strong></a></li>
    <li><a href="#data-pre-processing"><strong>Data pre-processing</strong></a></li>
    <li><a href="#useful-functions-for-the-analysis-of-the-prostate_"><strong>Useful functions for the analysis of the Prostate_Cancer_dataset</strong></a></li>
    <li><a href="#best-subset-selection"><strong>Best Subset Selection</strong></a>
      <ul>
        <li><a href="#plots-for-best-selection"><strong>Plots for Best Selection</strong></a></li>
        <li><a href="#estimating-test-error-by-adjusting-training-error"><strong>Estimating test error by adjusting training error</strong></a></li>
      </ul>
    </li>
    <li><a href="#forward-selection"><strong>Forward selection</strong></a>
      <ul>
        <li><a href="#plot-for-forward-selection"><strong>Plot for Forward Selection</strong></a></li>
      </ul>
    </li>
    <li><a href="#backward-selection"><strong>Backward selection</strong></a>
      <ul>
        <li><a href="#plot-for-backward-selection"><strong>Plot for Backward Selection</strong></a></li>
      </ul>
    </li>
    <li><a href="#comparison-subset-selection-methods"><strong>Comparison subset selection methods</strong></a></li>
    <li><a href="#backward-selection-with-z-score"><strong>Backward selection with Z-score</strong></a>
      <ul>
        <li><a href="#comparison-with-z-score"><strong>Comparison with Z-score</strong></a></li>
      </ul>
    </li>
  </ul>
</nav>
  </div>
</details>

          </div>
        </div>
      
      <div class="min-h-0 min-w-0 max-w-prose grow">
        

<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-python" data-lang="python"><span class="line"><span class="cl"><span class="c1"># data analysis and wrangling</span>
</span></span><span class="line"><span class="cl"><span class="kn">import</span> <span class="nn">numpy</span> <span class="k">as</span> <span class="nn">np</span> <span class="c1"># linear algebra</span>
</span></span><span class="line"><span class="cl"><span class="kn">import</span> <span class="nn">pandas</span> <span class="k">as</span> <span class="nn">pd</span> <span class="c1"># data processing, CSV file I/O (e.g. pd.read_csv)</span>
</span></span><span class="line"><span class="cl"><span class="c1"># import random as rnd</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="c1"># visualization</span>
</span></span><span class="line"><span class="cl"><span class="kn">import</span> <span class="nn">seaborn</span> <span class="k">as</span> <span class="nn">sns</span>
</span></span><span class="line"><span class="cl"><span class="kn">import</span> <span class="nn">matplotlib.pyplot</span> <span class="k">as</span> <span class="nn">plt</span>
</span></span><span class="line"><span class="cl"><span class="c1"># %matplotlib inline</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="c1"># machine learning</span>
</span></span><span class="line"><span class="cl"><span class="kn">from</span> <span class="nn">sklearn.linear_model</span> <span class="kn">import</span> <span class="n">LinearRegression</span>
</span></span><span class="line"><span class="cl"><span class="kn">from</span> <span class="nn">sklearn.metrics</span> <span class="kn">import</span> <span class="n">r2_score</span>
</span></span><span class="line"><span class="cl"><span class="kn">from</span> <span class="nn">sklearn.metrics</span> <span class="kn">import</span> <span class="n">mean_squared_error</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="kn">import</span> <span class="nn">statsmodels.api</span> <span class="k">as</span> <span class="nn">sm</span>
</span></span><span class="line"><span class="cl"><span class="kn">import</span> <span class="nn">itertools</span> <span class="c1"># itertools functions create iterators for efficient looping</span>
</span></span><span class="line"><span class="cl">                 <span class="c1"># itertools.combinations(p,r) creates r-length tuples, in sorted order, no repeated elements</span>
</span></span><span class="line"><span class="cl">                 <span class="c1"># ex. combinations(&#39;ABCD&#39;, 2) = [AB AC AD BC BD CD]</span>
</span></span><span class="line"><span class="cl">        
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="c1">#from IPython.display import Image # to visualize images</span>
</span></span><span class="line"><span class="cl"><span class="c1">#from tabulate import tabulate # to create tables</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="kn">import</span> <span class="nn">os</span>
</span></span><span class="line"><span class="cl"><span class="k">for</span> <span class="n">dirname</span><span class="p">,</span> <span class="n">_</span><span class="p">,</span> <span class="n">filenames</span> <span class="ow">in</span> <span class="n">os</span><span class="o">.</span><span class="n">walk</span><span class="p">(</span><span class="s1">&#39;/kaggle/input&#39;</span><span class="p">):</span>
</span></span><span class="line"><span class="cl">    <span class="k">for</span> <span class="n">filename</span> <span class="ow">in</span> <span class="n">filenames</span><span class="p">:</span>
</span></span><span class="line"><span class="cl">        <span class="nb">print</span><span class="p">(</span><span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">dirname</span><span class="p">,</span> <span class="n">filename</span><span class="p">))</span>
</span></span></code></pre></div><pre><code>/kaggle/input/prostate-data/tab4.png
/kaggle/input/prostate-data/tab4-no-cap.png
/kaggle/input/prostate-data/tab3.png
/kaggle/input/prostate-data/prostate.data
/kaggle/input/prostate-data/tab.png
/kaggle/input/prostate-data/tab2.png
</code></pre>
<h4>1. Open your kernel SL_EX2_ProstateCancer_Surname in Kaggle</h4>
<h4>2. Generate a copy called SL_EX3_SubsetSelection_Surname by the Fork button</h4>
<h2 id="data-acquisition" class="relative group"><strong>Data acquisition</strong> <span class="absolute top-0 w-6 transition-opacity opacity-0 -start-6 not-prose group-hover:opacity-100"><a class="group-hover:text-primary-300 dark:group-hover:text-neutral-700" style="text-decoration-line: none !important;" href="#data-acquisition" aria-label="Anchor">#</a></span></h2><div class="highlight"><pre tabindex="0" class="chroma"><code class="language-python" data-lang="python"><span class="line"><span class="cl"><span class="c1"># Load the Prostate Cancer dataset</span>
</span></span><span class="line"><span class="cl"><span class="n">data</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">read_csv</span><span class="p">(</span><span class="s1">&#39;../input/prostate-data/prostate.data&#39;</span><span class="p">,</span><span class="n">sep</span><span class="o">=</span><span class="s1">&#39;</span><span class="se">\t</span><span class="s1">&#39;</span><span class="p">)</span>
</span></span></code></pre></div><div class="highlight"><pre tabindex="0" class="chroma"><code class="language-python" data-lang="python"><span class="line"><span class="cl"><span class="c1"># Save &#34;train&#34; and lpsa&#34; columns into Pandas Series variables</span>
</span></span><span class="line"><span class="cl"><span class="n">train</span> <span class="o">=</span> <span class="n">data</span><span class="p">[</span><span class="s1">&#39;train&#39;</span><span class="p">]</span>
</span></span><span class="line"><span class="cl"><span class="n">lpsa</span> <span class="o">=</span> <span class="n">data</span><span class="p">[</span><span class="s1">&#39;lpsa&#39;</span><span class="p">]</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="c1"># Drop &#34;train&#34; and lpsa&#34; variable from data</span>
</span></span><span class="line"><span class="cl"><span class="n">data</span> <span class="o">=</span> <span class="n">data</span><span class="o">.</span><span class="n">drop</span><span class="p">(</span><span class="n">columns</span><span class="o">=</span><span class="p">[</span><span class="s1">&#39;Unnamed: 0&#39;</span><span class="p">,</span><span class="s1">&#39;lpsa&#39;</span><span class="p">,</span><span class="s1">&#39;train&#39;</span><span class="p">],</span><span class="n">axis</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>
</span></span></code></pre></div><h2 id="data-pre-processing" class="relative group"><strong>Data pre-processing</strong> <span class="absolute top-0 w-6 transition-opacity opacity-0 -start-6 not-prose group-hover:opacity-100"><a class="group-hover:text-primary-300 dark:group-hover:text-neutral-700" style="text-decoration-line: none !important;" href="#data-pre-processing" aria-label="Anchor">#</a></span></h2><div class="highlight"><pre tabindex="0" class="chroma"><code class="language-python" data-lang="python"><span class="line"><span class="cl"><span class="c1">## X VARIABLE:</span>
</span></span><span class="line"><span class="cl"><span class="c1"># Split the data in train and test sets</span>
</span></span><span class="line"><span class="cl"><span class="n">dataTrain</span> <span class="o">=</span> <span class="n">data</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="n">train</span> <span class="o">==</span> <span class="s1">&#39;T&#39;</span><span class="p">]</span> <span class="c1"># Obviously, len(idx)==len(dataTrain) is True!</span>
</span></span><span class="line"><span class="cl"><span class="n">dataTest</span> <span class="o">=</span> <span class="n">data</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="n">train</span> <span class="o">==</span> <span class="s1">&#39;F&#39;</span><span class="p">]</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="c1"># Rename these two variables as &#34;predictorsTrain&#34; and &#34;predictorsTest&#34;</span>
</span></span><span class="line"><span class="cl"><span class="n">predictorsTrain</span> <span class="o">=</span> <span class="n">dataTrain</span>
</span></span><span class="line"><span class="cl"><span class="n">predictorsTest</span> <span class="o">=</span> <span class="n">dataTest</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="c1">## Y VARIABLE:</span>
</span></span><span class="line"><span class="cl"><span class="c1"># Split the &#34;lpsa&#34; in train and test sets</span>
</span></span><span class="line"><span class="cl"><span class="n">lpsaTrain</span> <span class="o">=</span> <span class="n">lpsa</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="n">train</span> <span class="o">==</span> <span class="s1">&#39;T&#39;</span><span class="p">]</span>
</span></span><span class="line"><span class="cl"><span class="n">lpsaTest</span> <span class="o">=</span> <span class="n">lpsa</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="n">train</span> <span class="o">==</span> <span class="s1">&#39;F&#39;</span><span class="p">]</span>
</span></span></code></pre></div><h3>Standardization</h3> 
<p>\[\dfrac{predictors - predictorsMeans}{predictorsStd}\]</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-python" data-lang="python"><span class="line"><span class="cl"><span class="c1"># Standardize &#34;predictorsTrain&#34;</span>
</span></span><span class="line"><span class="cl"><span class="n">predictorsTrainMeans</span> <span class="o">=</span> <span class="n">predictorsTrain</span><span class="o">.</span><span class="n">mean</span><span class="p">()</span>
</span></span><span class="line"><span class="cl"><span class="n">predictorsTrainStds</span> <span class="o">=</span> <span class="n">predictorsTrain</span><span class="o">.</span><span class="n">std</span><span class="p">()</span>
</span></span><span class="line"><span class="cl"><span class="n">predictorsTrain_std</span> <span class="o">=</span> <span class="p">(</span><span class="n">predictorsTrain</span> <span class="o">-</span> <span class="n">predictorsTrainMeans</span><span class="p">)</span><span class="o">/</span><span class="n">predictorsTrainStds</span> <span class="c1"># standardized variables of predictorTrain</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="c1"># Standardize &#34;predictorsTest&#34; (using the mean and std of predictorsTrain, it&#39;s better!)</span>
</span></span><span class="line"><span class="cl"><span class="n">predictorsTest_std</span> <span class="o">=</span> <span class="p">(</span><span class="n">predictorsTest</span> <span class="o">-</span> <span class="n">predictorsTrainMeans</span><span class="p">)</span><span class="o">/</span><span class="n">predictorsTrainStds</span> <span class="c1"># standardized variables of predictorTest</span>
</span></span></code></pre></div><h3>Split into Training and Test sets</h3>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-python" data-lang="python"><span class="line"><span class="cl"><span class="c1">## TRAINING SET</span>
</span></span><span class="line"><span class="cl"><span class="n">X_train</span> <span class="o">=</span> <span class="n">predictorsTrain_std</span>
</span></span><span class="line"><span class="cl"><span class="n">Y_train</span> <span class="o">=</span> <span class="n">lpsaTrain</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="c1">## TEST SET</span>
</span></span><span class="line"><span class="cl"><span class="n">X_test</span> <span class="o">=</span> <span class="n">predictorsTest_std</span>
</span></span><span class="line"><span class="cl"><span class="n">Y_test</span> <span class="o">=</span> <span class="n">lpsaTest</span>
</span></span></code></pre></div><h2 id="useful-functions-for-the-analysis-of-the-prostate_" class="relative group"><strong>Useful functions for the analysis of the Prostate_Cancer_dataset</strong> <span class="absolute top-0 w-6 transition-opacity opacity-0 -start-6 not-prose group-hover:opacity-100"><a class="group-hover:text-primary-300 dark:group-hover:text-neutral-700" style="text-decoration-line: none !important;" href="#useful-functions-for-the-analysis-of-the-prostate_" aria-label="Anchor">#</a></span></h2><h3>For Linear Regression</h3>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-python" data-lang="python"><span class="line"><span class="cl"><span class="c1"># Useful functions in order to compute RSS, R_squared and Zscore.</span>
</span></span><span class="line"><span class="cl"><span class="k">def</span> <span class="nf">LinReg</span><span class="p">(</span><span class="n">X_train</span><span class="p">,</span><span class="n">Y_train</span><span class="p">,</span><span class="n">X_test</span><span class="p">,</span><span class="n">Y_test</span><span class="p">):</span>
</span></span><span class="line"><span class="cl">    
</span></span><span class="line"><span class="cl">    <span class="c1"># Create the linear model, fitting also the intecept (non-zero)</span>
</span></span><span class="line"><span class="cl">    <span class="n">model</span> <span class="o">=</span> <span class="n">LinearRegression</span><span class="p">(</span><span class="n">fit_intercept</span> <span class="o">=</span> <span class="kc">True</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">    
</span></span><span class="line"><span class="cl">    <span class="c1"># Train the model on training set</span>
</span></span><span class="line"><span class="cl">    <span class="n">model</span><span class="o">.</span><span class="n">fit</span><span class="p">(</span><span class="n">X_train</span><span class="p">,</span><span class="n">Y_train</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">    
</span></span><span class="line"><span class="cl">    <span class="c1"># Stats on Training set</span>
</span></span><span class="line"><span class="cl">    <span class="n">Y_train_pred</span> <span class="o">=</span> <span class="n">model</span><span class="o">.</span><span class="n">predict</span><span class="p">(</span><span class="n">X_train</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">    <span class="n">RSS_train</span> <span class="o">=</span> <span class="n">mean_squared_error</span><span class="p">(</span><span class="n">Y_train</span><span class="p">,</span><span class="n">Y_train_pred</span><span class="p">)</span> <span class="o">*</span> <span class="nb">len</span><span class="p">(</span><span class="n">Y_train</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">    <span class="n">R2_train</span> <span class="o">=</span> <span class="n">model</span><span class="o">.</span><span class="n">score</span><span class="p">(</span><span class="n">X_train</span><span class="p">,</span><span class="n">Y_train</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">    
</span></span><span class="line"><span class="cl">    <span class="c1"># Stats on Test set</span>
</span></span><span class="line"><span class="cl">    <span class="n">Y_test_pred</span> <span class="o">=</span> <span class="n">model</span><span class="o">.</span><span class="n">predict</span><span class="p">(</span><span class="n">X_test</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">    <span class="n">RSS_test</span> <span class="o">=</span> <span class="n">mean_squared_error</span><span class="p">(</span><span class="n">Y_test</span><span class="p">,</span><span class="n">Y_test_pred</span><span class="p">)</span> <span class="o">*</span> <span class="nb">len</span><span class="p">(</span><span class="n">Y_test</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">    <span class="n">R2_test</span> <span class="o">=</span> <span class="n">model</span><span class="o">.</span><span class="n">score</span><span class="p">(</span><span class="n">X_test</span><span class="p">,</span><span class="n">Y_test</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">    
</span></span><span class="line"><span class="cl">    <span class="k">return</span> <span class="n">RSS_train</span><span class="p">,</span> <span class="n">RSS_test</span><span class="p">,</span> <span class="n">R2_train</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="k">def</span> <span class="nf">Zscore</span><span class="p">(</span><span class="n">X_train</span><span class="p">,</span><span class="n">Y_train</span><span class="p">):</span>
</span></span><span class="line"><span class="cl">    
</span></span><span class="line"><span class="cl">    <span class="c1"># fitting the model</span>
</span></span><span class="line"><span class="cl">    <span class="n">model</span> <span class="o">=</span> <span class="n">sm</span><span class="o">.</span><span class="n">OLS</span><span class="p">(</span><span class="n">Y_train</span><span class="p">,</span> <span class="n">sm</span><span class="o">.</span><span class="n">add_constant</span><span class="p">(</span><span class="n">X_train</span><span class="p">))</span><span class="o">.</span><span class="n">fit</span><span class="p">()</span>
</span></span><span class="line"><span class="cl">    
</span></span><span class="line"><span class="cl">    <span class="n">Zscores</span> <span class="o">=</span> <span class="n">model</span><span class="o">.</span><span class="n">tvalues</span><span class="p">[</span><span class="mi">1</span><span class="p">:]</span> <span class="c1"># we don&#39;t want const</span>
</span></span><span class="line"><span class="cl">    <span class="n">min_Zscore</span> <span class="o">=</span> <span class="nb">min</span><span class="p">(</span><span class="nb">abs</span><span class="p">(</span><span class="n">Zscores</span><span class="p">))</span>
</span></span><span class="line"><span class="cl">    <span class="n">idx_min_Zscore</span> <span class="o">=</span> <span class="nb">abs</span><span class="p">(</span><span class="n">Zscores</span><span class="p">)</span><span class="o">.</span><span class="n">idxmin</span><span class="p">()</span> <span class="c1"># it&#39;s the nearest to zero, so the variable less significant!</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">    <span class="k">return</span> <span class="n">Zscores</span><span class="p">,</span> <span class="n">min_Zscore</span><span class="p">,</span> <span class="n">idx_min_Zscore</span>
</span></span></code></pre></div><h3>To print some info</h3>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-python" data-lang="python"><span class="line"><span class="cl"><span class="c1">## Print information about an iteration forward subset selection with subset size ncomb</span>
</span></span><span class="line"><span class="cl"><span class="c1"># ncomb = number of the iteration</span>
</span></span><span class="line"><span class="cl"><span class="c1"># features = remaining_features, selected_features (used to do the iteration and take track of the selection)</span>
</span></span><span class="line"><span class="cl"><span class="c1"># params = all_RSS, all_R_squared, all_combs</span>
</span></span><span class="line"><span class="cl"><span class="c1"># results = best_RSS, best_feature (results of the selection)</span>
</span></span><span class="line"><span class="cl"><span class="c1"># detailed = parameter to see more detail about each single combination</span>
</span></span><span class="line"><span class="cl"><span class="k">def</span> <span class="nf">get_info_forwardS</span><span class="p">(</span><span class="n">ncomb</span><span class="p">,</span><span class="n">features</span><span class="p">,</span><span class="n">params</span><span class="p">,</span><span class="n">results</span><span class="p">,</span><span class="n">detailed</span><span class="p">):</span>
</span></span><span class="line"><span class="cl">    
</span></span><span class="line"><span class="cl">    <span class="n">sepComb</span> <span class="o">=</span> <span class="s2">&#34;===&#34;</span><span class="o">*</span><span class="mi">30</span>
</span></span><span class="line"><span class="cl">    <span class="n">sepIter</span> <span class="o">=</span> <span class="s2">&#34;---&#34;</span><span class="o">*</span><span class="mi">30</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">    <span class="n">remaining</span><span class="p">,</span> <span class="n">selected</span> <span class="o">=</span> <span class="n">features</span>
</span></span><span class="line"><span class="cl">    <span class="n">bestFeat</span><span class="p">,</span> <span class="n">bestRSS</span> <span class="o">=</span> <span class="n">results</span>
</span></span><span class="line"><span class="cl">    
</span></span><span class="line"><span class="cl">    <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&#34;</span><span class="si">{</span><span class="n">sepComb</span><span class="si">}</span><span class="se">\n</span><span class="s2">Iter n.</span><span class="si">{</span><span class="n">ncomb</span><span class="si">}</span><span class="s2">:</span><span class="se">\n\
</span></span></span><span class="line"><span class="cl"><span class="se"></span><span class="s2">Choose </span><span class="si">{</span><span class="n">ncomb</span><span class="si">}</span><span class="s2">-length combinations of the remaining variables</span><span class="se">\n\n\
</span></span></span><span class="line"><span class="cl"><span class="se"></span><span class="s2">Remaining features: </span><span class="si">{</span><span class="n">remaining</span><span class="si">}</span><span class="se">\n\
</span></span></span><span class="line"><span class="cl"><span class="se"></span><span class="s2">Features selected: </span><span class="si">{</span><span class="n">selected</span><span class="si">}</span><span class="s2">&#34;</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">    <span class="k">if</span> <span class="n">detailed</span> <span class="o">==</span> <span class="mi">1</span><span class="p">:</span>
</span></span><span class="line"><span class="cl">        <span class="n">RSS</span><span class="p">,</span> <span class="n">R_squared</span><span class="p">,</span> <span class="n">Combs</span> <span class="o">=</span> <span class="n">params</span>
</span></span><span class="line"><span class="cl">        
</span></span><span class="line"><span class="cl">        <span class="k">for</span> <span class="n">niter</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span><span class="nb">len</span><span class="p">(</span><span class="n">Combs</span><span class="p">)):</span>
</span></span><span class="line"><span class="cl">            <span class="n">var0</span> <span class="o">=</span> <span class="n">Combs</span><span class="p">[</span><span class="n">niter</span><span class="p">]</span>
</span></span><span class="line"><span class="cl">            <span class="n">var1</span> <span class="o">=</span> <span class="n">RSS</span><span class="p">[</span><span class="n">niter</span><span class="p">]</span> 
</span></span><span class="line"><span class="cl">            <span class="n">var2</span> <span class="o">=</span> <span class="n">R_squared</span><span class="p">[</span><span class="n">niter</span><span class="p">]</span>
</span></span><span class="line"><span class="cl">            <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&#34;</span><span class="se">\n</span><span class="s2">Comb n.</span><span class="si">{</span><span class="n">niter</span><span class="o">+</span><span class="mi">1</span><span class="si">}</span><span class="s2">: </span><span class="si">{</span><span class="n">var0</span><span class="si">}</span><span class="se">\n\
</span></span></span><span class="line"><span class="cl"><span class="se"></span><span class="si">{</span><span class="n">sepIter</span><span class="si">}</span><span class="se">\n\
</span></span></span><span class="line"><span class="cl"><span class="se"></span><span class="s2">RSS test: </span><span class="si">{</span><span class="n">var1</span><span class="si">}</span><span class="se">\n\
</span></span></span><span class="line"><span class="cl"><span class="se"></span><span class="s2">R_squared: </span><span class="si">{</span><span class="n">var2</span><span class="si">}</span><span class="se">\
</span></span></span><span class="line"><span class="cl"><span class="se"></span><span class="s2">&#34;</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">        
</span></span><span class="line"><span class="cl">    <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&#34;</span><span class="se">\n</span><span class="s2">Selected variables: </span><span class="si">{</span><span class="n">bestFeat</span><span class="si">}</span><span class="se">\n\
</span></span></span><span class="line"><span class="cl"><span class="se"></span><span class="s2">min RSS: </span><span class="si">{</span><span class="n">bestRSS</span><span class="si">}</span><span class="se">\n\
</span></span></span><span class="line"><span class="cl"><span class="se"></span><span class="si">{</span><span class="n">sepComb</span><span class="si">}</span><span class="se">\n</span><span class="s2">&#34;</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">    <span class="k">return</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="c1">## Print information about an iteration backward subset selection with subset size ncomb</span>
</span></span><span class="line"><span class="cl"><span class="c1"># ncomb = number of the iteration</span>
</span></span><span class="line"><span class="cl"><span class="c1"># features = [remaining_features,dropped_features_list] (used to do the iteration and take track of the selection)</span>
</span></span><span class="line"><span class="cl"><span class="c1"># params = [all_RSS,all_R_squared,all_combs]</span>
</span></span><span class="line"><span class="cl"><span class="c1"># results = [best_RSS,dropped_feature]</span>
</span></span><span class="line"><span class="cl"><span class="c1"># detailed = parameter to see more detail about each single combination</span>
</span></span><span class="line"><span class="cl"><span class="k">def</span> <span class="nf">get_info_backwardS</span><span class="p">(</span><span class="n">ncomb</span><span class="p">,</span><span class="n">features</span><span class="p">,</span><span class="n">params</span><span class="p">,</span><span class="n">results</span><span class="p">,</span><span class="n">detailed</span><span class="p">):</span>
</span></span><span class="line"><span class="cl">    
</span></span><span class="line"><span class="cl">    <span class="n">sepComb</span> <span class="o">=</span> <span class="s2">&#34;===&#34;</span><span class="o">*</span><span class="mi">30</span>
</span></span><span class="line"><span class="cl">    <span class="n">sepIter</span> <span class="o">=</span> <span class="s2">&#34;---&#34;</span><span class="o">*</span><span class="mi">30</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">    <span class="n">remaining</span><span class="p">,</span> <span class="n">dropped</span> <span class="o">=</span> <span class="n">features</span>
</span></span><span class="line"><span class="cl">    <span class="n">droppedFeat</span><span class="p">,</span> <span class="n">bestRSS</span> <span class="o">=</span> <span class="n">results</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">    <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&#34;</span><span class="si">{</span><span class="n">sepComb</span><span class="si">}</span><span class="se">\n</span><span class="s2">Iter n.</span><span class="si">{</span><span class="mi">8</span> <span class="o">-</span> <span class="n">ncomb</span><span class="si">}</span><span class="s2">:</span><span class="se">\n\n\
</span></span></span><span class="line"><span class="cl"><span class="se"></span><span class="s2">At the beginning we have:</span><span class="se">\n\
</span></span></span><span class="line"><span class="cl"><span class="se"></span><span class="s2">Remaining features: </span><span class="si">{</span><span class="n">remaining</span><span class="si">}</span><span class="se">\n\
</span></span></span><span class="line"><span class="cl"><span class="se"></span><span class="s2">Dropped features: </span><span class="si">{</span><span class="n">dropped</span><span class="si">}</span><span class="se">\n\n\
</span></span></span><span class="line"><span class="cl"><span class="se"></span><span class="s2">Now we compare the model selecting </span><span class="si">{</span><span class="n">ncomb</span><span class="si">}</span><span class="s2"> variables&#34;</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">    <span class="k">if</span> <span class="n">detailed</span> <span class="o">==</span> <span class="mi">1</span><span class="p">:</span>
</span></span><span class="line"><span class="cl">        <span class="n">RSS</span><span class="p">,</span> <span class="n">R_squared</span><span class="p">,</span> <span class="n">Combs</span> <span class="o">=</span> <span class="n">params</span>
</span></span><span class="line"><span class="cl">        
</span></span><span class="line"><span class="cl">        <span class="k">for</span> <span class="n">niter</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span><span class="nb">len</span><span class="p">(</span><span class="n">Combs</span><span class="p">)):</span>
</span></span><span class="line"><span class="cl">            <span class="n">var0</span> <span class="o">=</span> <span class="n">Combs</span><span class="p">[</span><span class="n">niter</span><span class="p">]</span>
</span></span><span class="line"><span class="cl">            <span class="n">var1</span> <span class="o">=</span> <span class="n">RSS</span><span class="p">[</span><span class="n">niter</span><span class="p">]</span> 
</span></span><span class="line"><span class="cl">            <span class="n">var2</span> <span class="o">=</span> <span class="n">R_squared</span><span class="p">[</span><span class="n">niter</span><span class="p">]</span>
</span></span><span class="line"><span class="cl">            <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&#34;</span><span class="se">\n\n</span><span class="s2">Comb n.</span><span class="si">{</span><span class="n">niter</span><span class="o">+</span><span class="mi">1</span><span class="si">}</span><span class="s2">: </span><span class="si">{</span><span class="n">var0</span><span class="si">}</span><span class="se">\n\
</span></span></span><span class="line"><span class="cl"><span class="se"></span><span class="si">{</span><span class="n">sepIter</span><span class="si">}</span><span class="se">\n\
</span></span></span><span class="line"><span class="cl"><span class="se"></span><span class="s2">candidate dropped feature: </span><span class="si">{</span><span class="nb">list</span><span class="p">(</span><span class="nb">set</span><span class="p">(</span><span class="n">remaining</span><span class="p">)</span><span class="o">-</span><span class="nb">set</span><span class="p">(</span><span class="n">var0</span><span class="p">))</span><span class="si">}</span><span class="se">\n\
</span></span></span><span class="line"><span class="cl"><span class="se"></span><span class="s2">RSS test: </span><span class="si">{</span><span class="n">var1</span><span class="si">}</span><span class="se">\
</span></span></span><span class="line"><span class="cl"><span class="se"></span><span class="s2">&#34;</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">    <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&#34;</span><span class="se">\n\n</span><span class="s2">At the end we have:</span><span class="se">\n\
</span></span></span><span class="line"><span class="cl"><span class="se"></span><span class="s2">min RSS: </span><span class="si">{</span><span class="n">bestRSS</span><span class="si">}</span><span class="se">\n\
</span></span></span><span class="line"><span class="cl"><span class="se"></span><span class="s2">We drop: </span><span class="si">{</span><span class="n">droppedFeat</span><span class="si">}</span><span class="se">\n\
</span></span></span><span class="line"><span class="cl"><span class="se"></span><span class="si">{</span><span class="n">sepComb</span><span class="si">}</span><span class="se">\n</span><span class="s2">&#34;</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">    
</span></span><span class="line"><span class="cl">    <span class="k">return</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="c1">## Print information about an iteration backward subset selection with subset size ncomb</span>
</span></span><span class="line"><span class="cl"><span class="c1"># ncomb = number of the iteration</span>
</span></span><span class="line"><span class="cl"><span class="c1"># features = [remaining_features,dropped_features_list] (used to do the iteration and take track of the selection)</span>
</span></span><span class="line"><span class="cl"><span class="c1"># params = [all_RSS,all_R_squared,all_combs]</span>
</span></span><span class="line"><span class="cl"><span class="c1"># results = [best_RSS,dropped_feature]</span>
</span></span><span class="line"><span class="cl"><span class="c1"># detailed = parameter to see more detail about each single combination</span>
</span></span><span class="line"><span class="cl"><span class="k">def</span> <span class="nf">get_info_backwardS_Zscore</span><span class="p">(</span><span class="n">ncomb</span><span class="p">,</span><span class="n">features</span><span class="p">,</span><span class="n">params</span><span class="p">,</span><span class="n">results</span><span class="p">,</span><span class="n">detailed</span><span class="p">):</span>
</span></span><span class="line"><span class="cl">    
</span></span><span class="line"><span class="cl">    <span class="n">sepComb</span> <span class="o">=</span> <span class="s2">&#34;===&#34;</span><span class="o">*</span><span class="mi">30</span>
</span></span><span class="line"><span class="cl">    <span class="n">sepIter</span> <span class="o">=</span> <span class="s2">&#34;---&#34;</span><span class="o">*</span><span class="mi">30</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">    <span class="n">remaining</span><span class="p">,</span> <span class="n">dropped</span> <span class="o">=</span> <span class="n">features</span>
</span></span><span class="line"><span class="cl">    <span class="n">droppedFeat</span><span class="p">,</span> <span class="n">bestRSS</span> <span class="o">=</span> <span class="n">results</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">    <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&#34;</span><span class="si">{</span><span class="n">sepComb</span><span class="si">}</span><span class="se">\n</span><span class="s2">Iter n.</span><span class="si">{</span><span class="mi">8</span> <span class="o">-</span> <span class="n">ncomb</span><span class="si">}</span><span class="s2">:</span><span class="se">\n\n\
</span></span></span><span class="line"><span class="cl"><span class="se"></span><span class="s2">At the beginning we have:</span><span class="se">\n\
</span></span></span><span class="line"><span class="cl"><span class="se"></span><span class="s2">Remaining features: </span><span class="si">{</span><span class="n">remaining</span><span class="si">}</span><span class="se">\n\
</span></span></span><span class="line"><span class="cl"><span class="se"></span><span class="s2">Dropped features: </span><span class="si">{</span><span class="n">dropped</span><span class="si">}</span><span class="se">\n</span><span class="s2">&#34;</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">    <span class="nb">print</span><span class="p">(</span><span class="s2">&#34;</span><span class="se">\n</span><span class="s2">The Z-scores are:</span><span class="se">\n</span><span class="s2">&#34;</span><span class="p">,</span><span class="n">Zscores</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">    <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&#34;</span><span class="se">\n\n</span><span class="s2">At the end we have:</span><span class="se">\n\
</span></span></span><span class="line"><span class="cl"><span class="se"></span><span class="s2">min RSS: </span><span class="si">{</span><span class="n">bestRSS</span><span class="si">}</span><span class="se">\n\
</span></span></span><span class="line"><span class="cl"><span class="se"></span><span class="s2">We drop: </span><span class="si">{</span><span class="n">droppedFeat</span><span class="si">}</span><span class="se">\n\
</span></span></span><span class="line"><span class="cl"><span class="se"></span><span class="si">{</span><span class="n">sepComb</span><span class="si">}</span><span class="se">\n</span><span class="s2">&#34;</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">    
</span></span><span class="line"><span class="cl">    <span class="k">return</span>
</span></span></code></pre></div><h2 id="best-subset-selection" class="relative group"><strong>Best Subset Selection</strong> <span class="absolute top-0 w-6 transition-opacity opacity-0 -start-6 not-prose group-hover:opacity-100"><a class="group-hover:text-primary-300 dark:group-hover:text-neutral-700" style="text-decoration-line: none !important;" href="#best-subset-selection" aria-label="Anchor">#</a></span></h2><h4>3. Starting from the `ols models` achieved in the last steps, perform best-subset selection.</h4>
<ul>
<li>Generate one model for each combination of the 8 variables available</li>
<li>For each model compute the RSS on training and test set, the number of variables and the \(R^2\) of the model</li>
<li>Save these numbers in suitable data structures</li>
</ul>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-python" data-lang="python"><span class="line"><span class="cl"><span class="c1">## range</span>
</span></span><span class="line"><span class="cl"><span class="n">variables</span> <span class="o">=</span> <span class="n">data</span><span class="o">.</span><span class="n">columns</span><span class="o">.</span><span class="n">tolist</span><span class="p">()</span> <span class="c1"># excluding &#39;const&#39;</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="c1">## Initialize the list where we temporarily store data</span>
</span></span><span class="line"><span class="cl"><span class="n">RSS_train_list</span><span class="p">,</span> <span class="n">RSS_test_list</span><span class="p">,</span> <span class="n">R_squared_list</span> <span class="o">=</span> <span class="p">[],</span> <span class="p">[],</span> <span class="p">[]</span>
</span></span><span class="line"><span class="cl"><span class="n">numb_features</span><span class="p">,</span> <span class="n">features_list</span> <span class="o">=</span> <span class="p">[],</span> <span class="p">[]</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="k">for</span> <span class="n">k</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span><span class="nb">len</span><span class="p">(</span><span class="n">variables</span><span class="p">)</span> <span class="o">+</span> <span class="mi">1</span><span class="p">):</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="c1">#     niter = 0</span>
</span></span><span class="line"><span class="cl"><span class="c1">#     print(&#34;---&#34;*30,f&#34;\nStart by choosing {k} variables\n&#34;)</span>
</span></span><span class="line"><span class="cl">    
</span></span><span class="line"><span class="cl">    <span class="c1"># Looping over all possible combinations of k variables</span>
</span></span><span class="line"><span class="cl">    <span class="k">for</span> <span class="n">combo</span> <span class="ow">in</span> <span class="n">itertools</span><span class="o">.</span><span class="n">combinations</span><span class="p">(</span><span class="n">variables</span><span class="p">,</span><span class="n">k</span><span class="p">):</span>
</span></span><span class="line"><span class="cl">        
</span></span><span class="line"><span class="cl"><span class="c1">#         niter = niter+1 </span>
</span></span><span class="line"><span class="cl">        
</span></span><span class="line"><span class="cl">        <span class="c1"># Compute all the statistics we need</span>
</span></span><span class="line"><span class="cl">        <span class="n">RSS_train</span><span class="p">,</span> <span class="n">RSS_test</span><span class="p">,</span> <span class="n">Rsquared_train</span> <span class="o">=</span> <span class="n">LinReg</span><span class="p">(</span><span class="n">X_train</span><span class="p">[</span><span class="nb">list</span><span class="p">(</span><span class="n">combo</span><span class="p">)],</span> <span class="n">Y_train</span><span class="p">,</span> <span class="n">X_test</span><span class="p">[</span><span class="nb">list</span><span class="p">(</span><span class="n">combo</span><span class="p">)],</span> <span class="n">Y_test</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">        
</span></span><span class="line"><span class="cl"><span class="c1">#         rnd = 4</span>
</span></span><span class="line"><span class="cl"><span class="c1">#         print(f&#34;{niter}. Variables: {list(combo)}\n\</span>
</span></span><span class="line"><span class="cl"><span class="c1">#         RSS train: {RSS_train.round(rnd)}\n\</span>
</span></span><span class="line"><span class="cl"><span class="c1">#         RSS test: {RSS_test.round(rnd)}\n\</span>
</span></span><span class="line"><span class="cl"><span class="c1">#         R^2 train: {Rsquared_train.round(rnd)}\n&#34;)</span>
</span></span><span class="line"><span class="cl">        
</span></span><span class="line"><span class="cl">        <span class="c1"># Save the statistics</span>
</span></span><span class="line"><span class="cl">        <span class="n">RSS_train_list</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">RSS_train</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">        <span class="n">RSS_test_list</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">RSS_test</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">        <span class="n">R_squared_list</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">Rsquared_train</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">        
</span></span><span class="line"><span class="cl">        <span class="c1"># Save features and number of features</span>
</span></span><span class="line"><span class="cl">        <span class="n">features_list</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">combo</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">        <span class="n">numb_features</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">combo</span><span class="p">))</span>   
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="c1">#     print(f&#34;\nUsing {k} variables we have computed {niter} models&#34;)</span>
</span></span><span class="line"><span class="cl"><span class="c1">#     print(&#34;---&#34;*30,&#34;\n&#34;)</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="c1">#Store in DataFrame</span>
</span></span><span class="line"><span class="cl"><span class="n">df_BestS</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">({</span><span class="s1">&#39;numb_features&#39;</span><span class="p">:</span> <span class="n">numb_features</span><span class="p">,</span>\
</span></span><span class="line"><span class="cl">                         <span class="s1">&#39;RSS_train&#39;</span><span class="p">:</span> <span class="n">RSS_train_list</span><span class="p">,</span>\
</span></span><span class="line"><span class="cl">                         <span class="s1">&#39;RSS_test&#39;</span><span class="p">:</span> <span class="n">RSS_test_list</span><span class="p">,</span>\
</span></span><span class="line"><span class="cl">                         <span class="s1">&#39;R_squared&#39;</span><span class="p">:</span> <span class="n">R_squared_list</span><span class="p">,</span>\
</span></span><span class="line"><span class="cl">                         <span class="s1">&#39;features&#39;</span><span class="p">:</span> <span class="n">features_list</span><span class="p">})</span>
</span></span></code></pre></div><div class="highlight"><pre tabindex="0" class="chroma"><code class="language-python" data-lang="python"><span class="line"><span class="cl"><span class="n">df_BestS</span>
</span></span></code></pre></div><div style="width:100%;overflow:scroll;">
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }
<pre><code>.dataframe tbody tr th {
    vertical-align: top;
}

.dataframe thead th {
    text-align: right;
}
</code></pre>
<p></style></p>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th style='text-align:center; vertical-align:middle'></th>
      <th style='text-align:center; vertical-align:middle'>numb_features</th>
      <th style='text-align:center; vertical-align:middle'>RSS_train</th>
      <th style='text-align:center; vertical-align:middle'>RSS_test</th>
      <th style='text-align:center; vertical-align:middle'>R_squared</th>
      <th style='text-align:center; vertical-align:middle'>features</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th style='text-align:center; vertical-align:middle'>0</th>
      <td style='text-align:center; vertical-align:middle'>1</td>
      <td style='text-align:center; vertical-align:middle'>44.528583</td>
      <td style='text-align:center; vertical-align:middle'>14.392162</td>
      <td style='text-align:center; vertical-align:middle'>0.537516</td>
      <td style='text-align:center; vertical-align:middle'>(lcavol,)</td>
    </tr>
    <tr>
      <th style='text-align:center; vertical-align:middle'>1</th>
      <td style='text-align:center; vertical-align:middle'>1</td>
      <td style='text-align:center; vertical-align:middle'>73.613540</td>
      <td style='text-align:center; vertical-align:middle'>30.402846</td>
      <td style='text-align:center; vertical-align:middle'>0.235434</td>
      <td style='text-align:center; vertical-align:middle'>(lweight,)</td>
    </tr>
    <tr>
      <th style='text-align:center; vertical-align:middle'>2</th>
      <td style='text-align:center; vertical-align:middle'>1</td>
      <td style='text-align:center; vertical-align:middle'>91.292039</td>
      <td style='text-align:center; vertical-align:middle'>33.846748</td>
      <td style='text-align:center; vertical-align:middle'>0.051821</td>
      <td style='text-align:center; vertical-align:middle'>(age,)</td>
    </tr>
    <tr>
      <th style='text-align:center; vertical-align:middle'>3</th>
      <td style='text-align:center; vertical-align:middle'>1</td>
      <td style='text-align:center; vertical-align:middle'>89.624912</td>
      <td style='text-align:center; vertical-align:middle'>35.298771</td>
      <td style='text-align:center; vertical-align:middle'>0.069136</td>
      <td style='text-align:center; vertical-align:middle'>(lbph,)</td>
    </tr>
    <tr>
      <th style='text-align:center; vertical-align:middle'>4</th>
      <td style='text-align:center; vertical-align:middle'>1</td>
      <td style='text-align:center; vertical-align:middle'>66.422403</td>
      <td style='text-align:center; vertical-align:middle'>20.632078</td>
      <td style='text-align:center; vertical-align:middle'>0.310122</td>
      <td style='text-align:center; vertical-align:middle'>(svi,)</td>
    </tr>
    <tr>
      <th style='text-align:center; vertical-align:middle'>...</th>
      <td style='text-align:center; vertical-align:middle'>...</td>
      <td style='text-align:center; vertical-align:middle'>...</td>
      <td style='text-align:center; vertical-align:middle'>...</td>
      <td style='text-align:center; vertical-align:middle'>...</td>
      <td style='text-align:center; vertical-align:middle'>...</td>
    </tr>
    <tr>
      <th style='text-align:center; vertical-align:middle'>250</th>
      <td style='text-align:center; vertical-align:middle'>7</td>
      <td style='text-align:center; vertical-align:middle'>31.570706</td>
      <td style='text-align:center; vertical-align:middle'>14.702112</td>
      <td style='text-align:center; vertical-align:middle'>0.672100</td>
      <td style='text-align:center; vertical-align:middle'>(lcavol, lweight, age, svi, lcp, gleason, pgg45)</td>
    </tr>
    <tr>
      <th style='text-align:center; vertical-align:middle'>251</th>
      <td style='text-align:center; vertical-align:middle'>7</td>
      <td style='text-align:center; vertical-align:middle'>30.414990</td>
      <td style='text-align:center; vertical-align:middle'>17.034552</td>
      <td style='text-align:center; vertical-align:middle'>0.684103</td>
      <td style='text-align:center; vertical-align:middle'>(lcavol, lweight, lbph, svi, lcp, gleason, pgg45)</td>
    </tr>
    <tr>
      <th style='text-align:center; vertical-align:middle'>252</th>
      <td style='text-align:center; vertical-align:middle'>7</td>
      <td style='text-align:center; vertical-align:middle'>33.265433</td>
      <td style='text-align:center; vertical-align:middle'>16.754443</td>
      <td style='text-align:center; vertical-align:middle'>0.654498</td>
      <td style='text-align:center; vertical-align:middle'>(lcavol, age, lbph, svi, lcp, gleason, pgg45)</td>
    </tr>
    <tr>
      <th style='text-align:center; vertical-align:middle'>253</th>
      <td style='text-align:center; vertical-align:middle'>7</td>
      <td style='text-align:center; vertical-align:middle'>44.036622</td>
      <td style='text-align:center; vertical-align:middle'>22.633329</td>
      <td style='text-align:center; vertical-align:middle'>0.542626</td>
      <td style='text-align:center; vertical-align:middle'>(lweight, age, lbph, svi, lcp, gleason, pgg45)</td>
    </tr>
    <tr>
      <th style='text-align:center; vertical-align:middle'>254</th>
      <td style='text-align:center; vertical-align:middle'>8</td>
      <td style='text-align:center; vertical-align:middle'>29.426384</td>
      <td style='text-align:center; vertical-align:middle'>15.638220</td>
      <td style='text-align:center; vertical-align:middle'>0.694371</td>
      <td style='text-align:center; vertical-align:middle'>(lcavol, lweight, age, lbph, svi, lcp, gleason...</td>
    </tr>
  </tbody>
</table>
<p>255 rows × 5 columns</p>
</div>
<h4>Find the best subset (of variables) for each number of features</h4>
<p>Now our dataframe <strong><code>df_BestS</code></strong> has a row for each model computed, and it&rsquo;s not easy to handle. For this reason, we extract the best model for each number of variables by observing the interesting parameter.<br>
We consider as interesting parameter:</p>
<ol>
<li>minimum RSS train</li>
<li>minimum RSS test</li>
<li>maximum \(R^2\)</li>
</ol>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-python" data-lang="python"><span class="line"><span class="cl"><span class="c1"># Create new df, selection only best subsets of variables (based on RSS and R^2)</span>
</span></span><span class="line"><span class="cl"><span class="n">df_BestS_RSS_train</span><span class="o">=</span> <span class="n">df_BestS</span><span class="p">[</span><span class="n">df_BestS</span><span class="o">.</span><span class="n">groupby</span><span class="p">(</span><span class="s1">&#39;numb_features&#39;</span><span class="p">)[</span><span class="s1">&#39;RSS_train&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">transform</span><span class="p">(</span><span class="nb">min</span><span class="p">)</span> <span class="o">==</span> <span class="n">df_BestS</span><span class="p">[</span><span class="s1">&#39;RSS_train&#39;</span><span class="p">]]</span>
</span></span><span class="line"><span class="cl"><span class="n">df_BestS_RSS_test</span> <span class="o">=</span> <span class="n">df_BestS</span><span class="p">[</span><span class="n">df_BestS</span><span class="o">.</span><span class="n">groupby</span><span class="p">(</span><span class="s1">&#39;numb_features&#39;</span><span class="p">)[</span><span class="s1">&#39;RSS_test&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">transform</span><span class="p">(</span><span class="nb">min</span><span class="p">)</span> <span class="o">==</span> <span class="n">df_BestS</span><span class="p">[</span><span class="s1">&#39;RSS_test&#39;</span><span class="p">]]</span>
</span></span><span class="line"><span class="cl"><span class="n">df_BestS_R_squared</span> <span class="o">=</span> <span class="n">df_BestS</span><span class="p">[</span><span class="n">df_BestS</span><span class="o">.</span><span class="n">groupby</span><span class="p">(</span><span class="s1">&#39;numb_features&#39;</span><span class="p">)[</span><span class="s1">&#39;R_squared&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">transform</span><span class="p">(</span><span class="nb">max</span><span class="p">)</span> <span class="o">==</span> <span class="n">df_BestS</span><span class="p">[</span><span class="s1">&#39;R_squared&#39;</span><span class="p">]]</span>
</span></span></code></pre></div><div class="highlight"><pre tabindex="0" class="chroma"><code class="language-python" data-lang="python"><span class="line"><span class="cl"><span class="n">df_BestS_RSS_train</span>
</span></span></code></pre></div><div style="width:100%;overflow:scroll;">
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }
<pre><code>.dataframe tbody tr th {
    vertical-align: top;
}

.dataframe thead th {
    text-align: right;
}
</code></pre>
<p></style></p>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th style='text-align:center; vertical-align:middle'></th>
      <th style='text-align:center; vertical-align:middle'>numb_features</th>
      <th style='text-align:center; vertical-align:middle'>RSS_train</th>
      <th style='text-align:center; vertical-align:middle'>RSS_test</th>
      <th style='text-align:center; vertical-align:middle'>R_squared</th>
      <th style='text-align:center; vertical-align:middle'>features</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th style='text-align:center; vertical-align:middle'>0</th>
      <td style='text-align:center; vertical-align:middle'>1</td>
      <td style='text-align:center; vertical-align:middle'>44.528583</td>
      <td style='text-align:center; vertical-align:middle'>14.392162</td>
      <td style='text-align:center; vertical-align:middle'>0.537516</td>
      <td style='text-align:center; vertical-align:middle'>(lcavol,)</td>
    </tr>
    <tr>
      <th style='text-align:center; vertical-align:middle'>8</th>
      <td style='text-align:center; vertical-align:middle'>2</td>
      <td style='text-align:center; vertical-align:middle'>37.091846</td>
      <td style='text-align:center; vertical-align:middle'>14.774470</td>
      <td style='text-align:center; vertical-align:middle'>0.614756</td>
      <td style='text-align:center; vertical-align:middle'>(lcavol, lweight)</td>
    </tr>
    <tr>
      <th style='text-align:center; vertical-align:middle'>38</th>
      <td style='text-align:center; vertical-align:middle'>3</td>
      <td style='text-align:center; vertical-align:middle'>34.907749</td>
      <td style='text-align:center; vertical-align:middle'>12.015924</td>
      <td style='text-align:center; vertical-align:middle'>0.637441</td>
      <td style='text-align:center; vertical-align:middle'>(lcavol, lweight, svi)</td>
    </tr>
    <tr>
      <th style='text-align:center; vertical-align:middle'>97</th>
      <td style='text-align:center; vertical-align:middle'>4</td>
      <td style='text-align:center; vertical-align:middle'>32.814995</td>
      <td style='text-align:center; vertical-align:middle'>13.689964</td>
      <td style='text-align:center; vertical-align:middle'>0.659176</td>
      <td style='text-align:center; vertical-align:middle'>(lcavol, lweight, lbph, svi)</td>
    </tr>
    <tr>
      <th style='text-align:center; vertical-align:middle'>174</th>
      <td style='text-align:center; vertical-align:middle'>5</td>
      <td style='text-align:center; vertical-align:middle'>32.069447</td>
      <td style='text-align:center; vertical-align:middle'>14.577726</td>
      <td style='text-align:center; vertical-align:middle'>0.666920</td>
      <td style='text-align:center; vertical-align:middle'>(lcavol, lweight, lbph, svi, pgg45)</td>
    </tr>
    <tr>
      <th style='text-align:center; vertical-align:middle'>229</th>
      <td style='text-align:center; vertical-align:middle'>6</td>
      <td style='text-align:center; vertical-align:middle'>30.539778</td>
      <td style='text-align:center; vertical-align:middle'>16.457800</td>
      <td style='text-align:center; vertical-align:middle'>0.682807</td>
      <td style='text-align:center; vertical-align:middle'>(lcavol, lweight, lbph, svi, lcp, pgg45)</td>
    </tr>
    <tr>
      <th style='text-align:center; vertical-align:middle'>247</th>
      <td style='text-align:center; vertical-align:middle'>7</td>
      <td style='text-align:center; vertical-align:middle'>29.437300</td>
      <td style='text-align:center; vertical-align:middle'>15.495405</td>
      <td style='text-align:center; vertical-align:middle'>0.694258</td>
      <td style='text-align:center; vertical-align:middle'>(lcavol, lweight, age, lbph, svi, lcp, pgg45)</td>
    </tr>
    <tr>
      <th style='text-align:center; vertical-align:middle'>254</th>
      <td style='text-align:center; vertical-align:middle'>8</td>
      <td style='text-align:center; vertical-align:middle'>29.426384</td>
      <td style='text-align:center; vertical-align:middle'>15.638220</td>
      <td style='text-align:center; vertical-align:middle'>0.694371</td>
      <td style='text-align:center; vertical-align:middle'>(lcavol, lweight, age, lbph, svi, lcp, gleason...</td>
    </tr>
  </tbody>
</table>
</div>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-python" data-lang="python"><span class="line"><span class="cl"><span class="n">df_BestS_RSS_test</span>
</span></span></code></pre></div><div style="width:100%;overflow:scroll;">
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }
<pre><code>.dataframe tbody tr th {
    vertical-align: top;
}

.dataframe thead th {
    text-align: right;
}
</code></pre>
<p></style></p>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th style='text-align:center; vertical-align:middle'></th>
      <th style='text-align:center; vertical-align:middle'>numb_features</th>
      <th style='text-align:center; vertical-align:middle'>RSS_train</th>
      <th style='text-align:center; vertical-align:middle'>RSS_test</th>
      <th style='text-align:center; vertical-align:middle'>R_squared</th>
      <th style='text-align:center; vertical-align:middle'>features</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th style='text-align:center; vertical-align:middle'>0</th>
      <td style='text-align:center; vertical-align:middle'>1</td>
      <td style='text-align:center; vertical-align:middle'>44.528583</td>
      <td style='text-align:center; vertical-align:middle'>14.392162</td>
      <td style='text-align:center; vertical-align:middle'>0.537516</td>
      <td style='text-align:center; vertical-align:middle'>(lcavol,)</td>
    </tr>
    <tr>
      <th style='text-align:center; vertical-align:middle'>11</th>
      <td style='text-align:center; vertical-align:middle'>2</td>
      <td style='text-align:center; vertical-align:middle'>42.312584</td>
      <td style='text-align:center; vertical-align:middle'>11.583584</td>
      <td style='text-align:center; vertical-align:middle'>0.560532</td>
      <td style='text-align:center; vertical-align:middle'>(lcavol, svi)</td>
    </tr>
    <tr>
      <th style='text-align:center; vertical-align:middle'>52</th>
      <td style='text-align:center; vertical-align:middle'>3</td>
      <td style='text-align:center; vertical-align:middle'>42.267034</td>
      <td style='text-align:center; vertical-align:middle'>11.484038</td>
      <td style='text-align:center; vertical-align:middle'>0.561005</td>
      <td style='text-align:center; vertical-align:middle'>(lcavol, svi, gleason)</td>
    </tr>
    <tr>
      <th style='text-align:center; vertical-align:middle'>112</th>
      <td style='text-align:center; vertical-align:middle'>4</td>
      <td style='text-align:center; vertical-align:middle'>42.223638</td>
      <td style='text-align:center; vertical-align:middle'>11.612573</td>
      <td style='text-align:center; vertical-align:middle'>0.561456</td>
      <td style='text-align:center; vertical-align:middle'>(lcavol, age, svi, gleason)</td>
    </tr>
    <tr>
      <th style='text-align:center; vertical-align:middle'>167</th>
      <td style='text-align:center; vertical-align:middle'>5</td>
      <td style='text-align:center; vertical-align:middle'>34.170209</td>
      <td style='text-align:center; vertical-align:middle'>11.497692</td>
      <td style='text-align:center; vertical-align:middle'>0.645101</td>
      <td style='text-align:center; vertical-align:middle'>(lcavol, lweight, age, svi, gleason)</td>
    </tr>
    <tr>
      <th style='text-align:center; vertical-align:middle'>226</th>
      <td style='text-align:center; vertical-align:middle'>6</td>
      <td style='text-align:center; vertical-align:middle'>33.642783</td>
      <td style='text-align:center; vertical-align:middle'>12.009380</td>
      <td style='text-align:center; vertical-align:middle'>0.650579</td>
      <td style='text-align:center; vertical-align:middle'>(lcavol, lweight, age, svi, gleason, pgg45)</td>
    </tr>
    <tr>
      <th style='text-align:center; vertical-align:middle'>246</th>
      <td style='text-align:center; vertical-align:middle'>7</td>
      <td style='text-align:center; vertical-align:middle'>30.958630</td>
      <td style='text-align:center; vertical-align:middle'>13.492898</td>
      <td style='text-align:center; vertical-align:middle'>0.678457</td>
      <td style='text-align:center; vertical-align:middle'>(lcavol, lweight, age, lbph, svi, lcp, gleason)</td>
    </tr>
    <tr>
      <th style='text-align:center; vertical-align:middle'>254</th>
      <td style='text-align:center; vertical-align:middle'>8</td>
      <td style='text-align:center; vertical-align:middle'>29.426384</td>
      <td style='text-align:center; vertical-align:middle'>15.638220</td>
      <td style='text-align:center; vertical-align:middle'>0.694371</td>
      <td style='text-align:center; vertical-align:middle'>(lcavol, lweight, age, lbph, svi, lcp, gleason...</td>
    </tr>
  </tbody>
</table>
</div>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-python" data-lang="python"><span class="line"><span class="cl"><span class="c1"># the same as selecting min RSS on training set</span>
</span></span><span class="line"><span class="cl"><span class="n">df_BestS_R_squared</span>
</span></span></code></pre></div><div style="width:100%;overflow:scroll;">
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }
<pre><code>.dataframe tbody tr th {
    vertical-align: top;
}

.dataframe thead th {
    text-align: right;
}
</code></pre>
<p></style></p>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th style='text-align:center; vertical-align:middle'></th>
      <th style='text-align:center; vertical-align:middle'>numb_features</th>
      <th style='text-align:center; vertical-align:middle'>RSS_train</th>
      <th style='text-align:center; vertical-align:middle'>RSS_test</th>
      <th style='text-align:center; vertical-align:middle'>R_squared</th>
      <th style='text-align:center; vertical-align:middle'>features</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th style='text-align:center; vertical-align:middle'>0</th>
      <td style='text-align:center; vertical-align:middle'>1</td>
      <td style='text-align:center; vertical-align:middle'>44.528583</td>
      <td style='text-align:center; vertical-align:middle'>14.392162</td>
      <td style='text-align:center; vertical-align:middle'>0.537516</td>
      <td style='text-align:center; vertical-align:middle'>(lcavol,)</td>
    </tr>
    <tr>
      <th style='text-align:center; vertical-align:middle'>8</th>
      <td style='text-align:center; vertical-align:middle'>2</td>
      <td style='text-align:center; vertical-align:middle'>37.091846</td>
      <td style='text-align:center; vertical-align:middle'>14.774470</td>
      <td style='text-align:center; vertical-align:middle'>0.614756</td>
      <td style='text-align:center; vertical-align:middle'>(lcavol, lweight)</td>
    </tr>
    <tr>
      <th style='text-align:center; vertical-align:middle'>38</th>
      <td style='text-align:center; vertical-align:middle'>3</td>
      <td style='text-align:center; vertical-align:middle'>34.907749</td>
      <td style='text-align:center; vertical-align:middle'>12.015924</td>
      <td style='text-align:center; vertical-align:middle'>0.637441</td>
      <td style='text-align:center; vertical-align:middle'>(lcavol, lweight, svi)</td>
    </tr>
    <tr>
      <th style='text-align:center; vertical-align:middle'>97</th>
      <td style='text-align:center; vertical-align:middle'>4</td>
      <td style='text-align:center; vertical-align:middle'>32.814995</td>
      <td style='text-align:center; vertical-align:middle'>13.689964</td>
      <td style='text-align:center; vertical-align:middle'>0.659176</td>
      <td style='text-align:center; vertical-align:middle'>(lcavol, lweight, lbph, svi)</td>
    </tr>
    <tr>
      <th style='text-align:center; vertical-align:middle'>174</th>
      <td style='text-align:center; vertical-align:middle'>5</td>
      <td style='text-align:center; vertical-align:middle'>32.069447</td>
      <td style='text-align:center; vertical-align:middle'>14.577726</td>
      <td style='text-align:center; vertical-align:middle'>0.666920</td>
      <td style='text-align:center; vertical-align:middle'>(lcavol, lweight, lbph, svi, pgg45)</td>
    </tr>
    <tr>
      <th style='text-align:center; vertical-align:middle'>229</th>
      <td style='text-align:center; vertical-align:middle'>6</td>
      <td style='text-align:center; vertical-align:middle'>30.539778</td>
      <td style='text-align:center; vertical-align:middle'>16.457800</td>
      <td style='text-align:center; vertical-align:middle'>0.682807</td>
      <td style='text-align:center; vertical-align:middle'>(lcavol, lweight, lbph, svi, lcp, pgg45)</td>
    </tr>
    <tr>
      <th style='text-align:center; vertical-align:middle'>247</th>
      <td style='text-align:center; vertical-align:middle'>7</td>
      <td style='text-align:center; vertical-align:middle'>29.437300</td>
      <td style='text-align:center; vertical-align:middle'>15.495405</td>
      <td style='text-align:center; vertical-align:middle'>0.694258</td>
      <td style='text-align:center; vertical-align:middle'>(lcavol, lweight, age, lbph, svi, lcp, pgg45)</td>
    </tr>
    <tr>
      <th style='text-align:center; vertical-align:middle'>254</th>
      <td style='text-align:center; vertical-align:middle'>8</td>
      <td style='text-align:center; vertical-align:middle'>29.426384</td>
      <td style='text-align:center; vertical-align:middle'>15.638220</td>
      <td style='text-align:center; vertical-align:middle'>0.694371</td>
      <td style='text-align:center; vertical-align:middle'>(lcavol, lweight, age, lbph, svi, lcp, gleason...</td>
    </tr>
  </tbody>
</table>
</div>
<h3 id="plots-for-best-selection" class="relative group"><strong>Plots for Best Selection</strong> <span class="absolute top-0 w-6 transition-opacity opacity-0 -start-6 not-prose group-hover:opacity-100"><a class="group-hover:text-primary-300 dark:group-hover:text-neutral-700" style="text-decoration-line: none !important;" href="#plots-for-best-selection" aria-label="Anchor">#</a></span></h3><h4>4. + 5. + 6.  Generate some charts:</h4>
<ul>
<li>x-axis: the subset size</li>
<li>y-axis:
<ul>
<li>
<ol start="4">
<li>RSS for training set of all the models generated at step 3</li>
</ol>
</li>
<li>
<ol start="5">
<li>\(R^2\) of all the models generated at step 3</li>
</ol>
</li>
<li>
<ol start="6">
<li>RSS for test set of all the models generated at step 3</li>
</ol>
</li>
</ul>
</li>
</ul>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-python" data-lang="python"><span class="line"><span class="cl"><span class="c1"># Initialize the figure</span>
</span></span><span class="line"><span class="cl"><span class="n">width</span> <span class="o">=</span> <span class="mi">6</span>
</span></span><span class="line"><span class="cl"><span class="n">height</span> <span class="o">=</span> <span class="mi">6</span>
</span></span><span class="line"><span class="cl"><span class="n">nfig</span> <span class="o">=</span> <span class="mi">3</span>
</span></span><span class="line"><span class="cl"><span class="n">fig</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">figure</span><span class="p">(</span><span class="n">figsize</span> <span class="o">=</span> <span class="p">(</span><span class="n">width</span><span class="o">*</span><span class="n">nfig</span><span class="p">,</span><span class="n">height</span><span class="p">))</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="c1"># 1. RSS Training set plot</span>
</span></span><span class="line"><span class="cl"><span class="n">tmp_df1</span> <span class="o">=</span> <span class="n">df_BestS</span><span class="p">;</span>           <span class="c1"># scatter plot</span>
</span></span><span class="line"><span class="cl"><span class="n">tmp_df2</span> <span class="o">=</span> <span class="n">df_BestS_RSS_train</span><span class="p">;</span> <span class="c1"># plot the line of best values</span>
</span></span><span class="line"><span class="cl"><span class="n">ax1</span> <span class="o">=</span> <span class="n">fig</span><span class="o">.</span><span class="n">add_subplot</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="n">nfig</span><span class="p">,</span> <span class="mi">1</span><span class="p">)</span>
</span></span><span class="line"><span class="cl"><span class="n">ax1</span><span class="o">.</span><span class="n">scatter</span><span class="p">(</span><span class="n">tmp_df1</span><span class="o">.</span><span class="n">numb_features</span><span class="p">,</span><span class="n">tmp_df1</span><span class="o">.</span><span class="n">RSS_train</span><span class="p">,</span> <span class="n">alpha</span> <span class="o">=</span> <span class="mf">.2</span><span class="p">,</span> <span class="n">color</span> <span class="o">=</span> <span class="s1">&#39;darkblue&#39;</span><span class="p">);</span>
</span></span><span class="line"><span class="cl"><span class="n">ax1</span><span class="o">.</span><span class="n">set_xlabel</span><span class="p">(</span><span class="s1">&#39;Subset Size k&#39;</span><span class="p">,</span><span class="n">fontsize</span><span class="o">=</span><span class="mi">14</span><span class="p">);</span>
</span></span><span class="line"><span class="cl"><span class="n">ax1</span><span class="o">.</span><span class="n">set_ylabel</span><span class="p">(</span><span class="s1">&#39;RSS&#39;</span><span class="p">,</span><span class="n">fontsize</span><span class="o">=</span><span class="mi">14</span><span class="p">);</span>
</span></span><span class="line"><span class="cl"><span class="n">ax1</span><span class="o">.</span><span class="n">set_title</span><span class="p">(</span><span class="s1">&#39;RSS on training set&#39;</span><span class="p">,</span><span class="n">fontsize</span><span class="o">=</span><span class="mi">18</span><span class="p">);</span>
</span></span><span class="line"><span class="cl"><span class="n">ax1</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">tmp_df2</span><span class="o">.</span><span class="n">numb_features</span><span class="p">,</span><span class="n">tmp_df2</span><span class="o">.</span><span class="n">RSS_train</span><span class="p">,</span><span class="n">color</span> <span class="o">=</span> <span class="s1">&#39;r&#39;</span><span class="p">,</span> <span class="n">label</span> <span class="o">=</span> <span class="s1">&#39;Best subset&#39;</span><span class="p">);</span> <span class="c1"># line of best values</span>
</span></span><span class="line"><span class="cl"><span class="n">ax1</span><span class="o">.</span><span class="n">grid</span><span class="p">(</span><span class="n">color</span><span class="o">=</span><span class="s1">&#39;grey&#39;</span><span class="p">,</span> <span class="n">linestyle</span><span class="o">=</span><span class="s1">&#39;-&#39;</span><span class="p">,</span> <span class="n">linewidth</span><span class="o">=</span><span class="mf">0.5</span><span class="p">);</span>
</span></span><span class="line"><span class="cl"><span class="n">ax1</span><span class="o">.</span><span class="n">legend</span><span class="p">();</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="c1"># 2. RSS Test set plot</span>
</span></span><span class="line"><span class="cl"><span class="n">tmp_df1</span> <span class="o">=</span> <span class="n">df_BestS</span><span class="p">;</span>           <span class="c1"># scatter plot</span>
</span></span><span class="line"><span class="cl"><span class="n">tmp_df2</span> <span class="o">=</span> <span class="n">df_BestS_RSS_test</span><span class="p">;</span>  <span class="c1"># plot the line of best values</span>
</span></span><span class="line"><span class="cl"><span class="n">ax2</span> <span class="o">=</span> <span class="n">fig</span><span class="o">.</span><span class="n">add_subplot</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="n">nfig</span><span class="p">,</span> <span class="mi">2</span><span class="p">);</span>
</span></span><span class="line"><span class="cl"><span class="n">ax2</span><span class="o">.</span><span class="n">scatter</span><span class="p">(</span><span class="n">tmp_df1</span><span class="o">.</span><span class="n">numb_features</span><span class="p">,</span><span class="n">tmp_df1</span><span class="o">.</span><span class="n">RSS_test</span><span class="p">,</span> <span class="n">alpha</span> <span class="o">=</span> <span class="mf">.2</span><span class="p">,</span> <span class="n">color</span> <span class="o">=</span> <span class="s1">&#39;darkblue&#39;</span><span class="p">);</span>
</span></span><span class="line"><span class="cl"><span class="n">ax2</span><span class="o">.</span><span class="n">set_xlabel</span><span class="p">(</span><span class="s1">&#39;Subset Size k&#39;</span><span class="p">,</span><span class="n">fontsize</span><span class="o">=</span><span class="mi">14</span><span class="p">);</span>
</span></span><span class="line"><span class="cl"><span class="n">ax2</span><span class="o">.</span><span class="n">set_ylabel</span><span class="p">(</span><span class="s1">&#39;RSS&#39;</span><span class="p">,</span><span class="n">fontsize</span><span class="o">=</span><span class="mi">14</span><span class="p">);</span>
</span></span><span class="line"><span class="cl"><span class="n">ax2</span><span class="o">.</span><span class="n">set_title</span><span class="p">(</span><span class="s1">&#39;RSS on test set&#39;</span><span class="p">,</span><span class="n">fontsize</span><span class="o">=</span><span class="mi">18</span><span class="p">);</span>
</span></span><span class="line"><span class="cl"><span class="n">ax2</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">tmp_df2</span><span class="o">.</span><span class="n">numb_features</span><span class="p">,</span><span class="n">tmp_df2</span><span class="o">.</span><span class="n">RSS_test</span><span class="p">,</span><span class="n">color</span> <span class="o">=</span> <span class="s1">&#39;r&#39;</span><span class="p">,</span> <span class="n">label</span> <span class="o">=</span> <span class="s1">&#39;Best subset&#39;</span><span class="p">);</span> <span class="c1"># line of best values</span>
</span></span><span class="line"><span class="cl"><span class="n">ax2</span><span class="o">.</span><span class="n">grid</span><span class="p">(</span><span class="n">color</span><span class="o">=</span><span class="s1">&#39;grey&#39;</span><span class="p">,</span> <span class="n">linestyle</span><span class="o">=</span><span class="s1">&#39;-&#39;</span><span class="p">,</span> <span class="n">linewidth</span><span class="o">=</span><span class="mf">0.5</span><span class="p">);</span>
</span></span><span class="line"><span class="cl"><span class="n">ax2</span><span class="o">.</span><span class="n">legend</span><span class="p">();</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="c1"># 3. R^2 plot</span>
</span></span><span class="line"><span class="cl"><span class="n">tmp_df1</span> <span class="o">=</span> <span class="n">df_BestS</span><span class="p">;</span>           <span class="c1"># scatter plot</span>
</span></span><span class="line"><span class="cl"><span class="n">tmp_df2</span> <span class="o">=</span> <span class="n">df_BestS_R_squared</span><span class="p">;</span>  <span class="c1"># plot the line of best values</span>
</span></span><span class="line"><span class="cl"><span class="n">ax3</span> <span class="o">=</span> <span class="n">fig</span><span class="o">.</span><span class="n">add_subplot</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="n">nfig</span><span class="p">,</span> <span class="mi">3</span><span class="p">);</span>
</span></span><span class="line"><span class="cl"><span class="n">ax3</span><span class="o">.</span><span class="n">scatter</span><span class="p">(</span><span class="n">tmp_df1</span><span class="o">.</span><span class="n">numb_features</span><span class="p">,</span><span class="n">tmp_df1</span><span class="o">.</span><span class="n">R_squared</span><span class="p">,</span> <span class="n">alpha</span> <span class="o">=</span> <span class="mf">.2</span><span class="p">,</span> <span class="n">color</span> <span class="o">=</span> <span class="s1">&#39;darkblue&#39;</span><span class="p">);</span>
</span></span><span class="line"><span class="cl"><span class="n">ax3</span><span class="o">.</span><span class="n">set_xlabel</span><span class="p">(</span><span class="s1">&#39;Subset Size k&#39;</span><span class="p">,</span><span class="n">fontsize</span><span class="o">=</span><span class="mi">14</span><span class="p">);</span>
</span></span><span class="line"><span class="cl"><span class="n">ax3</span><span class="o">.</span><span class="n">set_ylabel</span><span class="p">(</span><span class="s1">&#39;$R^2$&#39;</span><span class="p">,</span><span class="n">fontsize</span><span class="o">=</span><span class="mi">14</span><span class="p">);</span>
</span></span><span class="line"><span class="cl"><span class="n">ax3</span><span class="o">.</span><span class="n">set_ylim</span><span class="p">(</span><span class="n">bottom</span><span class="o">=-</span><span class="mf">0.1</span><span class="p">,</span><span class="n">top</span><span class="o">=</span><span class="mf">1.1</span><span class="p">)</span>
</span></span><span class="line"><span class="cl"><span class="n">ax3</span><span class="o">.</span><span class="n">set_title</span><span class="p">(</span><span class="s1">&#39;$R^2$ on training set&#39;</span><span class="p">,</span><span class="n">fontsize</span><span class="o">=</span><span class="mi">18</span><span class="p">);</span>
</span></span><span class="line"><span class="cl"><span class="n">ax3</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">tmp_df2</span><span class="o">.</span><span class="n">numb_features</span><span class="p">,</span><span class="n">tmp_df2</span><span class="o">.</span><span class="n">R_squared</span><span class="p">,</span><span class="n">color</span> <span class="o">=</span> <span class="s1">&#39;r&#39;</span><span class="p">,</span> <span class="n">label</span> <span class="o">=</span> <span class="s1">&#39;Best subset&#39;</span><span class="p">);</span> <span class="c1"># line of best values</span>
</span></span><span class="line"><span class="cl"><span class="n">ax3</span><span class="o">.</span><span class="n">grid</span><span class="p">(</span><span class="n">color</span><span class="o">=</span><span class="s1">&#39;grey&#39;</span><span class="p">,</span> <span class="n">linestyle</span><span class="o">=</span><span class="s1">&#39;-&#39;</span><span class="p">,</span> <span class="n">linewidth</span><span class="o">=</span><span class="mf">0.5</span><span class="p">);</span>
</span></span><span class="line"><span class="cl"><span class="n">ax3</span><span class="o">.</span><span class="n">legend</span><span class="p">();</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="n">fig</span><span class="o">.</span><span class="n">suptitle</span><span class="p">(</span><span class="s1">&#39;Best Subset Selection&#39;</span><span class="p">,</span><span class="n">fontsize</span><span class="o">=</span><span class="mi">25</span><span class="p">,</span> <span class="n">y</span><span class="o">=</span><span class="mf">0.98</span><span class="p">);</span>
</span></span><span class="line"><span class="cl"><span class="n">fig</span><span class="o">.</span><span class="n">subplots_adjust</span><span class="p">(</span><span class="n">top</span><span class="o">=</span><span class="mf">0.8</span><span class="p">)</span>
</span></span><span class="line"><span class="cl"><span class="n">plt</span><span class="o">.</span><span class="n">show</span><span class="p">();</span>
</span></span></code></pre></div><p>






  
  
<figure><img src="/posts/sl-ex3-subsetselection/output_27_0.png" alt="png" class="mx-auto my-0 rounded-md" />
</figure>
</p>
<h3 id="estimating-test-error-by-adjusting-training-error" class="relative group"><strong>Estimating test error by adjusting training error</strong> <span class="absolute top-0 w-6 transition-opacity opacity-0 -start-6 not-prose group-hover:opacity-100"><a class="group-hover:text-primary-300 dark:group-hover:text-neutral-700" style="text-decoration-line: none !important;" href="#estimating-test-error-by-adjusting-training-error" aria-label="Anchor">#</a></span></h3><p>In general, <strong>the training set MSE underestimates the test MSE</strong>. In fact we fit a model to the training data using least squares and we estimate the coefficients of the regression in such a way the training RSS is minimized. So the training RSS decreases as we add more variables to the model, but the test RSS may not!</p>
<p>For this reason the training RSS (and so also  \(R^2\)) may not be used directly for selecting the best model, but we need to adjust them to get an estimate of the test error.</p>
<h4>Attempt n.1: using sklearn library</h4>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-python" data-lang="python"><span class="line"><span class="cl"><span class="n">AIC_list</span><span class="p">,</span> <span class="n">BIC_list</span><span class="p">,</span> <span class="n">R_squared_adj_list</span> <span class="o">=</span><span class="p">[],</span> <span class="p">[],</span> <span class="p">[]</span> <span class="c1"># from sklearn I can get no Cp estimate out of the box.</span>
</span></span><span class="line"><span class="cl"><span class="n">best_features</span> <span class="o">=</span> <span class="n">df_BestS_RSS_train</span><span class="p">[</span><span class="s1">&#39;features&#39;</span><span class="p">]</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="k">for</span> <span class="n">features</span> <span class="ow">in</span> <span class="n">best_features</span><span class="p">:</span>
</span></span><span class="line"><span class="cl">    
</span></span><span class="line"><span class="cl">    <span class="n">regr</span> <span class="o">=</span> <span class="n">sm</span><span class="o">.</span><span class="n">OLS</span><span class="p">(</span><span class="n">Y_train</span><span class="p">,</span> <span class="n">sm</span><span class="o">.</span><span class="n">add_constant</span><span class="p">(</span><span class="n">X_train</span><span class="p">[</span><span class="nb">list</span><span class="p">(</span><span class="n">features</span><span class="p">)]))</span><span class="o">.</span><span class="n">fit</span><span class="p">()</span>
</span></span><span class="line"><span class="cl">        
</span></span><span class="line"><span class="cl">    <span class="n">AIC_list</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">regr</span><span class="o">.</span><span class="n">aic</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">    <span class="n">BIC_list</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">regr</span><span class="o">.</span><span class="n">bic</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">    <span class="n">R_squared_adj_list</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">regr</span><span class="o">.</span><span class="n">rsquared_adj</span><span class="p">)</span>
</span></span></code></pre></div><div class="highlight"><pre tabindex="0" class="chroma"><code class="language-python" data-lang="python"><span class="line"><span class="cl"><span class="c1">#Store in DataFrame</span>
</span></span><span class="line"><span class="cl"><span class="n">df1</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">({</span><span class="s1">&#39;numb_features&#39;</span><span class="p">:</span> <span class="n">df_BestS_RSS_train</span><span class="p">[</span><span class="s1">&#39;numb_features&#39;</span><span class="p">],</span>\
</span></span><span class="line"><span class="cl">                    <span class="s1">&#39;RSS_train&#39;</span><span class="p">:</span> <span class="n">df_BestS_RSS_train</span><span class="p">[</span><span class="s1">&#39;RSS_train&#39;</span><span class="p">],</span>\
</span></span><span class="line"><span class="cl">                    <span class="s1">&#39;features&#39;</span><span class="p">:</span> <span class="n">df_BestS_RSS_train</span><span class="p">[</span><span class="s1">&#39;features&#39;</span><span class="p">],</span>\
</span></span><span class="line"><span class="cl">                    <span class="s1">&#39;AIC&#39;</span><span class="p">:</span> <span class="n">AIC_list</span><span class="p">,</span>\
</span></span><span class="line"><span class="cl">                   <span class="s1">&#39;BIC&#39;</span><span class="p">:</span> <span class="n">BIC_list</span><span class="p">,</span>\
</span></span><span class="line"><span class="cl">                   <span class="s1">&#39;R_squared_adj&#39;</span><span class="p">:</span> <span class="n">R_squared_adj_list</span><span class="p">})</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="n">df1</span>
</span></span></code></pre></div><div style="width:100%;overflow:scroll;">
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }
<pre><code>.dataframe tbody tr th {
    vertical-align: top;
}

.dataframe thead th {
    text-align: right;
}
</code></pre>
<p></style></p>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th style='text-align:center; vertical-align:middle'></th>
      <th style='text-align:center; vertical-align:middle'>numb_features</th>
      <th style='text-align:center; vertical-align:middle'>RSS_train</th>
      <th style='text-align:center; vertical-align:middle'>features</th>
      <th style='text-align:center; vertical-align:middle'>AIC</th>
      <th style='text-align:center; vertical-align:middle'>BIC</th>
      <th style='text-align:center; vertical-align:middle'>R_squared_adj</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th style='text-align:center; vertical-align:middle'>0</th>
      <td style='text-align:center; vertical-align:middle'>1</td>
      <td style='text-align:center; vertical-align:middle'>44.528583</td>
      <td style='text-align:center; vertical-align:middle'>(lcavol,)</td>
      <td style='text-align:center; vertical-align:middle'>166.764154</td>
      <td style='text-align:center; vertical-align:middle'>171.173540</td>
      <td style='text-align:center; vertical-align:middle'>0.530401</td>
    </tr>
    <tr>
      <th style='text-align:center; vertical-align:middle'>8</th>
      <td style='text-align:center; vertical-align:middle'>2</td>
      <td style='text-align:center; vertical-align:middle'>37.091846</td>
      <td style='text-align:center; vertical-align:middle'>(lcavol, lweight)</td>
      <td style='text-align:center; vertical-align:middle'>156.520967</td>
      <td style='text-align:center; vertical-align:middle'>163.135045</td>
      <td style='text-align:center; vertical-align:middle'>0.602717</td>
    </tr>
    <tr>
      <th style='text-align:center; vertical-align:middle'>38</th>
      <td style='text-align:center; vertical-align:middle'>3</td>
      <td style='text-align:center; vertical-align:middle'>34.907749</td>
      <td style='text-align:center; vertical-align:middle'>(lcavol, lweight, svi)</td>
      <td style='text-align:center; vertical-align:middle'>154.454850</td>
      <td style='text-align:center; vertical-align:middle'>163.273620</td>
      <td style='text-align:center; vertical-align:middle'>0.620176</td>
    </tr>
    <tr>
      <th style='text-align:center; vertical-align:middle'>97</th>
      <td style='text-align:center; vertical-align:middle'>4</td>
      <td style='text-align:center; vertical-align:middle'>32.814995</td>
      <td style='text-align:center; vertical-align:middle'>(lcavol, lweight, lbph, svi)</td>
      <td style='text-align:center; vertical-align:middle'>152.312691</td>
      <td style='text-align:center; vertical-align:middle'>163.336154</td>
      <td style='text-align:center; vertical-align:middle'>0.637188</td>
    </tr>
    <tr>
      <th style='text-align:center; vertical-align:middle'>174</th>
      <td style='text-align:center; vertical-align:middle'>5</td>
      <td style='text-align:center; vertical-align:middle'>32.069447</td>
      <td style='text-align:center; vertical-align:middle'>(lcavol, lweight, lbph, svi, pgg45)</td>
      <td style='text-align:center; vertical-align:middle'>152.772911</td>
      <td style='text-align:center; vertical-align:middle'>166.001067</td>
      <td style='text-align:center; vertical-align:middle'>0.639618</td>
    </tr>
    <tr>
      <th style='text-align:center; vertical-align:middle'>229</th>
      <td style='text-align:center; vertical-align:middle'>6</td>
      <td style='text-align:center; vertical-align:middle'>30.539778</td>
      <td style='text-align:center; vertical-align:middle'>(lcavol, lweight, lbph, svi, lcp, pgg45)</td>
      <td style='text-align:center; vertical-align:middle'>151.498370</td>
      <td style='text-align:center; vertical-align:middle'>166.931219</td>
      <td style='text-align:center; vertical-align:middle'>0.651088</td>
    </tr>
    <tr>
      <th style='text-align:center; vertical-align:middle'>247</th>
      <td style='text-align:center; vertical-align:middle'>7</td>
      <td style='text-align:center; vertical-align:middle'>29.437300</td>
      <td style='text-align:center; vertical-align:middle'>(lcavol, lweight, age, lbph, svi, lcp, pgg45)</td>
      <td style='text-align:center; vertical-align:middle'>151.034951</td>
      <td style='text-align:center; vertical-align:middle'>168.672492</td>
      <td style='text-align:center; vertical-align:middle'>0.657983</td>
    </tr>
    <tr>
      <th style='text-align:center; vertical-align:middle'>254</th>
      <td style='text-align:center; vertical-align:middle'>8</td>
      <td style='text-align:center; vertical-align:middle'>29.426384</td>
      <td style='text-align:center; vertical-align:middle'>(lcavol, lweight, age, lbph, svi, lcp, gleason...</td>
      <td style='text-align:center; vertical-align:middle'>153.010102</td>
      <td style='text-align:center; vertical-align:middle'>172.852336</td>
      <td style='text-align:center; vertical-align:middle'>0.652215</td>
    </tr>
  </tbody>
</table>
</div>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-python" data-lang="python"><span class="line"><span class="cl"><span class="c1"># Initialize the figure</span>
</span></span><span class="line"><span class="cl"><span class="n">width</span> <span class="o">=</span> <span class="mi">6</span>
</span></span><span class="line"><span class="cl"><span class="n">height</span> <span class="o">=</span> <span class="mi">6</span>
</span></span><span class="line"><span class="cl"><span class="n">nfig</span> <span class="o">=</span> <span class="mi">3</span>
</span></span><span class="line"><span class="cl"><span class="n">fig</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">figure</span><span class="p">(</span><span class="n">figsize</span> <span class="o">=</span> <span class="p">(</span><span class="n">width</span><span class="o">*</span><span class="n">nfig</span><span class="p">,</span><span class="n">height</span><span class="p">))</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="c1"># 1. AIC</span>
</span></span><span class="line"><span class="cl"><span class="n">ax1</span> <span class="o">=</span> <span class="n">fig</span><span class="o">.</span><span class="n">add_subplot</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="n">nfig</span><span class="p">,</span> <span class="mi">1</span><span class="p">)</span>
</span></span><span class="line"><span class="cl"><span class="n">ax1</span><span class="o">.</span><span class="n">scatter</span><span class="p">(</span><span class="n">df1</span><span class="p">[</span><span class="s1">&#39;numb_features&#39;</span><span class="p">],</span><span class="n">df1</span><span class="p">[</span><span class="s1">&#39;AIC&#39;</span><span class="p">],</span> <span class="n">alpha</span> <span class="o">=</span> <span class="mf">.5</span><span class="p">,</span> <span class="n">color</span> <span class="o">=</span> <span class="s1">&#39;darkblue&#39;</span><span class="p">);</span>
</span></span><span class="line"><span class="cl"><span class="n">ax1</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">df1</span><span class="p">[</span><span class="s1">&#39;numb_features&#39;</span><span class="p">],</span><span class="n">df1</span><span class="p">[</span><span class="s1">&#39;AIC&#39;</span><span class="p">],</span><span class="n">color</span> <span class="o">=</span> <span class="s1">&#39;r&#39;</span><span class="p">,</span> <span class="n">alpha</span> <span class="o">=</span> <span class="mf">.5</span><span class="p">);</span> <span class="c1"># line of best values</span>
</span></span><span class="line"><span class="cl"><span class="n">ax1</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">df1</span><span class="p">[</span><span class="s1">&#39;AIC&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">argmin</span><span class="p">()</span><span class="o">+</span><span class="mi">1</span><span class="p">,</span> <span class="n">df1</span><span class="p">[</span><span class="s1">&#39;AIC&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">min</span><span class="p">(),</span> <span class="n">marker</span><span class="o">=</span><span class="s1">&#39;x&#39;</span><span class="p">,</span> <span class="n">markersize</span><span class="o">=</span><span class="mi">20</span><span class="p">,</span> <span class="n">color</span> <span class="o">=</span> <span class="s1">&#39;b&#39;</span><span class="p">);</span> <span class="c1"># best val</span>
</span></span><span class="line"><span class="cl"><span class="n">ax1</span><span class="o">.</span><span class="n">set_xlabel</span><span class="p">(</span><span class="s1">&#39;Number of predictors&#39;</span><span class="p">,</span><span class="n">fontsize</span><span class="o">=</span><span class="mi">14</span><span class="p">);</span>
</span></span><span class="line"><span class="cl"><span class="n">ax1</span><span class="o">.</span><span class="n">set_ylabel</span><span class="p">(</span><span class="s1">&#39;AIC&#39;</span><span class="p">,</span><span class="n">fontsize</span><span class="o">=</span><span class="mi">14</span><span class="p">);</span>
</span></span><span class="line"><span class="cl"><span class="n">ax1</span><span class="o">.</span><span class="n">grid</span><span class="p">(</span><span class="n">color</span><span class="o">=</span><span class="s1">&#39;grey&#39;</span><span class="p">,</span> <span class="n">linestyle</span><span class="o">=</span><span class="s1">&#39;-&#39;</span><span class="p">,</span> <span class="n">linewidth</span><span class="o">=</span><span class="mf">0.5</span><span class="p">);</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="c1"># 2. BIC</span>
</span></span><span class="line"><span class="cl"><span class="n">ax2</span> <span class="o">=</span> <span class="n">fig</span><span class="o">.</span><span class="n">add_subplot</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="n">nfig</span><span class="p">,</span> <span class="mi">2</span><span class="p">)</span>
</span></span><span class="line"><span class="cl"><span class="n">ax2</span><span class="o">.</span><span class="n">scatter</span><span class="p">(</span><span class="n">df1</span><span class="p">[</span><span class="s1">&#39;numb_features&#39;</span><span class="p">],</span><span class="n">df1</span><span class="p">[</span><span class="s1">&#39;BIC&#39;</span><span class="p">],</span> <span class="n">alpha</span> <span class="o">=</span> <span class="mf">.5</span><span class="p">,</span> <span class="n">color</span> <span class="o">=</span> <span class="s1">&#39;darkblue&#39;</span><span class="p">);</span>
</span></span><span class="line"><span class="cl"><span class="n">ax2</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">df1</span><span class="p">[</span><span class="s1">&#39;numb_features&#39;</span><span class="p">],</span><span class="n">df1</span><span class="p">[</span><span class="s1">&#39;BIC&#39;</span><span class="p">],</span><span class="n">color</span> <span class="o">=</span> <span class="s1">&#39;r&#39;</span><span class="p">,</span> <span class="n">alpha</span> <span class="o">=</span> <span class="mf">.5</span><span class="p">);</span> <span class="c1"># line of best values</span>
</span></span><span class="line"><span class="cl"><span class="n">ax2</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">df1</span><span class="p">[</span><span class="s1">&#39;BIC&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">argmin</span><span class="p">()</span><span class="o">+</span><span class="mi">1</span><span class="p">,</span> <span class="n">df1</span><span class="p">[</span><span class="s1">&#39;BIC&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">min</span><span class="p">(),</span> <span class="n">marker</span><span class="o">=</span><span class="s1">&#39;x&#39;</span><span class="p">,</span> <span class="n">markersize</span><span class="o">=</span><span class="mi">20</span><span class="p">,</span> <span class="n">color</span> <span class="o">=</span> <span class="s1">&#39;b&#39;</span><span class="p">);</span> <span class="c1"># best val</span>
</span></span><span class="line"><span class="cl"><span class="n">ax2</span><span class="o">.</span><span class="n">set_xlabel</span><span class="p">(</span><span class="s1">&#39;Number of predictors&#39;</span><span class="p">,</span><span class="n">fontsize</span><span class="o">=</span><span class="mi">14</span><span class="p">);</span>
</span></span><span class="line"><span class="cl"><span class="n">ax2</span><span class="o">.</span><span class="n">set_ylabel</span><span class="p">(</span><span class="s1">&#39;BIC&#39;</span><span class="p">,</span><span class="n">fontsize</span><span class="o">=</span><span class="mi">14</span><span class="p">);</span>
</span></span><span class="line"><span class="cl"><span class="n">ax2</span><span class="o">.</span><span class="n">grid</span><span class="p">(</span><span class="n">color</span><span class="o">=</span><span class="s1">&#39;grey&#39;</span><span class="p">,</span> <span class="n">linestyle</span><span class="o">=</span><span class="s1">&#39;-&#39;</span><span class="p">,</span> <span class="n">linewidth</span><span class="o">=</span><span class="mf">0.5</span><span class="p">);</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="c1"># 3. R2_adj</span>
</span></span><span class="line"><span class="cl"><span class="n">ax3</span> <span class="o">=</span> <span class="n">fig</span><span class="o">.</span><span class="n">add_subplot</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="n">nfig</span><span class="p">,</span> <span class="mi">3</span><span class="p">)</span>
</span></span><span class="line"><span class="cl"><span class="n">ax3</span><span class="o">.</span><span class="n">scatter</span><span class="p">(</span><span class="n">df1</span><span class="p">[</span><span class="s1">&#39;numb_features&#39;</span><span class="p">],</span><span class="n">df1</span><span class="p">[</span><span class="s1">&#39;R_squared_adj&#39;</span><span class="p">],</span> <span class="n">alpha</span> <span class="o">=</span> <span class="mf">.5</span><span class="p">,</span> <span class="n">color</span> <span class="o">=</span> <span class="s1">&#39;darkblue&#39;</span><span class="p">);</span>
</span></span><span class="line"><span class="cl"><span class="n">ax3</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">df1</span><span class="p">[</span><span class="s1">&#39;numb_features&#39;</span><span class="p">],</span><span class="n">df1</span><span class="p">[</span><span class="s1">&#39;R_squared_adj&#39;</span><span class="p">],</span><span class="n">color</span> <span class="o">=</span> <span class="s1">&#39;r&#39;</span><span class="p">,</span> <span class="n">alpha</span> <span class="o">=</span> <span class="mf">.5</span><span class="p">);</span> <span class="c1"># line of best values</span>
</span></span><span class="line"><span class="cl"><span class="n">ax3</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">df1</span><span class="p">[</span><span class="s1">&#39;R_squared_adj&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">argmax</span><span class="p">()</span><span class="o">+</span><span class="mi">1</span><span class="p">,</span> <span class="n">df1</span><span class="p">[</span><span class="s1">&#39;R_squared_adj&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">max</span><span class="p">(),</span> <span class="n">marker</span><span class="o">=</span><span class="s1">&#39;x&#39;</span><span class="p">,</span> <span class="n">markersize</span><span class="o">=</span><span class="mi">20</span><span class="p">,</span> <span class="n">color</span> <span class="o">=</span> <span class="s1">&#39;b&#39;</span><span class="p">);</span> <span class="c1"># best val</span>
</span></span><span class="line"><span class="cl"><span class="n">ax3</span><span class="o">.</span><span class="n">set_xlabel</span><span class="p">(</span><span class="s1">&#39;Number of predictors&#39;</span><span class="p">,</span><span class="n">fontsize</span><span class="o">=</span><span class="mi">14</span><span class="p">);</span>
</span></span><span class="line"><span class="cl"><span class="n">ax3</span><span class="o">.</span><span class="n">set_ylabel</span><span class="p">(</span><span class="sa">r</span><span class="s1">&#39;$R^2$ adj&#39;</span><span class="p">,</span><span class="n">fontsize</span><span class="o">=</span><span class="mi">14</span><span class="p">);</span>
</span></span><span class="line"><span class="cl"><span class="n">ax3</span><span class="o">.</span><span class="n">grid</span><span class="p">(</span><span class="n">color</span><span class="o">=</span><span class="s1">&#39;grey&#39;</span><span class="p">,</span> <span class="n">linestyle</span><span class="o">=</span><span class="s1">&#39;-&#39;</span><span class="p">,</span> <span class="n">linewidth</span><span class="o">=</span><span class="mf">0.5</span><span class="p">);</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="n">fig</span><span class="o">.</span><span class="n">suptitle</span><span class="p">(</span><span class="s1">&#39;Best Subset Selection:</span><span class="se">\n</span><span class="s1"> Estimating test error by adjusting training error&#39;</span><span class="p">,</span><span class="n">fontsize</span><span class="o">=</span><span class="mi">25</span><span class="p">,</span> <span class="n">y</span><span class="o">=</span><span class="mf">0.98</span><span class="p">);</span>
</span></span><span class="line"><span class="cl"><span class="n">fig</span><span class="o">.</span><span class="n">subplots_adjust</span><span class="p">(</span><span class="n">top</span><span class="o">=</span><span class="mf">0.8</span><span class="p">)</span>
</span></span><span class="line"><span class="cl"><span class="n">fig</span><span class="o">.</span><span class="n">subplots_adjust</span><span class="p">(</span><span class="n">wspace</span><span class="o">=</span><span class="mf">0.275</span><span class="p">)</span> <span class="c1"># the amount of width reserved for blank space between subplots</span>
</span></span><span class="line"><span class="cl"><span class="n">plt</span><span class="o">.</span><span class="n">show</span><span class="p">();</span>
</span></span></code></pre></div><p>






  
  
<figure><img src="/posts/sl-ex3-subsetselection/output_32_0.png" alt="png" class="mx-auto my-0 rounded-md" />
</figure>
</p>
<h4>Attempt n.2: estimating AIC, BIC and R^2 adjusted by our own</h4>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-python" data-lang="python"><span class="line"><span class="cl"><span class="c1">#Initializing useful variables</span>
</span></span><span class="line"><span class="cl"><span class="n">n</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">Y_train</span><span class="p">)</span>
</span></span><span class="line"><span class="cl"><span class="n">d</span> <span class="o">=</span> <span class="n">df_BestS_RSS_train</span><span class="p">[</span><span class="s1">&#39;numb_features&#39;</span><span class="p">]</span>
</span></span><span class="line"><span class="cl"><span class="n">p</span> <span class="o">=</span> <span class="mi">8</span>
</span></span><span class="line"><span class="cl"><span class="n">RSS</span> <span class="o">=</span> <span class="n">df_BestS_RSS_train</span><span class="p">[</span><span class="s1">&#39;RSS_train&#39;</span><span class="p">]</span>
</span></span><span class="line"><span class="cl"><span class="n">Rsquared</span> <span class="o">=</span> <span class="n">df_BestS_RSS_train</span><span class="p">[</span><span class="s1">&#39;R_squared&#39;</span><span class="p">]</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="c1"># Estimation of sigma^2: RSE of the general multiple Linear regression with p features</span>
</span></span><span class="line"><span class="cl"><span class="n">RSE</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">sqrt</span><span class="p">(</span><span class="nb">min</span><span class="p">(</span><span class="n">RSS</span><span class="p">)</span><span class="o">/</span><span class="p">(</span><span class="n">n</span> <span class="o">-</span> <span class="n">p</span> <span class="o">-</span><span class="mi">1</span><span class="p">))</span>  <span class="c1"># min(RSS) is the RSS of the full model with p predictors</span>
</span></span><span class="line"><span class="cl"><span class="n">hat_sigma_squared</span> <span class="o">=</span> <span class="n">RSE</span><span class="o">**</span><span class="mi">2</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="c1">#Computing</span>
</span></span><span class="line"><span class="cl"><span class="n">AIC</span> <span class="o">=</span> <span class="p">(</span><span class="mi">1</span><span class="o">/</span><span class="p">(</span><span class="n">n</span><span class="o">*</span><span class="n">hat_sigma_squared</span><span class="p">))</span> <span class="o">*</span> <span class="p">(</span><span class="n">RSS</span> <span class="o">+</span> <span class="mi">2</span> <span class="o">*</span> <span class="n">d</span> <span class="o">*</span> <span class="n">hat_sigma_squared</span> <span class="p">)</span>
</span></span><span class="line"><span class="cl"><span class="n">BIC</span> <span class="o">=</span> <span class="p">(</span><span class="mi">1</span><span class="o">/</span><span class="p">(</span><span class="n">n</span><span class="o">*</span><span class="n">hat_sigma_squared</span><span class="p">))</span> <span class="o">*</span> <span class="p">(</span><span class="n">RSS</span> <span class="o">+</span>  <span class="n">np</span><span class="o">.</span><span class="n">log</span><span class="p">(</span><span class="n">n</span><span class="p">)</span> <span class="o">*</span> <span class="n">d</span> <span class="o">*</span> <span class="n">hat_sigma_squared</span> <span class="p">)</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="n">ratio</span> <span class="o">=</span> <span class="mi">1</span> <span class="o">-</span> <span class="n">Rsquared</span> <span class="c1"># RSS/TSS</span>
</span></span><span class="line"><span class="cl"><span class="n">R_squared_adj</span> <span class="o">=</span> <span class="mi">1</span> <span class="o">-</span> <span class="n">ratio</span><span class="o">*</span><span class="p">(</span><span class="n">n</span><span class="o">-</span><span class="mi">1</span><span class="p">)</span><span class="o">/</span><span class="p">(</span><span class="n">n</span><span class="o">-</span><span class="n">d</span><span class="o">-</span><span class="mi">1</span><span class="p">)</span>
</span></span></code></pre></div><div class="highlight"><pre tabindex="0" class="chroma"><code class="language-python" data-lang="python"><span class="line"><span class="cl"><span class="c1">#Store in DataFrame</span>
</span></span><span class="line"><span class="cl"><span class="n">df2</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">({</span><span class="s1">&#39;numb_features&#39;</span><span class="p">:</span> <span class="n">df_BestS_RSS_train</span><span class="p">[</span><span class="s1">&#39;numb_features&#39;</span><span class="p">],</span>\
</span></span><span class="line"><span class="cl">                    <span class="s1">&#39;RSS_train&#39;</span><span class="p">:</span> <span class="n">df_BestS_RSS_train</span><span class="p">[</span><span class="s1">&#39;RSS_train&#39;</span><span class="p">],</span>\
</span></span><span class="line"><span class="cl">                    <span class="s1">&#39;features&#39;</span><span class="p">:</span> <span class="n">df_BestS_RSS_train</span><span class="p">[</span><span class="s1">&#39;features&#39;</span><span class="p">],</span>\
</span></span><span class="line"><span class="cl">                    <span class="s1">&#39;AIC&#39;</span><span class="p">:</span> <span class="n">AIC</span><span class="p">,</span>\
</span></span><span class="line"><span class="cl">                    <span class="s1">&#39;BIC&#39;</span><span class="p">:</span> <span class="n">BIC</span><span class="p">,</span>\
</span></span><span class="line"><span class="cl">                    <span class="s1">&#39;R_squared_adj&#39;</span><span class="p">:</span> <span class="n">R_squared_adj</span><span class="p">})</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="n">df2</span>
</span></span></code></pre></div><div style="width:100%;overflow:scroll;">
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }
<pre><code>.dataframe tbody tr th {
    vertical-align: top;
}

.dataframe thead th {
    text-align: right;
}
</code></pre>
<p></style></p>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th style='text-align:center; vertical-align:middle'></th>
      <th style='text-align:center; vertical-align:middle'>numb_features</th>
      <th style='text-align:center; vertical-align:middle'>RSS_train</th>
      <th style='text-align:center; vertical-align:middle'>features</th>
      <th style='text-align:center; vertical-align:middle'>AIC</th>
      <th style='text-align:center; vertical-align:middle'>BIC</th>
      <th style='text-align:center; vertical-align:middle'>R_squared_adj</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th style='text-align:center; vertical-align:middle'>0</th>
      <td style='text-align:center; vertical-align:middle'>1</td>
      <td style='text-align:center; vertical-align:middle'>44.528583</td>
      <td style='text-align:center; vertical-align:middle'>(lcavol,)</td>
      <td style='text-align:center; vertical-align:middle'>1.339802</td>
      <td style='text-align:center; vertical-align:middle'>1.372708</td>
      <td style='text-align:center; vertical-align:middle'>0.530401</td>
    </tr>
    <tr>
      <th style='text-align:center; vertical-align:middle'>8</th>
      <td style='text-align:center; vertical-align:middle'>2</td>
      <td style='text-align:center; vertical-align:middle'>37.091846</td>
      <td style='text-align:center; vertical-align:middle'>(lcavol, lweight)</td>
      <td style='text-align:center; vertical-align:middle'>1.150877</td>
      <td style='text-align:center; vertical-align:middle'>1.216689</td>
      <td style='text-align:center; vertical-align:middle'>0.602717</td>
    </tr>
    <tr>
      <th style='text-align:center; vertical-align:middle'>38</th>
      <td style='text-align:center; vertical-align:middle'>3</td>
      <td style='text-align:center; vertical-align:middle'>34.907749</td>
      <td style='text-align:center; vertical-align:middle'>(lcavol, lweight, svi)</td>
      <td style='text-align:center; vertical-align:middle'>1.116476</td>
      <td style='text-align:center; vertical-align:middle'>1.215193</td>
      <td style='text-align:center; vertical-align:middle'>0.620176</td>
    </tr>
    <tr>
      <th style='text-align:center; vertical-align:middle'>97</th>
      <td style='text-align:center; vertical-align:middle'>4</td>
      <td style='text-align:center; vertical-align:middle'>32.814995</td>
      <td style='text-align:center; vertical-align:middle'>(lcavol, lweight, lbph, svi)</td>
      <td style='text-align:center; vertical-align:middle'>1.084761</td>
      <td style='text-align:center; vertical-align:middle'>1.216385</td>
      <td style='text-align:center; vertical-align:middle'>0.637188</td>
    </tr>
    <tr>
      <th style='text-align:center; vertical-align:middle'>174</th>
      <td style='text-align:center; vertical-align:middle'>5</td>
      <td style='text-align:center; vertical-align:middle'>32.069447</td>
      <td style='text-align:center; vertical-align:middle'>(lcavol, lweight, lbph, svi, pgg45)</td>
      <td style='text-align:center; vertical-align:middle'>1.092680</td>
      <td style='text-align:center; vertical-align:middle'>1.257209</td>
      <td style='text-align:center; vertical-align:middle'>0.639618</td>
    </tr>
    <tr>
      <th style='text-align:center; vertical-align:middle'>229</th>
      <td style='text-align:center; vertical-align:middle'>6</td>
      <td style='text-align:center; vertical-align:middle'>30.539778</td>
      <td style='text-align:center; vertical-align:middle'>(lcavol, lweight, lbph, svi, lcp, pgg45)</td>
      <td style='text-align:center; vertical-align:middle'>1.077530</td>
      <td style='text-align:center; vertical-align:middle'>1.274965</td>
      <td style='text-align:center; vertical-align:middle'>0.651088</td>
    </tr>
    <tr>
      <th style='text-align:center; vertical-align:middle'>247</th>
      <td style='text-align:center; vertical-align:middle'>7</td>
      <td style='text-align:center; vertical-align:middle'>29.437300</td>
      <td style='text-align:center; vertical-align:middle'>(lcavol, lweight, age, lbph, svi, lcp, pgg45)</td>
      <td style='text-align:center; vertical-align:middle'>1.074948</td>
      <td style='text-align:center; vertical-align:middle'>1.305289</td>
      <td style='text-align:center; vertical-align:middle'>0.657983</td>
    </tr>
    <tr>
      <th style='text-align:center; vertical-align:middle'>254</th>
      <td style='text-align:center; vertical-align:middle'>8</td>
      <td style='text-align:center; vertical-align:middle'>29.426384</td>
      <td style='text-align:center; vertical-align:middle'>(lcavol, lweight, age, lbph, svi, lcp, gleason...</td>
      <td style='text-align:center; vertical-align:middle'>1.104478</td>
      <td style='text-align:center; vertical-align:middle'>1.367724</td>
      <td style='text-align:center; vertical-align:middle'>0.652215</td>
    </tr>
  </tbody>
</table>
</div>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-python" data-lang="python"><span class="line"><span class="cl"><span class="c1"># Initialize the figure</span>
</span></span><span class="line"><span class="cl"><span class="n">width</span> <span class="o">=</span> <span class="mi">6</span>
</span></span><span class="line"><span class="cl"><span class="n">height</span> <span class="o">=</span> <span class="mi">6</span>
</span></span><span class="line"><span class="cl"><span class="n">nfig</span> <span class="o">=</span> <span class="mi">3</span>
</span></span><span class="line"><span class="cl"><span class="n">fig</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">figure</span><span class="p">(</span><span class="n">figsize</span> <span class="o">=</span> <span class="p">(</span><span class="n">width</span><span class="o">*</span><span class="n">nfig</span><span class="p">,</span><span class="n">height</span><span class="p">))</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="c1"># 1. AIC</span>
</span></span><span class="line"><span class="cl"><span class="n">ax1</span> <span class="o">=</span> <span class="n">fig</span><span class="o">.</span><span class="n">add_subplot</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="n">nfig</span><span class="p">,</span> <span class="mi">1</span><span class="p">)</span>
</span></span><span class="line"><span class="cl"><span class="n">ax1</span><span class="o">.</span><span class="n">scatter</span><span class="p">(</span><span class="n">df2</span><span class="p">[</span><span class="s1">&#39;numb_features&#39;</span><span class="p">],</span><span class="n">df2</span><span class="p">[</span><span class="s1">&#39;AIC&#39;</span><span class="p">],</span> <span class="n">alpha</span> <span class="o">=</span> <span class="mf">.5</span><span class="p">,</span> <span class="n">color</span> <span class="o">=</span> <span class="s1">&#39;darkblue&#39;</span><span class="p">);</span>
</span></span><span class="line"><span class="cl"><span class="n">ax1</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">df2</span><span class="p">[</span><span class="s1">&#39;numb_features&#39;</span><span class="p">],</span><span class="n">df2</span><span class="p">[</span><span class="s1">&#39;AIC&#39;</span><span class="p">],</span><span class="n">color</span> <span class="o">=</span> <span class="s1">&#39;r&#39;</span><span class="p">,</span> <span class="n">alpha</span> <span class="o">=</span> <span class="mf">.5</span><span class="p">);</span> <span class="c1"># line of best values</span>
</span></span><span class="line"><span class="cl"><span class="n">ax1</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">df2</span><span class="p">[</span><span class="s1">&#39;AIC&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">argmin</span><span class="p">()</span><span class="o">+</span><span class="mi">1</span><span class="p">,</span> <span class="n">df2</span><span class="p">[</span><span class="s1">&#39;AIC&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">min</span><span class="p">(),</span> <span class="n">marker</span><span class="o">=</span><span class="s1">&#39;x&#39;</span><span class="p">,</span> <span class="n">markersize</span><span class="o">=</span><span class="mi">20</span><span class="p">,</span> <span class="n">color</span> <span class="o">=</span> <span class="s1">&#39;b&#39;</span><span class="p">);</span> <span class="c1"># best val</span>
</span></span><span class="line"><span class="cl"><span class="n">ax1</span><span class="o">.</span><span class="n">set_xlabel</span><span class="p">(</span><span class="s1">&#39;Number of predictors&#39;</span><span class="p">,</span><span class="n">fontsize</span><span class="o">=</span><span class="mi">14</span><span class="p">);</span>
</span></span><span class="line"><span class="cl"><span class="n">ax1</span><span class="o">.</span><span class="n">set_ylabel</span><span class="p">(</span><span class="s1">&#39;AIC&#39;</span><span class="p">,</span><span class="n">fontsize</span><span class="o">=</span><span class="mi">14</span><span class="p">);</span>
</span></span><span class="line"><span class="cl"><span class="n">ax1</span><span class="o">.</span><span class="n">grid</span><span class="p">(</span><span class="n">color</span><span class="o">=</span><span class="s1">&#39;grey&#39;</span><span class="p">,</span> <span class="n">linestyle</span><span class="o">=</span><span class="s1">&#39;-&#39;</span><span class="p">,</span> <span class="n">linewidth</span><span class="o">=</span><span class="mf">0.5</span><span class="p">);</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="c1"># 2. BIC</span>
</span></span><span class="line"><span class="cl"><span class="n">ax2</span> <span class="o">=</span> <span class="n">fig</span><span class="o">.</span><span class="n">add_subplot</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="n">nfig</span><span class="p">,</span> <span class="mi">2</span><span class="p">)</span>
</span></span><span class="line"><span class="cl"><span class="n">ax2</span><span class="o">.</span><span class="n">scatter</span><span class="p">(</span><span class="n">df2</span><span class="p">[</span><span class="s1">&#39;numb_features&#39;</span><span class="p">],</span><span class="n">df2</span><span class="p">[</span><span class="s1">&#39;BIC&#39;</span><span class="p">],</span> <span class="n">alpha</span> <span class="o">=</span> <span class="mf">.5</span><span class="p">,</span> <span class="n">color</span> <span class="o">=</span> <span class="s1">&#39;darkblue&#39;</span><span class="p">);</span>
</span></span><span class="line"><span class="cl"><span class="n">ax2</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">df2</span><span class="p">[</span><span class="s1">&#39;numb_features&#39;</span><span class="p">],</span><span class="n">df2</span><span class="p">[</span><span class="s1">&#39;BIC&#39;</span><span class="p">],</span><span class="n">color</span> <span class="o">=</span> <span class="s1">&#39;r&#39;</span><span class="p">,</span> <span class="n">alpha</span> <span class="o">=</span> <span class="mf">.5</span><span class="p">);</span> <span class="c1"># line of best values</span>
</span></span><span class="line"><span class="cl"><span class="n">ax2</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">df2</span><span class="p">[</span><span class="s1">&#39;BIC&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">argmin</span><span class="p">()</span><span class="o">+</span><span class="mi">1</span><span class="p">,</span> <span class="n">df2</span><span class="p">[</span><span class="s1">&#39;BIC&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">min</span><span class="p">(),</span> <span class="n">marker</span><span class="o">=</span><span class="s1">&#39;x&#39;</span><span class="p">,</span> <span class="n">markersize</span><span class="o">=</span><span class="mi">20</span><span class="p">,</span> <span class="n">color</span> <span class="o">=</span> <span class="s1">&#39;b&#39;</span><span class="p">);</span> <span class="c1"># best val</span>
</span></span><span class="line"><span class="cl"><span class="n">ax2</span><span class="o">.</span><span class="n">set_xlabel</span><span class="p">(</span><span class="s1">&#39;Number of predictors&#39;</span><span class="p">,</span><span class="n">fontsize</span><span class="o">=</span><span class="mi">14</span><span class="p">);</span>
</span></span><span class="line"><span class="cl"><span class="n">ax2</span><span class="o">.</span><span class="n">set_ylabel</span><span class="p">(</span><span class="s1">&#39;BIC&#39;</span><span class="p">,</span><span class="n">fontsize</span><span class="o">=</span><span class="mi">14</span><span class="p">);</span>
</span></span><span class="line"><span class="cl"><span class="n">ax2</span><span class="o">.</span><span class="n">grid</span><span class="p">(</span><span class="n">color</span><span class="o">=</span><span class="s1">&#39;grey&#39;</span><span class="p">,</span> <span class="n">linestyle</span><span class="o">=</span><span class="s1">&#39;-&#39;</span><span class="p">,</span> <span class="n">linewidth</span><span class="o">=</span><span class="mf">0.5</span><span class="p">);</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="c1"># 3. R2_adj</span>
</span></span><span class="line"><span class="cl"><span class="n">ax3</span> <span class="o">=</span> <span class="n">fig</span><span class="o">.</span><span class="n">add_subplot</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="n">nfig</span><span class="p">,</span> <span class="mi">3</span><span class="p">)</span>
</span></span><span class="line"><span class="cl"><span class="n">ax3</span><span class="o">.</span><span class="n">scatter</span><span class="p">(</span><span class="n">df2</span><span class="p">[</span><span class="s1">&#39;numb_features&#39;</span><span class="p">],</span><span class="n">df2</span><span class="p">[</span><span class="s1">&#39;R_squared_adj&#39;</span><span class="p">],</span> <span class="n">alpha</span> <span class="o">=</span> <span class="mf">.5</span><span class="p">,</span> <span class="n">color</span> <span class="o">=</span> <span class="s1">&#39;darkblue&#39;</span><span class="p">);</span>
</span></span><span class="line"><span class="cl"><span class="n">ax3</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">df2</span><span class="p">[</span><span class="s1">&#39;numb_features&#39;</span><span class="p">],</span><span class="n">df2</span><span class="p">[</span><span class="s1">&#39;R_squared_adj&#39;</span><span class="p">],</span><span class="n">color</span> <span class="o">=</span> <span class="s1">&#39;r&#39;</span><span class="p">,</span> <span class="n">alpha</span> <span class="o">=</span> <span class="mf">.5</span><span class="p">);</span> <span class="c1"># line of best values</span>
</span></span><span class="line"><span class="cl"><span class="n">ax3</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">df2</span><span class="p">[</span><span class="s1">&#39;R_squared_adj&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">argmax</span><span class="p">()</span><span class="o">+</span><span class="mi">1</span><span class="p">,</span> <span class="n">df2</span><span class="p">[</span><span class="s1">&#39;R_squared_adj&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">max</span><span class="p">(),</span> <span class="n">marker</span><span class="o">=</span><span class="s1">&#39;x&#39;</span><span class="p">,</span> <span class="n">markersize</span><span class="o">=</span><span class="mi">20</span><span class="p">,</span> <span class="n">color</span> <span class="o">=</span> <span class="s1">&#39;b&#39;</span><span class="p">);</span> <span class="c1"># best val</span>
</span></span><span class="line"><span class="cl"><span class="n">ax3</span><span class="o">.</span><span class="n">set_xlabel</span><span class="p">(</span><span class="s1">&#39;Number of predictors&#39;</span><span class="p">,</span><span class="n">fontsize</span><span class="o">=</span><span class="mi">14</span><span class="p">);</span>
</span></span><span class="line"><span class="cl"><span class="n">ax3</span><span class="o">.</span><span class="n">set_ylabel</span><span class="p">(</span><span class="sa">r</span><span class="s1">&#39;$R^2$ adj&#39;</span><span class="p">,</span><span class="n">fontsize</span><span class="o">=</span><span class="mi">14</span><span class="p">);</span>
</span></span><span class="line"><span class="cl"><span class="n">ax3</span><span class="o">.</span><span class="n">grid</span><span class="p">(</span><span class="n">color</span><span class="o">=</span><span class="s1">&#39;grey&#39;</span><span class="p">,</span> <span class="n">linestyle</span><span class="o">=</span><span class="s1">&#39;-&#39;</span><span class="p">,</span> <span class="n">linewidth</span><span class="o">=</span><span class="mf">0.5</span><span class="p">);</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="n">fig</span><span class="o">.</span><span class="n">suptitle</span><span class="p">(</span><span class="s1">&#39;Best Subset Selection:</span><span class="se">\n</span><span class="s1"> Estimating test error by adjusting training error&#39;</span><span class="p">,</span><span class="n">fontsize</span><span class="o">=</span><span class="mi">25</span><span class="p">,</span> <span class="n">y</span><span class="o">=</span><span class="mf">0.98</span><span class="p">);</span>
</span></span><span class="line"><span class="cl"><span class="n">fig</span><span class="o">.</span><span class="n">subplots_adjust</span><span class="p">(</span><span class="n">top</span><span class="o">=</span><span class="mf">0.8</span><span class="p">)</span>
</span></span><span class="line"><span class="cl"><span class="n">fig</span><span class="o">.</span><span class="n">subplots_adjust</span><span class="p">(</span><span class="n">wspace</span><span class="o">=</span><span class="mf">0.275</span><span class="p">)</span> <span class="c1"># the amount of width reserved for blank space between subplots</span>
</span></span><span class="line"><span class="cl"><span class="n">plt</span><span class="o">.</span><span class="n">show</span><span class="p">();</span>
</span></span></code></pre></div><p>






  
  
<figure><img src="/posts/sl-ex3-subsetselection/output_36_0.png" alt="png" class="mx-auto my-0 rounded-md" />
</figure>
</p>
<h2 id="forward-selection" class="relative group"><strong>Forward selection</strong> <span class="absolute top-0 w-6 transition-opacity opacity-0 -start-6 not-prose group-hover:opacity-100"><a class="group-hover:text-primary-300 dark:group-hover:text-neutral-700" style="text-decoration-line: none !important;" href="#forward-selection" aria-label="Anchor">#</a></span></h2><p>For computational reasons, the best subset cannot be applied for any large n due to the \(2^n\) complexity.<br>
Forward Stepwise begins with a model containing no predictors, and then adds predictors to the model, one at the time. At each step, the variable that gives the greatest additional improvement to the fit is added to the model.</p>
<h4>7. Perform forward selection</h4>
<ul>
<li>Start from the empty model</li>
<li>Add at each step the variable that <strong>minimizes the RSS computed on test set</strong> (other performance measures can be used)</li>
</ul>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-python" data-lang="python"><span class="line"><span class="cl"><span class="c1"># to print some info:</span>
</span></span><span class="line"><span class="cl"><span class="n">flag</span> <span class="o">=</span> <span class="mi">1</span>
</span></span><span class="line"><span class="cl"><span class="n">detailed</span> <span class="o">=</span> <span class="mi">1</span>
</span></span></code></pre></div><div class="highlight"><pre tabindex="0" class="chroma"><code class="language-python" data-lang="python"><span class="line"><span class="cl"><span class="c1">## range</span>
</span></span><span class="line"><span class="cl"><span class="n">variables</span> <span class="o">=</span> <span class="n">data</span><span class="o">.</span><span class="n">columns</span><span class="o">.</span><span class="n">tolist</span><span class="p">()</span>
</span></span><span class="line"><span class="cl"><span class="n">remaining_features</span><span class="p">,</span> <span class="n">selected_features</span> <span class="o">=</span> <span class="n">variables</span><span class="o">.</span><span class="n">copy</span><span class="p">(),</span> <span class="p">[]</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="c1">## Initialize the list where we temporarily store data</span>
</span></span><span class="line"><span class="cl"><span class="n">RSS_test_list</span><span class="p">,</span> <span class="n">min_RSS_test_list</span><span class="p">,</span> <span class="n">R_squared_list</span> <span class="o">=</span> <span class="p">[],</span> <span class="p">[],</span> <span class="p">[]</span>
</span></span><span class="line"><span class="cl"><span class="n">numb_features</span><span class="p">,</span> <span class="n">features_list</span> <span class="o">=</span> <span class="p">[],</span> <span class="p">[]</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="c1"># Loop over the number of variables</span>
</span></span><span class="line"><span class="cl"><span class="k">for</span> <span class="n">k</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span><span class="nb">len</span><span class="p">(</span><span class="n">variables</span><span class="p">)</span><span class="o">+</span><span class="mi">1</span><span class="p">):</span>
</span></span><span class="line"><span class="cl">    
</span></span><span class="line"><span class="cl">    <span class="c1"># store some info for each k</span>
</span></span><span class="line"><span class="cl">    <span class="n">all_RSS</span><span class="p">,</span> <span class="n">all_R_squared</span><span class="p">,</span> <span class="n">all_combs</span> <span class="o">=</span> <span class="p">[],[],</span> <span class="p">[]</span>
</span></span><span class="line"><span class="cl">    <span class="n">best_RSS</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">inf</span> <span class="c1"># initialize the best RSS as +inf</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">    <span class="c1"># choose one variable in the remaining features</span>
</span></span><span class="line"><span class="cl">    <span class="k">for</span> <span class="n">var</span> <span class="ow">in</span> <span class="n">remaining_features</span><span class="p">:</span>
</span></span><span class="line"><span class="cl">        
</span></span><span class="line"><span class="cl">        <span class="n">tmpComb</span> <span class="o">=</span> <span class="n">selected_features</span> <span class="o">+</span> <span class="p">[</span><span class="n">var</span><span class="p">];</span> <span class="c1"># combination of variables</span>
</span></span><span class="line"><span class="cl">        
</span></span><span class="line"><span class="cl">        <span class="c1"># Compute all the statistics we need</span>
</span></span><span class="line"><span class="cl">        <span class="n">_</span><span class="p">,</span> <span class="n">RSS_test</span><span class="p">,</span> <span class="n">R_squared</span> <span class="o">=</span> <span class="n">LinReg</span><span class="p">(</span><span class="n">X_train</span><span class="p">[</span><span class="n">tmpComb</span><span class="p">],</span> <span class="n">Y_train</span><span class="p">,</span> <span class="n">X_test</span><span class="p">[</span><span class="n">tmpComb</span><span class="p">],</span> <span class="n">Y_test</span><span class="p">)</span> <span class="c1"># we don&#39;t want RSS on training set</span>
</span></span><span class="line"><span class="cl">        
</span></span><span class="line"><span class="cl">        <span class="c1"># save temporary stats</span>
</span></span><span class="line"><span class="cl">        <span class="n">all_RSS</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">RSS_test</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">        <span class="n">all_R_squared</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">R_squared</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">        <span class="n">all_combs</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">tmpComb</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">        <span class="c1"># update if we reach a better RSS</span>
</span></span><span class="line"><span class="cl">        <span class="k">if</span> <span class="n">RSS_test</span> <span class="o">&lt;</span> <span class="n">best_RSS</span><span class="p">:</span>
</span></span><span class="line"><span class="cl">            <span class="n">best_RSS</span> <span class="o">=</span> <span class="n">RSS_test</span>
</span></span><span class="line"><span class="cl">            <span class="n">best_R_squared</span> <span class="o">=</span> <span class="n">R_squared</span>
</span></span><span class="line"><span class="cl">            <span class="n">best_feature</span> <span class="o">=</span> <span class="n">var</span>
</span></span><span class="line"><span class="cl">   
</span></span><span class="line"><span class="cl">    <span class="c1"># Print some information, before upgrading the features</span>
</span></span><span class="line"><span class="cl">    <span class="k">if</span> <span class="n">flag</span> <span class="o">==</span> <span class="mi">1</span><span class="p">:</span>
</span></span><span class="line"><span class="cl">        <span class="n">features</span> <span class="o">=</span> <span class="p">[</span><span class="n">remaining_features</span><span class="p">,</span><span class="n">selected_features</span><span class="p">]</span>
</span></span><span class="line"><span class="cl">        <span class="n">params</span> <span class="o">=</span> <span class="p">[</span><span class="n">all_RSS</span><span class="p">,</span><span class="n">all_R_squared</span><span class="p">,</span><span class="n">all_combs</span><span class="p">]</span>
</span></span><span class="line"><span class="cl">        <span class="n">results</span> <span class="o">=</span> <span class="p">[</span><span class="n">best_feature</span><span class="p">,</span><span class="n">best_RSS</span><span class="p">]</span>
</span></span><span class="line"><span class="cl">        <span class="n">get_info_forwardS</span><span class="p">(</span><span class="n">k</span><span class="p">,</span><span class="n">features</span><span class="p">,</span><span class="n">params</span><span class="p">,</span><span class="n">results</span><span class="p">,</span><span class="n">detailed</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">        
</span></span><span class="line"><span class="cl">    <span class="c1"># Save the statistics</span>
</span></span><span class="line"><span class="cl">    <span class="n">RSS_test_list</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">all_RSS</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">    <span class="n">min_RSS_test_list</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">best_RSS</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">    <span class="n">R_squared_list</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">best_R_squared</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">    
</span></span><span class="line"><span class="cl">    <span class="c1"># Update variables for next loop</span>
</span></span><span class="line"><span class="cl">    <span class="n">selected_features</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">best_feature</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">    <span class="n">remaining_features</span><span class="o">.</span><span class="n">remove</span><span class="p">(</span><span class="n">best_feature</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">    <span class="c1"># Save features and number of features</span>
</span></span><span class="line"><span class="cl">    <span class="n">features_list</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">selected_features</span><span class="o">.</span><span class="n">copy</span><span class="p">())</span>
</span></span><span class="line"><span class="cl">    <span class="n">numb_features</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">selected_features</span><span class="p">))</span>
</span></span><span class="line"><span class="cl">    
</span></span><span class="line"><span class="cl"><span class="c1"># Store in DataFrame</span>
</span></span><span class="line"><span class="cl"><span class="n">df_ForwardS</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">({</span><span class="s1">&#39;numb_features&#39;</span><span class="p">:</span> <span class="n">numb_features</span><span class="p">,</span>\
</span></span><span class="line"><span class="cl">                            <span class="s1">&#39;RSS_test&#39;</span> <span class="p">:</span> <span class="n">RSS_test_list</span><span class="p">,</span>\
</span></span><span class="line"><span class="cl">                            <span class="s1">&#39;min_RSS_test&#39;</span><span class="p">:</span> <span class="n">min_RSS_test_list</span><span class="p">,</span>\
</span></span><span class="line"><span class="cl">                            <span class="s1">&#39;R_squared&#39;</span><span class="p">:</span> <span class="n">R_squared_list</span><span class="p">,</span>\
</span></span><span class="line"><span class="cl">                            <span class="s1">&#39;features&#39;</span><span class="p">:</span> <span class="n">features_list</span><span class="p">})</span>
</span></span></code></pre></div><pre><code>==========================================================================================
Iter n.1:
Choose 1-length combinations of the remaining variables

Remaining features: ['lcavol', 'lweight', 'age', 'lbph', 'svi', 'lcp', 'gleason', 'pgg45']
Features selected: []

Comb n.1: ['lcavol']
------------------------------------------------------------------------------------------
RSS test: 14.392161587304827
R_squared: 0.5375164690552883

Comb n.2: ['lweight']
------------------------------------------------------------------------------------------
RSS test: 30.402845602615997
R_squared: 0.23543378299009432

Comb n.3: ['age']
------------------------------------------------------------------------------------------
RSS test: 33.846748424133
R_squared: 0.05182105437299367

Comb n.4: ['lbph']
------------------------------------------------------------------------------------------
RSS test: 35.29877101280492
R_squared: 0.06913619684911343

Comb n.5: ['svi']
------------------------------------------------------------------------------------------
RSS test: 20.632078139876853
R_squared: 0.3101224985902339

Comb n.6: ['lcp']
------------------------------------------------------------------------------------------
RSS test: 16.34576112489144
R_squared: 0.23931977441332264

Comb n.7: ['gleason']
------------------------------------------------------------------------------------------
RSS test: 25.529830407597565
R_squared: 0.11725680432657692

Comb n.8: ['pgg45']
------------------------------------------------------------------------------------------
RSS test: 28.61697167270323
R_squared: 0.20074696985742568

Selected variables: lcavol
min RSS: 14.392161587304827
==========================================================================================

==========================================================================================
Iter n.2:
Choose 2-length combinations of the remaining variables

Remaining features: ['lweight', 'age', 'lbph', 'svi', 'lcp', 'gleason', 'pgg45']
Features selected: ['lcavol']

Comb n.1: ['lcavol', 'lweight']
------------------------------------------------------------------------------------------
RSS test: 14.77447043041511
R_squared: 0.614756035022443

Comb n.2: ['lcavol', 'age']
------------------------------------------------------------------------------------------
RSS test: 14.454316401468965
R_squared: 0.53785859616379

Comb n.3: ['lcavol', 'lbph']
------------------------------------------------------------------------------------------
RSS test: 16.237234684619743
R_squared: 0.5846312407995875

Comb n.4: ['lcavol', 'svi']
------------------------------------------------------------------------------------------
RSS test: 11.58358360007023
R_squared: 0.5605323092792945

Comb n.5: ['lcavol', 'lcp']
------------------------------------------------------------------------------------------
RSS test: 15.038931408454383
R_squared: 0.5381501805446671

Comb n.6: ['lcavol', 'gleason']
------------------------------------------------------------------------------------------
RSS test: 14.140851461764317
R_squared: 0.5386018755651162

Comb n.7: ['lcavol', 'pgg45']
------------------------------------------------------------------------------------------
RSS test: 13.827662568490943
R_squared: 0.5489982126930548

Selected variables: svi
min RSS: 11.58358360007023
==========================================================================================

==========================================================================================
Iter n.3:
Choose 3-length combinations of the remaining variables

Remaining features: ['lweight', 'age', 'lbph', 'lcp', 'gleason', 'pgg45']
Features selected: ['lcavol', 'svi']

Comb n.1: ['lcavol', 'svi', 'lweight']
------------------------------------------------------------------------------------------
RSS test: 12.015924403078804
R_squared: 0.6374405385171893

Comb n.2: ['lcavol', 'svi', 'age']
------------------------------------------------------------------------------------------
RSS test: 11.71416952499475
R_squared: 0.5612383365966047

Comb n.3: ['lcavol', 'svi', 'lbph']
------------------------------------------------------------------------------------------
RSS test: 14.353733928669755
R_squared: 0.6264131675413883

Comb n.4: ['lcavol', 'svi', 'lcp']
------------------------------------------------------------------------------------------
RSS test: 13.285116624863331
R_squared: 0.5714253936028364

Comb n.5: ['lcavol', 'svi', 'gleason']
------------------------------------------------------------------------------------------
RSS test: 11.484037587414818
R_squared: 0.5610054092768177

Comb n.6: ['lcavol', 'svi', 'pgg45']
------------------------------------------------------------------------------------------
RSS test: 11.632246428034497
R_squared: 0.5651377944544718

Selected variables: gleason
min RSS: 11.484037587414818
==========================================================================================

==========================================================================================
Iter n.4:
Choose 4-length combinations of the remaining variables

Remaining features: ['lweight', 'age', 'lbph', 'lcp', 'pgg45']
Features selected: ['lcavol', 'svi', 'gleason']

Comb n.1: ['lcavol', 'svi', 'gleason', 'lweight']
------------------------------------------------------------------------------------------
RSS test: 11.95602065641986
R_squared: 0.6405674126734184

Comb n.2: ['lcavol', 'svi', 'gleason', 'age']
------------------------------------------------------------------------------------------
RSS test: 11.612572746859495
R_squared: 0.5614561297716232

Comb n.3: ['lcavol', 'svi', 'gleason', 'lbph']
------------------------------------------------------------------------------------------
RSS test: 14.355178421938225
R_squared: 0.6266591566646609

Comb n.4: ['lcavol', 'svi', 'gleason', 'lcp']
------------------------------------------------------------------------------------------
RSS test: 13.185630584098526
R_squared: 0.5741698339447385

Comb n.5: ['lcavol', 'svi', 'gleason', 'pgg45']
------------------------------------------------------------------------------------------
RSS test: 11.919697961636555
R_squared: 0.5664871741058846

Selected variables: age
min RSS: 11.612572746859495
==========================================================================================

==========================================================================================
Iter n.5:
Choose 5-length combinations of the remaining variables

Remaining features: ['lweight', 'lbph', 'lcp', 'pgg45']
Features selected: ['lcavol', 'svi', 'gleason', 'age']

Comb n.1: ['lcavol', 'svi', 'gleason', 'age', 'lweight']
------------------------------------------------------------------------------------------
RSS test: 11.497691985782547
R_squared: 0.64510079253458

Comb n.2: ['lcavol', 'svi', 'gleason', 'age', 'lbph']
------------------------------------------------------------------------------------------
RSS test: 13.947298386201728
R_squared: 0.6294946547801643

Comb n.3: ['lcavol', 'svi', 'gleason', 'age', 'lcp']
------------------------------------------------------------------------------------------
RSS test: 13.234367776364218
R_squared: 0.574264491209014

Comb n.4: ['lcavol', 'svi', 'gleason', 'age', 'pgg45']
------------------------------------------------------------------------------------------
RSS test: 12.141763999596828
R_squared: 0.5670143538267589

Selected variables: lweight
min RSS: 11.497691985782547
==========================================================================================

==========================================================================================
Iter n.6:
Choose 6-length combinations of the remaining variables

Remaining features: ['lbph', 'lcp', 'pgg45']
Features selected: ['lcavol', 'svi', 'gleason', 'age', 'lweight']

Comb n.1: ['lcavol', 'svi', 'gleason', 'age', 'lweight', 'lbph']
------------------------------------------------------------------------------------------
RSS test: 12.98960324749752
R_squared: 0.6696630706385877

Comb n.2: ['lcavol', 'svi', 'gleason', 'age', 'lweight', 'lcp']
------------------------------------------------------------------------------------------
RSS test: 12.690514046312407
R_squared: 0.6563534839394491

Comb n.3: ['lcavol', 'svi', 'gleason', 'age', 'lweight', 'pgg45']
------------------------------------------------------------------------------------------
RSS test: 12.009380388381148
R_squared: 0.6505787510646934

Selected variables: pgg45
min RSS: 12.009380388381148
==========================================================================================

==========================================================================================
Iter n.7:
Choose 7-length combinations of the remaining variables

Remaining features: ['lbph', 'lcp']
Features selected: ['lcavol', 'svi', 'gleason', 'age', 'lweight', 'pgg45']

Comb n.1: ['lcavol', 'svi', 'gleason', 'age', 'lweight', 'pgg45', 'lbph']
------------------------------------------------------------------------------------------
RSS test: 13.834231490831279
R_squared: 0.6760051914465672

Comb n.2: ['lcavol', 'svi', 'gleason', 'age', 'lweight', 'pgg45', 'lcp']
------------------------------------------------------------------------------------------
RSS test: 14.702111705571856
R_squared: 0.6720997902395782

Selected variables: lbph
min RSS: 13.834231490831279
==========================================================================================

==========================================================================================
Iter n.8:
Choose 8-length combinations of the remaining variables

Remaining features: ['lcp']
Features selected: ['lcavol', 'svi', 'gleason', 'age', 'lweight', 'pgg45', 'lbph']

Comb n.1: ['lcavol', 'svi', 'gleason', 'age', 'lweight', 'pgg45', 'lbph', 'lcp']
------------------------------------------------------------------------------------------
RSS test: 15.638220165228002
R_squared: 0.6943711796768238

Selected variables: lcp
min RSS: 15.638220165228002
==========================================================================================
</code></pre>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-python" data-lang="python"><span class="line"><span class="cl"><span class="c1"># look at the result</span>
</span></span><span class="line"><span class="cl"><span class="n">df_ForwardS</span>
</span></span></code></pre></div><div style="width:100%;overflow:scroll;">
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }
<pre><code>.dataframe tbody tr th {
    vertical-align: top;
}

.dataframe thead th {
    text-align: right;
}
</code></pre>
<p></style></p>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th style='text-align:center; vertical-align:middle'></th>
      <th style='text-align:center; vertical-align:middle'>numb_features</th>
      <th style='text-align:center; vertical-align:middle'>RSS_test</th>
      <th style='text-align:center; vertical-align:middle'>min_RSS_test</th>
      <th style='text-align:center; vertical-align:middle'>R_squared</th>
      <th style='text-align:center; vertical-align:middle'>features</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th style='text-align:center; vertical-align:middle'>0</th>
      <td style='text-align:center; vertical-align:middle'>1</td>
      <td style='text-align:center; vertical-align:middle'>[14.392161587304827, 30.402845602615997, 33.84...</td>
      <td style='text-align:center; vertical-align:middle'>14.392162</td>
      <td style='text-align:center; vertical-align:middle'>0.537516</td>
      <td style='text-align:center; vertical-align:middle'>[lcavol]</td>
    </tr>
    <tr>
      <th style='text-align:center; vertical-align:middle'>1</th>
      <td style='text-align:center; vertical-align:middle'>2</td>
      <td style='text-align:center; vertical-align:middle'>[14.77447043041511, 14.454316401468965, 16.237...</td>
      <td style='text-align:center; vertical-align:middle'>11.583584</td>
      <td style='text-align:center; vertical-align:middle'>0.560532</td>
      <td style='text-align:center; vertical-align:middle'>[lcavol, svi]</td>
    </tr>
    <tr>
      <th style='text-align:center; vertical-align:middle'>2</th>
      <td style='text-align:center; vertical-align:middle'>3</td>
      <td style='text-align:center; vertical-align:middle'>[12.015924403078804, 11.71416952499475, 14.353...</td>
      <td style='text-align:center; vertical-align:middle'>11.484038</td>
      <td style='text-align:center; vertical-align:middle'>0.561005</td>
      <td style='text-align:center; vertical-align:middle'>[lcavol, svi, gleason]</td>
    </tr>
    <tr>
      <th style='text-align:center; vertical-align:middle'>3</th>
      <td style='text-align:center; vertical-align:middle'>4</td>
      <td style='text-align:center; vertical-align:middle'>[11.95602065641986, 11.612572746859495, 14.355...</td>
      <td style='text-align:center; vertical-align:middle'>11.612573</td>
      <td style='text-align:center; vertical-align:middle'>0.561456</td>
      <td style='text-align:center; vertical-align:middle'>[lcavol, svi, gleason, age]</td>
    </tr>
    <tr>
      <th style='text-align:center; vertical-align:middle'>4</th>
      <td style='text-align:center; vertical-align:middle'>5</td>
      <td style='text-align:center; vertical-align:middle'>[11.497691985782547, 13.947298386201728, 13.23...</td>
      <td style='text-align:center; vertical-align:middle'>11.497692</td>
      <td style='text-align:center; vertical-align:middle'>0.645101</td>
      <td style='text-align:center; vertical-align:middle'>[lcavol, svi, gleason, age, lweight]</td>
    </tr>
    <tr>
      <th style='text-align:center; vertical-align:middle'>5</th>
      <td style='text-align:center; vertical-align:middle'>6</td>
      <td style='text-align:center; vertical-align:middle'>[12.98960324749752, 12.690514046312407, 12.009...</td>
      <td style='text-align:center; vertical-align:middle'>12.009380</td>
      <td style='text-align:center; vertical-align:middle'>0.650579</td>
      <td style='text-align:center; vertical-align:middle'>[lcavol, svi, gleason, age, lweight, pgg45]</td>
    </tr>
    <tr>
      <th style='text-align:center; vertical-align:middle'>6</th>
      <td style='text-align:center; vertical-align:middle'>7</td>
      <td style='text-align:center; vertical-align:middle'>[13.834231490831279, 14.702111705571856]</td>
      <td style='text-align:center; vertical-align:middle'>13.834231</td>
      <td style='text-align:center; vertical-align:middle'>0.676005</td>
      <td style='text-align:center; vertical-align:middle'>[lcavol, svi, gleason, age, lweight, pgg45, lbph]</td>
    </tr>
    <tr>
      <th style='text-align:center; vertical-align:middle'>7</th>
      <td style='text-align:center; vertical-align:middle'>8</td>
      <td style='text-align:center; vertical-align:middle'>[15.638220165228002]</td>
      <td style='text-align:center; vertical-align:middle'>15.638220</td>
      <td style='text-align:center; vertical-align:middle'>0.694371</td>
      <td style='text-align:center; vertical-align:middle'>[lcavol, svi, gleason, age, lweight, pgg45, lb...</td>
    </tr>
  </tbody>
</table>
</div>
<h3 id="plot-for-forward-selection" class="relative group"><strong>Plot for Forward Selection</strong> <span class="absolute top-0 w-6 transition-opacity opacity-0 -start-6 not-prose group-hover:opacity-100"><a class="group-hover:text-primary-300 dark:group-hover:text-neutral-700" style="text-decoration-line: none !important;" href="#plot-for-forward-selection" aria-label="Anchor">#</a></span></h3><h4>8. Generate a chart having:</h4>
<pre><code>- x-axis: the subset size
- y-axis: the RSS for the test set of the models generated at step 7
</code></pre>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-python" data-lang="python"><span class="line"><span class="cl"><span class="c1"># Initialize the figure</span>
</span></span><span class="line"><span class="cl"><span class="n">width</span> <span class="o">=</span> <span class="mi">6</span>
</span></span><span class="line"><span class="cl"><span class="n">height</span> <span class="o">=</span> <span class="mi">6</span>
</span></span><span class="line"><span class="cl"><span class="n">nfig</span> <span class="o">=</span> <span class="mi">1</span>
</span></span><span class="line"><span class="cl"><span class="n">fig</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">figure</span><span class="p">(</span><span class="n">figsize</span> <span class="o">=</span> <span class="p">(</span><span class="n">width</span><span class="o">*</span><span class="n">nfig</span><span class="p">,</span><span class="n">height</span><span class="p">))</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="c1"># 1. RSS Test set plot</span>
</span></span><span class="line"><span class="cl"><span class="n">tmp_df</span> <span class="o">=</span> <span class="n">df_ForwardS</span><span class="p">;</span>
</span></span><span class="line"><span class="cl"><span class="n">ax</span> <span class="o">=</span> <span class="n">fig</span><span class="o">.</span><span class="n">add_subplot</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="n">nfig</span><span class="p">,</span> <span class="mi">1</span><span class="p">)</span>
</span></span><span class="line"><span class="cl"><span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span><span class="nb">len</span><span class="p">(</span><span class="n">tmp_df</span><span class="o">.</span><span class="n">RSS_test</span><span class="p">)):</span>
</span></span><span class="line"><span class="cl">    <span class="n">ax</span><span class="o">.</span><span class="n">scatter</span><span class="p">([</span><span class="n">tmp_df</span><span class="o">.</span><span class="n">numb_features</span><span class="p">[</span><span class="n">i</span><span class="p">]]</span><span class="o">*</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">tmp_df</span><span class="o">.</span><span class="n">RSS_test</span><span class="p">[</span><span class="n">i</span><span class="p">])),</span><span class="n">tmp_df</span><span class="o">.</span><span class="n">RSS_test</span><span class="p">[</span><span class="n">i</span><span class="p">],</span> <span class="n">alpha</span> <span class="o">=</span> <span class="mf">.2</span><span class="p">,</span> <span class="n">color</span> <span class="o">=</span> <span class="s1">&#39;darkblue&#39;</span><span class="p">);</span>
</span></span><span class="line"><span class="cl">    
</span></span><span class="line"><span class="cl"><span class="n">ax</span><span class="o">.</span><span class="n">set_xlabel</span><span class="p">(</span><span class="s1">&#39;Subset Size k&#39;</span><span class="p">,</span><span class="n">fontsize</span><span class="o">=</span><span class="mi">14</span><span class="p">);</span>
</span></span><span class="line"><span class="cl"><span class="n">ax</span><span class="o">.</span><span class="n">set_ylabel</span><span class="p">(</span><span class="s1">&#39;RSS&#39;</span><span class="p">,</span><span class="n">fontsize</span><span class="o">=</span><span class="mi">14</span><span class="p">);</span>
</span></span><span class="line"><span class="cl"><span class="n">ax</span><span class="o">.</span><span class="n">set_title</span><span class="p">(</span><span class="s1">&#39;RSS on test set&#39;</span><span class="p">,</span><span class="n">fontsize</span><span class="o">=</span><span class="mi">18</span><span class="p">);</span>
</span></span><span class="line"><span class="cl"><span class="n">ax</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">tmp_df</span><span class="o">.</span><span class="n">numb_features</span><span class="p">,</span><span class="n">tmp_df</span><span class="o">.</span><span class="n">min_RSS_test</span><span class="p">,</span><span class="n">color</span> <span class="o">=</span> <span class="s1">&#39;r&#39;</span><span class="p">,</span> <span class="n">label</span> <span class="o">=</span> <span class="s1">&#39;Best subset&#39;</span><span class="p">);</span> <span class="c1"># line of best values</span>
</span></span><span class="line"><span class="cl"><span class="n">ax</span><span class="o">.</span><span class="n">grid</span><span class="p">(</span><span class="n">color</span><span class="o">=</span><span class="s1">&#39;grey&#39;</span><span class="p">,</span> <span class="n">linestyle</span><span class="o">=</span><span class="s1">&#39;-&#39;</span><span class="p">,</span> <span class="n">linewidth</span><span class="o">=</span><span class="mf">0.5</span><span class="p">);</span>
</span></span><span class="line"><span class="cl"><span class="n">ax</span><span class="o">.</span><span class="n">legend</span><span class="p">();</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="n">fig</span><span class="o">.</span><span class="n">suptitle</span><span class="p">(</span><span class="s1">&#39;Forward Subset Selection&#39;</span><span class="p">,</span><span class="n">fontsize</span><span class="o">=</span><span class="mi">25</span><span class="p">,</span> <span class="n">y</span><span class="o">=</span><span class="mf">0.98</span><span class="p">);</span>
</span></span><span class="line"><span class="cl"><span class="n">fig</span><span class="o">.</span><span class="n">subplots_adjust</span><span class="p">(</span><span class="n">top</span><span class="o">=</span><span class="mf">0.8</span><span class="p">)</span>
</span></span><span class="line"><span class="cl"><span class="n">plt</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>
</span></span></code></pre></div><p>






  
  
<figure><img src="/posts/sl-ex3-subsetselection/output_37_0.png" alt="png" class="mx-auto my-0 rounded-md" />
</figure>
</p>
<h2 id="backward-selection" class="relative group"><strong>Backward selection</strong> <span class="absolute top-0 w-6 transition-opacity opacity-0 -start-6 not-prose group-hover:opacity-100"><a class="group-hover:text-primary-300 dark:group-hover:text-neutral-700" style="text-decoration-line: none !important;" href="#backward-selection" aria-label="Anchor">#</a></span></h2><p>Another alternative to best subset selection is Backward Stepwise Selection.<br>
Backward Stepwise begins with a model containing all the predictors, and then removes predictors to the model, one at the time. At each step, the variable that gives the least improvement to the fit is removed to the model.</p>
<p>Backward selection requires that the <strong>number of samples \(n\) is larger than the number of variables \(p\)</strong>. Instead, Forward selection can be used evene \(n&lt;p\).</p>
<h4>9. Perform backward selection</h4>
<ul>
<li>Start from the full model</li>
<li>Remove at each step the variable that minimizes the RSS (other performance measures can be used)</li>
</ul>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-python" data-lang="python"><span class="line"><span class="cl"><span class="c1"># a flag to print some info, values {0,1}</span>
</span></span><span class="line"><span class="cl"><span class="n">flag</span> <span class="o">=</span> <span class="mi">1</span>     <span class="c1"># for short info</span>
</span></span><span class="line"><span class="cl"><span class="n">detailed</span> <span class="o">=</span> <span class="mi">1</span>
</span></span></code></pre></div><div class="highlight"><pre tabindex="0" class="chroma"><code class="language-python" data-lang="python"><span class="line"><span class="cl"><span class="c1">## range</span>
</span></span><span class="line"><span class="cl"><span class="n">variables</span> <span class="o">=</span> <span class="n">data</span><span class="o">.</span><span class="n">columns</span><span class="o">.</span><span class="n">tolist</span><span class="p">()</span>         <span class="c1"># excluding &#39;const&#39;</span>
</span></span><span class="line"><span class="cl"><span class="n">remaining_features</span><span class="p">,</span> <span class="n">dropped_features_list</span> <span class="o">=</span> <span class="n">variables</span><span class="o">.</span><span class="n">copy</span><span class="p">(),</span> <span class="p">[]</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="c1">## Initialize the list where we temporarily store data</span>
</span></span><span class="line"><span class="cl"><span class="n">RSS_test_list</span><span class="p">,</span> <span class="n">min_RSS_test_list</span><span class="p">,</span> <span class="n">R_squared_list</span> <span class="o">=</span> <span class="p">[],</span> <span class="p">[],</span> <span class="p">[]</span>
</span></span><span class="line"><span class="cl"><span class="n">numb_features</span><span class="p">,</span> <span class="n">features_list</span> <span class="o">=</span> <span class="p">[],</span> <span class="p">[]</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="c1"># run over the number of variables</span>
</span></span><span class="line"><span class="cl"><span class="k">for</span> <span class="n">k</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">variables</span><span class="p">),</span><span class="mi">0</span><span class="p">,</span><span class="o">-</span><span class="mi">1</span><span class="p">):</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">    <span class="c1"># initialization</span>
</span></span><span class="line"><span class="cl">    <span class="n">best_RSS</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">inf</span>
</span></span><span class="line"><span class="cl">    <span class="n">all_RSS</span><span class="p">,</span> <span class="n">all_R_squared</span><span class="p">,</span> <span class="n">all_combs</span> <span class="o">=</span> <span class="p">[],[],</span> <span class="p">[]</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">    <span class="k">for</span> <span class="n">combo</span> <span class="ow">in</span> <span class="n">itertools</span><span class="o">.</span><span class="n">combinations</span><span class="p">(</span><span class="n">remaining_features</span><span class="p">,</span><span class="n">k</span><span class="p">):</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">        <span class="c1"># Compute the stats we need</span>
</span></span><span class="line"><span class="cl">        <span class="n">tmpComb</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="n">combo</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">        <span class="n">_</span><span class="p">,</span> <span class="n">RSS_test</span><span class="p">,</span> <span class="n">R_squared</span> <span class="o">=</span> <span class="n">LinReg</span><span class="p">(</span><span class="n">X_train</span><span class="p">[</span><span class="n">tmpComb</span><span class="p">],</span> <span class="n">Y_train</span><span class="p">,</span> <span class="n">X_test</span><span class="p">[</span><span class="n">tmpComb</span><span class="p">],</span> <span class="n">Y_test</span><span class="p">)</span> <span class="c1"># we don&#39;t want RSS on training set</span>
</span></span><span class="line"><span class="cl">        
</span></span><span class="line"><span class="cl">        <span class="c1"># store all the RSS</span>
</span></span><span class="line"><span class="cl">        <span class="n">all_RSS</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">RSS_test</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">        <span class="n">all_R_squared</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">R_squared</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">        <span class="n">all_combs</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">tmpComb</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">        
</span></span><span class="line"><span class="cl">        <span class="k">if</span> <span class="n">RSS_test</span> <span class="o">&lt;</span> <span class="n">best_RSS</span><span class="p">:</span>
</span></span><span class="line"><span class="cl">            <span class="n">best_RSS</span> <span class="o">=</span> <span class="n">RSS_test</span>
</span></span><span class="line"><span class="cl">            <span class="n">best_R_squared</span> <span class="o">=</span> <span class="n">R_squared</span>
</span></span><span class="line"><span class="cl">            <span class="n">dropped_list</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="nb">set</span><span class="p">(</span><span class="n">remaining_features</span><span class="p">)</span><span class="o">-</span><span class="nb">set</span><span class="p">(</span><span class="n">tmpComb</span><span class="p">))</span>
</span></span><span class="line"><span class="cl"> 
</span></span><span class="line"><span class="cl">    <span class="c1"># Print some information, before upgrading the features</span>
</span></span><span class="line"><span class="cl">    <span class="k">if</span> <span class="n">flag</span> <span class="o">==</span> <span class="mi">1</span><span class="p">:</span>
</span></span><span class="line"><span class="cl">        <span class="n">features</span> <span class="o">=</span> <span class="p">[</span><span class="n">remaining_features</span><span class="p">,</span><span class="n">dropped_features_list</span><span class="p">]</span>
</span></span><span class="line"><span class="cl">        <span class="n">params</span> <span class="o">=</span> <span class="p">[</span><span class="n">all_RSS</span><span class="p">,</span><span class="n">all_R_squared</span><span class="p">,</span><span class="n">all_combs</span><span class="p">]</span>
</span></span><span class="line"><span class="cl">        <span class="k">if</span> <span class="n">dropped_list</span><span class="p">:</span> <span class="c1"># only if dropped_feature is not an empty list</span>
</span></span><span class="line"><span class="cl">            <span class="n">dropped_feature</span> <span class="o">=</span> <span class="n">dropped_list</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
</span></span><span class="line"><span class="cl">            <span class="n">results</span> <span class="o">=</span> <span class="p">[</span><span class="n">dropped_feature</span><span class="p">,</span><span class="n">best_RSS</span><span class="p">]</span>
</span></span><span class="line"><span class="cl">        <span class="k">else</span><span class="p">:</span>
</span></span><span class="line"><span class="cl">            <span class="n">results</span> <span class="o">=</span> <span class="p">[[],</span><span class="n">best_RSS</span><span class="p">]</span>
</span></span><span class="line"><span class="cl">            
</span></span><span class="line"><span class="cl">        <span class="n">get_info_backwardS</span><span class="p">(</span><span class="n">k</span><span class="p">,</span><span class="n">features</span><span class="p">,</span><span class="n">params</span><span class="p">,</span><span class="n">results</span><span class="p">,</span><span class="n">detailed</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">        
</span></span><span class="line"><span class="cl">    <span class="c1"># Updating variables for next loop</span>
</span></span><span class="line"><span class="cl">    <span class="k">if</span> <span class="n">dropped_list</span><span class="p">:</span> <span class="c1"># only if dropped_feature is not an empty list</span>
</span></span><span class="line"><span class="cl">        <span class="n">dropped_feature</span> <span class="o">=</span> <span class="n">dropped_list</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
</span></span><span class="line"><span class="cl">        <span class="n">remaining_features</span><span class="o">.</span><span class="n">remove</span><span class="p">(</span><span class="n">dropped_feature</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">        <span class="n">dropped_features_list</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">dropped_feature</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">    <span class="k">else</span><span class="p">:</span>
</span></span><span class="line"><span class="cl">        <span class="n">dropped_features_list</span><span class="o">.</span><span class="n">append</span><span class="p">([])</span> <span class="c1"># at the initial iteration we drop nothing!</span>
</span></span><span class="line"><span class="cl">        
</span></span><span class="line"><span class="cl">    <span class="c1"># Save stats</span>
</span></span><span class="line"><span class="cl">    <span class="n">min_RSS_test_list</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">best_RSS</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">    <span class="n">RSS_test_list</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">all_RSS</span><span class="o">.</span><span class="n">copy</span><span class="p">())</span>
</span></span><span class="line"><span class="cl">    <span class="n">R_squared_list</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">best_R_squared</span><span class="o">.</span><span class="n">copy</span><span class="p">())</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">    <span class="c1"># Save features and number of features</span>
</span></span><span class="line"><span class="cl">    <span class="n">numb_features</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">remaining_features</span><span class="p">))</span>
</span></span><span class="line"><span class="cl">    <span class="n">features_list</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">remaining_features</span><span class="o">.</span><span class="n">copy</span><span class="p">())</span>
</span></span><span class="line"><span class="cl">    
</span></span><span class="line"><span class="cl"><span class="c1"># Store in DataFrame</span>
</span></span><span class="line"><span class="cl"><span class="n">df_BackwardS</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">({</span><span class="s1">&#39;numb_features&#39;</span><span class="p">:</span> <span class="n">numb_features</span><span class="p">,</span>\
</span></span><span class="line"><span class="cl">                             <span class="s1">&#39;RSS_test&#39;</span> <span class="p">:</span> <span class="n">RSS_test_list</span><span class="p">,</span>\
</span></span><span class="line"><span class="cl">                             <span class="s1">&#39;min_RSS_test&#39;</span><span class="p">:</span> <span class="n">min_RSS_test_list</span><span class="p">,</span>\
</span></span><span class="line"><span class="cl">                             <span class="s1">&#39;R_squared&#39;</span><span class="p">:</span> <span class="n">R_squared_list</span><span class="p">,</span>\
</span></span><span class="line"><span class="cl">                             <span class="s1">&#39;dropped_feature&#39;</span><span class="p">:</span> <span class="n">dropped_features_list</span><span class="p">,</span>\
</span></span><span class="line"><span class="cl">                             <span class="s1">&#39;features&#39;</span><span class="p">:</span> <span class="n">features_list</span><span class="p">})</span>
</span></span></code></pre></div><pre><code>==========================================================================================
Iter n.0:

At the beginning we have:
Remaining features: ['lcavol', 'lweight', 'age', 'lbph', 'svi', 'lcp', 'gleason', 'pgg45']
Dropped features: []

Now we compare the model selecting 8 variables


Comb n.1: ['lcavol', 'lweight', 'age', 'lbph', 'svi', 'lcp', 'gleason', 'pgg45']
------------------------------------------------------------------------------------------
candidate dropped feature: []
RSS test: 15.638220165228002


At the end we have:
min RSS: 15.638220165228002
We drop: []
==========================================================================================

==========================================================================================
Iter n.1:

At the beginning we have:
Remaining features: ['lcavol', 'lweight', 'age', 'lbph', 'svi', 'lcp', 'gleason', 'pgg45']
Dropped features: [[]]

Now we compare the model selecting 7 variables


Comb n.1: ['lcavol', 'lweight', 'age', 'lbph', 'svi', 'lcp', 'gleason']
------------------------------------------------------------------------------------------
candidate dropped feature: ['pgg45']
RSS test: 13.492898446056923


Comb n.2: ['lcavol', 'lweight', 'age', 'lbph', 'svi', 'lcp', 'pgg45']
------------------------------------------------------------------------------------------
candidate dropped feature: ['gleason']
RSS test: 15.495404626758


Comb n.3: ['lcavol', 'lweight', 'age', 'lbph', 'svi', 'gleason', 'pgg45']
------------------------------------------------------------------------------------------
candidate dropped feature: ['lcp']
RSS test: 13.83423149083128


Comb n.4: ['lcavol', 'lweight', 'age', 'lbph', 'lcp', 'gleason', 'pgg45']
------------------------------------------------------------------------------------------
candidate dropped feature: ['svi']
RSS test: 17.516627850269806


Comb n.5: ['lcavol', 'lweight', 'age', 'svi', 'lcp', 'gleason', 'pgg45']
------------------------------------------------------------------------------------------
candidate dropped feature: ['lbph']
RSS test: 14.702111705571852


Comb n.6: ['lcavol', 'lweight', 'lbph', 'svi', 'lcp', 'gleason', 'pgg45']
------------------------------------------------------------------------------------------
candidate dropped feature: ['age']
RSS test: 17.03455209459629


Comb n.7: ['lcavol', 'age', 'lbph', 'svi', 'lcp', 'gleason', 'pgg45']
------------------------------------------------------------------------------------------
candidate dropped feature: ['lweight']
RSS test: 16.754443499511755


Comb n.8: ['lweight', 'age', 'lbph', 'svi', 'lcp', 'gleason', 'pgg45']
------------------------------------------------------------------------------------------
candidate dropped feature: ['lcavol']
RSS test: 22.63332934025175


At the end we have:
min RSS: 13.492898446056923
We drop: pgg45
==========================================================================================

==========================================================================================
Iter n.2:

At the beginning we have:
Remaining features: ['lcavol', 'lweight', 'age', 'lbph', 'svi', 'lcp', 'gleason']
Dropped features: [[], 'pgg45']

Now we compare the model selecting 6 variables


Comb n.1: ['lcavol', 'lweight', 'age', 'lbph', 'svi', 'lcp']
------------------------------------------------------------------------------------------
candidate dropped feature: ['gleason']
RSS test: 13.43573406046562


Comb n.2: ['lcavol', 'lweight', 'age', 'lbph', 'svi', 'gleason']
------------------------------------------------------------------------------------------
candidate dropped feature: ['lcp']
RSS test: 12.98960324749752


Comb n.3: ['lcavol', 'lweight', 'age', 'lbph', 'lcp', 'gleason']
------------------------------------------------------------------------------------------
candidate dropped feature: ['svi']
RSS test: 15.244637591703853


Comb n.4: ['lcavol', 'lweight', 'age', 'svi', 'lcp', 'gleason']
------------------------------------------------------------------------------------------
candidate dropped feature: ['lbph']
RSS test: 12.690514046312394


Comb n.5: ['lcavol', 'lweight', 'lbph', 'svi', 'lcp', 'gleason']
------------------------------------------------------------------------------------------
candidate dropped feature: ['age']
RSS test: 14.300531209782973


Comb n.6: ['lcavol', 'age', 'lbph', 'svi', 'lcp', 'gleason']
------------------------------------------------------------------------------------------
candidate dropped feature: ['lweight']
RSS test: 14.364169507348384


Comb n.7: ['lweight', 'age', 'lbph', 'svi', 'lcp', 'gleason']
------------------------------------------------------------------------------------------
candidate dropped feature: ['lcavol']
RSS test: 20.7394303261079


At the end we have:
min RSS: 12.690514046312394
We drop: lbph
==========================================================================================

==========================================================================================
Iter n.3:

At the beginning we have:
Remaining features: ['lcavol', 'lweight', 'age', 'svi', 'lcp', 'gleason']
Dropped features: [[], 'pgg45', 'lbph']

Now we compare the model selecting 5 variables


Comb n.1: ['lcavol', 'lweight', 'age', 'svi', 'lcp']
------------------------------------------------------------------------------------------
candidate dropped feature: ['gleason']
RSS test: 12.70021855056121


Comb n.2: ['lcavol', 'lweight', 'age', 'svi', 'gleason']
------------------------------------------------------------------------------------------
candidate dropped feature: ['lcp']
RSS test: 11.497691985782552


Comb n.3: ['lcavol', 'lweight', 'age', 'lcp', 'gleason']
------------------------------------------------------------------------------------------
candidate dropped feature: ['svi']
RSS test: 14.720875322787679


Comb n.4: ['lcavol', 'lweight', 'svi', 'lcp', 'gleason']
------------------------------------------------------------------------------------------
candidate dropped feature: ['age']
RSS test: 13.183227370610318


Comb n.5: ['lcavol', 'age', 'svi', 'lcp', 'gleason']
------------------------------------------------------------------------------------------
candidate dropped feature: ['lweight']
RSS test: 13.23436777636421


Comb n.6: ['lweight', 'age', 'svi', 'lcp', 'gleason']
------------------------------------------------------------------------------------------
candidate dropped feature: ['lcavol']
RSS test: 16.98150806110247


At the end we have:
min RSS: 11.497691985782552
We drop: lcp
==========================================================================================

==========================================================================================
Iter n.4:

At the beginning we have:
Remaining features: ['lcavol', 'lweight', 'age', 'svi', 'gleason']
Dropped features: [[], 'pgg45', 'lbph', 'lcp']

Now we compare the model selecting 4 variables


Comb n.1: ['lcavol', 'lweight', 'age', 'svi']
------------------------------------------------------------------------------------------
candidate dropped feature: ['gleason']
RSS test: 11.6363032699816


Comb n.2: ['lcavol', 'lweight', 'age', 'gleason']
------------------------------------------------------------------------------------------
candidate dropped feature: ['svi']
RSS test: 14.030539349222018


Comb n.3: ['lcavol', 'lweight', 'svi', 'gleason']
------------------------------------------------------------------------------------------
candidate dropped feature: ['age']
RSS test: 11.956020656419863


Comb n.4: ['lcavol', 'age', 'svi', 'gleason']
------------------------------------------------------------------------------------------
candidate dropped feature: ['lweight']
RSS test: 11.612572746859495


Comb n.5: ['lweight', 'age', 'svi', 'gleason']
------------------------------------------------------------------------------------------
candidate dropped feature: ['lcavol']
RSS test: 18.093182817451503


At the end we have:
min RSS: 11.612572746859495
We drop: lweight
==========================================================================================

==========================================================================================
Iter n.5:

At the beginning we have:
Remaining features: ['lcavol', 'age', 'svi', 'gleason']
Dropped features: [[], 'pgg45', 'lbph', 'lcp', 'lweight']

Now we compare the model selecting 3 variables


Comb n.1: ['lcavol', 'age', 'svi']
------------------------------------------------------------------------------------------
candidate dropped feature: ['gleason']
RSS test: 11.71416952499475


Comb n.2: ['lcavol', 'age', 'gleason']
------------------------------------------------------------------------------------------
candidate dropped feature: ['svi']
RSS test: 14.18793001209106


Comb n.3: ['lcavol', 'svi', 'gleason']
------------------------------------------------------------------------------------------
candidate dropped feature: ['age']
RSS test: 11.484037587414818


Comb n.4: ['age', 'svi', 'gleason']
------------------------------------------------------------------------------------------
candidate dropped feature: ['lcavol']
RSS test: 19.78197534246865


At the end we have:
min RSS: 11.484037587414818
We drop: age
==========================================================================================

==========================================================================================
Iter n.6:

At the beginning we have:
Remaining features: ['lcavol', 'svi', 'gleason']
Dropped features: [[], 'pgg45', 'lbph', 'lcp', 'lweight', 'age']

Now we compare the model selecting 2 variables


Comb n.1: ['lcavol', 'svi']
------------------------------------------------------------------------------------------
candidate dropped feature: ['gleason']
RSS test: 11.58358360007023


Comb n.2: ['lcavol', 'gleason']
------------------------------------------------------------------------------------------
candidate dropped feature: ['svi']
RSS test: 14.140851461764317


Comb n.3: ['svi', 'gleason']
------------------------------------------------------------------------------------------
candidate dropped feature: ['lcavol']
RSS test: 18.710131293690928


At the end we have:
min RSS: 11.58358360007023
We drop: gleason
==========================================================================================

==========================================================================================
Iter n.7:

At the beginning we have:
Remaining features: ['lcavol', 'svi']
Dropped features: [[], 'pgg45', 'lbph', 'lcp', 'lweight', 'age', 'gleason']

Now we compare the model selecting 1 variables


Comb n.1: ['lcavol']
------------------------------------------------------------------------------------------
candidate dropped feature: ['svi']
RSS test: 14.392161587304827


Comb n.2: ['svi']
------------------------------------------------------------------------------------------
candidate dropped feature: ['lcavol']
RSS test: 20.632078139876853


At the end we have:
min RSS: 14.392161587304827
We drop: svi
==========================================================================================
</code></pre>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-python" data-lang="python"><span class="line"><span class="cl"><span class="c1"># look at the result</span>
</span></span><span class="line"><span class="cl"><span class="n">df_BackwardS</span>
</span></span></code></pre></div><div style="width:100%;overflow:scroll;">
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }
<pre><code>.dataframe tbody tr th {
    vertical-align: top;
}

.dataframe thead th {
    text-align: right;
}
</code></pre>
<p></style></p>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th style='text-align:center; vertical-align:middle'></th>
      <th style='text-align:center; vertical-align:middle'>numb_features</th>
      <th style='text-align:center; vertical-align:middle'>RSS_test</th>
      <th style='text-align:center; vertical-align:middle'>min_RSS_test</th>
      <th style='text-align:center; vertical-align:middle'>R_squared</th>
      <th style='text-align:center; vertical-align:middle'>dropped_feature</th>
      <th style='text-align:center; vertical-align:middle'>features</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th style='text-align:center; vertical-align:middle'>0</th>
      <td style='text-align:center; vertical-align:middle'>8</td>
      <td style='text-align:center; vertical-align:middle'>[15.638220165228002]</td>
      <td style='text-align:center; vertical-align:middle'>15.638220</td>
      <td style='text-align:center; vertical-align:middle'>0.694371</td>
      <td style='text-align:center; vertical-align:middle'>[]</td>
      <td style='text-align:center; vertical-align:middle'>[lcavol, lweight, age, lbph, svi, lcp, gleason...</td>
    </tr>
    <tr>
      <th style='text-align:center; vertical-align:middle'>1</th>
      <td style='text-align:center; vertical-align:middle'>7</td>
      <td style='text-align:center; vertical-align:middle'>[13.492898446056923, 15.495404626758, 13.83423...</td>
      <td style='text-align:center; vertical-align:middle'>13.492898</td>
      <td style='text-align:center; vertical-align:middle'>0.678457</td>
      <td style='text-align:center; vertical-align:middle'>pgg45</td>
      <td style='text-align:center; vertical-align:middle'>[lcavol, lweight, age, lbph, svi, lcp, gleason]</td>
    </tr>
    <tr>
      <th style='text-align:center; vertical-align:middle'>2</th>
      <td style='text-align:center; vertical-align:middle'>6</td>
      <td style='text-align:center; vertical-align:middle'>[13.43573406046562, 12.98960324749752, 15.2446...</td>
      <td style='text-align:center; vertical-align:middle'>12.690514</td>
      <td style='text-align:center; vertical-align:middle'>0.656353</td>
      <td style='text-align:center; vertical-align:middle'>lbph</td>
      <td style='text-align:center; vertical-align:middle'>[lcavol, lweight, age, svi, lcp, gleason]</td>
    </tr>
    <tr>
      <th style='text-align:center; vertical-align:middle'>3</th>
      <td style='text-align:center; vertical-align:middle'>5</td>
      <td style='text-align:center; vertical-align:middle'>[12.70021855056121, 11.497691985782552, 14.720...</td>
      <td style='text-align:center; vertical-align:middle'>11.497692</td>
      <td style='text-align:center; vertical-align:middle'>0.645101</td>
      <td style='text-align:center; vertical-align:middle'>lcp</td>
      <td style='text-align:center; vertical-align:middle'>[lcavol, lweight, age, svi, gleason]</td>
    </tr>
    <tr>
      <th style='text-align:center; vertical-align:middle'>4</th>
      <td style='text-align:center; vertical-align:middle'>4</td>
      <td style='text-align:center; vertical-align:middle'>[11.6363032699816, 14.030539349222018, 11.9560...</td>
      <td style='text-align:center; vertical-align:middle'>11.612573</td>
      <td style='text-align:center; vertical-align:middle'>0.561456</td>
      <td style='text-align:center; vertical-align:middle'>lweight</td>
      <td style='text-align:center; vertical-align:middle'>[lcavol, age, svi, gleason]</td>
    </tr>
    <tr>
      <th style='text-align:center; vertical-align:middle'>5</th>
      <td style='text-align:center; vertical-align:middle'>3</td>
      <td style='text-align:center; vertical-align:middle'>[11.71416952499475, 14.18793001209106, 11.4840...</td>
      <td style='text-align:center; vertical-align:middle'>11.484038</td>
      <td style='text-align:center; vertical-align:middle'>0.561005</td>
      <td style='text-align:center; vertical-align:middle'>age</td>
      <td style='text-align:center; vertical-align:middle'>[lcavol, svi, gleason]</td>
    </tr>
    <tr>
      <th style='text-align:center; vertical-align:middle'>6</th>
      <td style='text-align:center; vertical-align:middle'>2</td>
      <td style='text-align:center; vertical-align:middle'>[11.58358360007023, 14.140851461764317, 18.710...</td>
      <td style='text-align:center; vertical-align:middle'>11.583584</td>
      <td style='text-align:center; vertical-align:middle'>0.560532</td>
      <td style='text-align:center; vertical-align:middle'>gleason</td>
      <td style='text-align:center; vertical-align:middle'>[lcavol, svi]</td>
    </tr>
    <tr>
      <th style='text-align:center; vertical-align:middle'>7</th>
      <td style='text-align:center; vertical-align:middle'>1</td>
      <td style='text-align:center; vertical-align:middle'>[14.392161587304827, 20.632078139876853]</td>
      <td style='text-align:center; vertical-align:middle'>14.392162</td>
      <td style='text-align:center; vertical-align:middle'>0.537516</td>
      <td style='text-align:center; vertical-align:middle'>svi</td>
      <td style='text-align:center; vertical-align:middle'>[lcavol]</td>
    </tr>
  </tbody>
</table>
</div>
<h3 id="plot-for-backward-selection" class="relative group"><strong>Plot for Backward Selection</strong> <span class="absolute top-0 w-6 transition-opacity opacity-0 -start-6 not-prose group-hover:opacity-100"><a class="group-hover:text-primary-300 dark:group-hover:text-neutral-700" style="text-decoration-line: none !important;" href="#plot-for-backward-selection" aria-label="Anchor">#</a></span></h3><div class="highlight"><pre tabindex="0" class="chroma"><code class="language-python" data-lang="python"><span class="line"><span class="cl"><span class="c1"># Initialize the figure</span>
</span></span><span class="line"><span class="cl"><span class="n">width</span> <span class="o">=</span> <span class="mi">6</span>
</span></span><span class="line"><span class="cl"><span class="n">height</span> <span class="o">=</span> <span class="mi">6</span>
</span></span><span class="line"><span class="cl"><span class="n">nfig</span> <span class="o">=</span> <span class="mi">1</span>
</span></span><span class="line"><span class="cl"><span class="n">fig</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">figure</span><span class="p">(</span><span class="n">figsize</span> <span class="o">=</span> <span class="p">(</span><span class="n">width</span><span class="o">*</span><span class="n">nfig</span><span class="p">,</span><span class="n">height</span><span class="p">))</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="c1"># 1. RSS Test set plot</span>
</span></span><span class="line"><span class="cl"><span class="n">tmp_df</span> <span class="o">=</span> <span class="n">df_BackwardS</span><span class="p">;</span>
</span></span><span class="line"><span class="cl"><span class="n">ax</span> <span class="o">=</span> <span class="n">fig</span><span class="o">.</span><span class="n">add_subplot</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="n">nfig</span><span class="p">,</span> <span class="mi">1</span><span class="p">)</span>
</span></span><span class="line"><span class="cl"><span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span><span class="nb">len</span><span class="p">(</span><span class="n">tmp_df</span><span class="o">.</span><span class="n">RSS_test</span><span class="p">)):</span>
</span></span><span class="line"><span class="cl">    <span class="n">ax</span><span class="o">.</span><span class="n">scatter</span><span class="p">([</span><span class="n">tmp_df</span><span class="o">.</span><span class="n">numb_features</span><span class="p">[</span><span class="n">i</span><span class="p">]]</span><span class="o">*</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">tmp_df</span><span class="o">.</span><span class="n">RSS_test</span><span class="p">[</span><span class="n">i</span><span class="p">])),</span><span class="n">tmp_df</span><span class="o">.</span><span class="n">RSS_test</span><span class="p">[</span><span class="n">i</span><span class="p">],</span> <span class="n">alpha</span> <span class="o">=</span> <span class="mf">.2</span><span class="p">,</span> <span class="n">color</span> <span class="o">=</span> <span class="s1">&#39;darkblue&#39;</span><span class="p">);</span>
</span></span><span class="line"><span class="cl">    
</span></span><span class="line"><span class="cl"><span class="n">ax</span><span class="o">.</span><span class="n">set_xlabel</span><span class="p">(</span><span class="s1">&#39;Subset Size k&#39;</span><span class="p">,</span><span class="n">fontsize</span><span class="o">=</span><span class="mi">14</span><span class="p">);</span>
</span></span><span class="line"><span class="cl"><span class="n">ax</span><span class="o">.</span><span class="n">set_ylabel</span><span class="p">(</span><span class="s1">&#39;RSS&#39;</span><span class="p">,</span><span class="n">fontsize</span><span class="o">=</span><span class="mi">14</span><span class="p">);</span>
</span></span><span class="line"><span class="cl"><span class="n">ax</span><span class="o">.</span><span class="n">set_title</span><span class="p">(</span><span class="s1">&#39;RSS on test set&#39;</span><span class="p">,</span><span class="n">fontsize</span><span class="o">=</span><span class="mi">18</span><span class="p">);</span>
</span></span><span class="line"><span class="cl"><span class="n">ax</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">tmp_df</span><span class="o">.</span><span class="n">numb_features</span><span class="p">,</span><span class="n">tmp_df</span><span class="o">.</span><span class="n">min_RSS_test</span><span class="p">,</span><span class="n">color</span> <span class="o">=</span> <span class="s1">&#39;r&#39;</span><span class="p">,</span> <span class="n">label</span> <span class="o">=</span> <span class="s1">&#39;Best subset&#39;</span><span class="p">);</span> <span class="c1"># line of best values</span>
</span></span><span class="line"><span class="cl"><span class="n">ax</span><span class="o">.</span><span class="n">grid</span><span class="p">(</span><span class="n">color</span><span class="o">=</span><span class="s1">&#39;grey&#39;</span><span class="p">,</span> <span class="n">linestyle</span><span class="o">=</span><span class="s1">&#39;-&#39;</span><span class="p">,</span> <span class="n">linewidth</span><span class="o">=</span><span class="mf">0.5</span><span class="p">);</span>
</span></span><span class="line"><span class="cl"><span class="n">ax</span><span class="o">.</span><span class="n">legend</span><span class="p">();</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="n">fig</span><span class="o">.</span><span class="n">suptitle</span><span class="p">(</span><span class="s1">&#39;Backward Subset Selection&#39;</span><span class="p">,</span><span class="n">fontsize</span><span class="o">=</span><span class="mi">25</span><span class="p">,</span> <span class="n">y</span><span class="o">=</span><span class="mf">0.98</span><span class="p">);</span>
</span></span><span class="line"><span class="cl"><span class="n">fig</span><span class="o">.</span><span class="n">subplots_adjust</span><span class="p">(</span><span class="n">top</span><span class="o">=</span><span class="mf">0.8</span><span class="p">)</span>
</span></span><span class="line"><span class="cl"><span class="n">plt</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>
</span></span></code></pre></div><p>






  
  
<figure><img src="/posts/sl-ex3-subsetselection/output_44_0.png" alt="png" class="mx-auto my-0 rounded-md" />
</figure>
</p>
<h2 id="comparison-subset-selection-methods" class="relative group"><strong>Comparison subset selection methods</strong> <span class="absolute top-0 w-6 transition-opacity opacity-0 -start-6 not-prose group-hover:opacity-100"><a class="group-hover:text-primary-300 dark:group-hover:text-neutral-700" style="text-decoration-line: none !important;" href="#comparison-subset-selection-methods" aria-label="Anchor">#</a></span></h2><p>Comparison between Best, Forward and Backward Selction results on test set</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-python" data-lang="python"><span class="line"><span class="cl"><span class="c1"># Initialize the figure</span>
</span></span><span class="line"><span class="cl"><span class="n">width</span> <span class="o">=</span> <span class="mi">6</span>
</span></span><span class="line"><span class="cl"><span class="n">height</span> <span class="o">=</span> <span class="mi">6</span>
</span></span><span class="line"><span class="cl"><span class="n">nfig</span> <span class="o">=</span> <span class="mi">3</span>
</span></span><span class="line"><span class="cl"><span class="n">fig</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">figure</span><span class="p">(</span><span class="n">figsize</span> <span class="o">=</span> <span class="p">(</span><span class="n">width</span><span class="o">*</span><span class="n">nfig</span><span class="p">,</span><span class="n">height</span><span class="p">))</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="c1"># 1. BEST SUBSET SELECTION</span>
</span></span><span class="line"><span class="cl"><span class="n">tmp_df1</span> <span class="o">=</span> <span class="n">df_BestS</span><span class="p">;</span>           <span class="c1"># scatter plot</span>
</span></span><span class="line"><span class="cl"><span class="n">tmp_df2</span> <span class="o">=</span> <span class="n">df_BestS_RSS_test</span><span class="p">;</span> <span class="c1"># plot the line of best values</span>
</span></span><span class="line"><span class="cl"><span class="n">ax</span> <span class="o">=</span> <span class="n">fig</span><span class="o">.</span><span class="n">add_subplot</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="n">nfig</span><span class="p">,</span> <span class="mi">1</span><span class="p">)</span>
</span></span><span class="line"><span class="cl"><span class="n">ax</span><span class="o">.</span><span class="n">scatter</span><span class="p">(</span><span class="n">tmp_df1</span><span class="o">.</span><span class="n">numb_features</span><span class="p">,</span><span class="n">tmp_df1</span><span class="o">.</span><span class="n">RSS_test</span><span class="p">,</span> <span class="n">alpha</span> <span class="o">=</span> <span class="mf">.2</span><span class="p">,</span> <span class="n">color</span> <span class="o">=</span> <span class="s1">&#39;darkblue&#39;</span><span class="p">);</span>
</span></span><span class="line"><span class="cl"><span class="n">ax</span><span class="o">.</span><span class="n">set_xlabel</span><span class="p">(</span><span class="s1">&#39;Subset Size k&#39;</span><span class="p">,</span><span class="n">fontsize</span><span class="o">=</span><span class="mi">14</span><span class="p">);</span>
</span></span><span class="line"><span class="cl"><span class="n">ax</span><span class="o">.</span><span class="n">set_ylabel</span><span class="p">(</span><span class="s1">&#39;RSS&#39;</span><span class="p">,</span><span class="n">fontsize</span><span class="o">=</span><span class="mi">14</span><span class="p">);</span>
</span></span><span class="line"><span class="cl"><span class="n">ax</span><span class="o">.</span><span class="n">set_title</span><span class="p">(</span><span class="s1">&#39;Best Selection&#39;</span><span class="p">,</span><span class="n">fontsize</span><span class="o">=</span><span class="mi">18</span><span class="p">);</span>
</span></span><span class="line"><span class="cl"><span class="n">ax</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">tmp_df2</span><span class="o">.</span><span class="n">numb_features</span><span class="p">,</span><span class="n">tmp_df2</span><span class="o">.</span><span class="n">RSS_test</span><span class="p">,</span><span class="n">color</span> <span class="o">=</span> <span class="s1">&#39;r&#39;</span><span class="p">,</span> <span class="n">label</span> <span class="o">=</span> <span class="s1">&#39;Best subset&#39;</span><span class="p">);</span> <span class="c1"># line of best values</span>
</span></span><span class="line"><span class="cl"><span class="n">ax</span><span class="o">.</span><span class="n">grid</span><span class="p">(</span><span class="n">color</span><span class="o">=</span><span class="s1">&#39;grey&#39;</span><span class="p">,</span> <span class="n">linestyle</span><span class="o">=</span><span class="s1">&#39;-&#39;</span><span class="p">,</span> <span class="n">linewidth</span><span class="o">=</span><span class="mf">0.5</span><span class="p">);</span>
</span></span><span class="line"><span class="cl"><span class="n">ax</span><span class="o">.</span><span class="n">legend</span><span class="p">();</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="c1"># 2. FORWARD SUBSET SELECTION</span>
</span></span><span class="line"><span class="cl"><span class="n">tmp_df</span> <span class="o">=</span> <span class="n">df_ForwardS</span><span class="p">;</span>
</span></span><span class="line"><span class="cl"><span class="n">ax</span> <span class="o">=</span> <span class="n">fig</span><span class="o">.</span><span class="n">add_subplot</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="n">nfig</span><span class="p">,</span> <span class="mi">2</span><span class="p">)</span>
</span></span><span class="line"><span class="cl"><span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span><span class="nb">len</span><span class="p">(</span><span class="n">tmp_df</span><span class="o">.</span><span class="n">RSS_test</span><span class="p">)):</span>
</span></span><span class="line"><span class="cl">    <span class="n">ax</span><span class="o">.</span><span class="n">scatter</span><span class="p">([</span><span class="n">tmp_df</span><span class="o">.</span><span class="n">numb_features</span><span class="p">[</span><span class="n">i</span><span class="p">]]</span><span class="o">*</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">tmp_df</span><span class="o">.</span><span class="n">RSS_test</span><span class="p">[</span><span class="n">i</span><span class="p">])),</span><span class="n">tmp_df</span><span class="o">.</span><span class="n">RSS_test</span><span class="p">[</span><span class="n">i</span><span class="p">],</span> <span class="n">alpha</span> <span class="o">=</span> <span class="mf">.2</span><span class="p">,</span> <span class="n">color</span> <span class="o">=</span> <span class="s1">&#39;darkblue&#39;</span><span class="p">);</span>
</span></span><span class="line"><span class="cl">    
</span></span><span class="line"><span class="cl"><span class="n">ax</span><span class="o">.</span><span class="n">set_xlabel</span><span class="p">(</span><span class="s1">&#39;Subset Size k&#39;</span><span class="p">,</span><span class="n">fontsize</span><span class="o">=</span><span class="mi">14</span><span class="p">);</span>
</span></span><span class="line"><span class="cl"><span class="n">ax</span><span class="o">.</span><span class="n">set_ylabel</span><span class="p">(</span><span class="s1">&#39;RSS&#39;</span><span class="p">,</span><span class="n">fontsize</span><span class="o">=</span><span class="mi">14</span><span class="p">);</span>
</span></span><span class="line"><span class="cl"><span class="n">ax</span><span class="o">.</span><span class="n">set_title</span><span class="p">(</span><span class="s1">&#39;Forward Selection&#39;</span><span class="p">,</span><span class="n">fontsize</span><span class="o">=</span><span class="mi">18</span><span class="p">);</span>
</span></span><span class="line"><span class="cl"><span class="n">ax</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">tmp_df</span><span class="o">.</span><span class="n">numb_features</span><span class="p">,</span><span class="n">tmp_df</span><span class="o">.</span><span class="n">min_RSS_test</span><span class="p">,</span><span class="n">color</span> <span class="o">=</span> <span class="s1">&#39;r&#39;</span><span class="p">,</span> <span class="n">label</span> <span class="o">=</span> <span class="s1">&#39;Best subset&#39;</span><span class="p">);</span> <span class="c1"># line of best values</span>
</span></span><span class="line"><span class="cl"><span class="n">ax</span><span class="o">.</span><span class="n">grid</span><span class="p">(</span><span class="n">color</span><span class="o">=</span><span class="s1">&#39;grey&#39;</span><span class="p">,</span> <span class="n">linestyle</span><span class="o">=</span><span class="s1">&#39;-&#39;</span><span class="p">,</span> <span class="n">linewidth</span><span class="o">=</span><span class="mf">0.5</span><span class="p">);</span>
</span></span><span class="line"><span class="cl"><span class="n">ax</span><span class="o">.</span><span class="n">legend</span><span class="p">();</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="c1"># 3. BACKWARD SUBSET SELECTION</span>
</span></span><span class="line"><span class="cl"><span class="n">tmp_df</span> <span class="o">=</span> <span class="n">df_BackwardS</span><span class="p">;</span>
</span></span><span class="line"><span class="cl"><span class="n">ax</span> <span class="o">=</span> <span class="n">fig</span><span class="o">.</span><span class="n">add_subplot</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="n">nfig</span><span class="p">,</span> <span class="mi">3</span><span class="p">)</span>
</span></span><span class="line"><span class="cl"><span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span><span class="nb">len</span><span class="p">(</span><span class="n">tmp_df</span><span class="o">.</span><span class="n">RSS_test</span><span class="p">)):</span>
</span></span><span class="line"><span class="cl">    <span class="n">ax</span><span class="o">.</span><span class="n">scatter</span><span class="p">([</span><span class="n">tmp_df</span><span class="o">.</span><span class="n">numb_features</span><span class="p">[</span><span class="n">i</span><span class="p">]]</span><span class="o">*</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">tmp_df</span><span class="o">.</span><span class="n">RSS_test</span><span class="p">[</span><span class="n">i</span><span class="p">])),</span><span class="n">tmp_df</span><span class="o">.</span><span class="n">RSS_test</span><span class="p">[</span><span class="n">i</span><span class="p">],</span> <span class="n">alpha</span> <span class="o">=</span> <span class="mf">.2</span><span class="p">,</span> <span class="n">color</span> <span class="o">=</span> <span class="s1">&#39;darkblue&#39;</span><span class="p">);</span>
</span></span><span class="line"><span class="cl">    
</span></span><span class="line"><span class="cl"><span class="n">ax</span><span class="o">.</span><span class="n">set_xlabel</span><span class="p">(</span><span class="s1">&#39;Subset Size k&#39;</span><span class="p">,</span><span class="n">fontsize</span><span class="o">=</span><span class="mi">14</span><span class="p">);</span>
</span></span><span class="line"><span class="cl"><span class="n">ax</span><span class="o">.</span><span class="n">set_ylabel</span><span class="p">(</span><span class="s1">&#39;RSS&#39;</span><span class="p">,</span><span class="n">fontsize</span><span class="o">=</span><span class="mi">14</span><span class="p">);</span>
</span></span><span class="line"><span class="cl"><span class="n">ax</span><span class="o">.</span><span class="n">set_title</span><span class="p">(</span><span class="s1">&#39;Backward Selection&#39;</span><span class="p">,</span><span class="n">fontsize</span><span class="o">=</span><span class="mi">18</span><span class="p">);</span>
</span></span><span class="line"><span class="cl"><span class="n">ax</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">tmp_df</span><span class="o">.</span><span class="n">numb_features</span><span class="p">,</span><span class="n">tmp_df</span><span class="o">.</span><span class="n">min_RSS_test</span><span class="p">,</span><span class="n">color</span> <span class="o">=</span> <span class="s1">&#39;r&#39;</span><span class="p">,</span> <span class="n">label</span> <span class="o">=</span> <span class="s1">&#39;Best subset&#39;</span><span class="p">);</span> <span class="c1"># line of best values</span>
</span></span><span class="line"><span class="cl"><span class="n">ax</span><span class="o">.</span><span class="n">grid</span><span class="p">(</span><span class="n">color</span><span class="o">=</span><span class="s1">&#39;grey&#39;</span><span class="p">,</span> <span class="n">linestyle</span><span class="o">=</span><span class="s1">&#39;-&#39;</span><span class="p">,</span> <span class="n">linewidth</span><span class="o">=</span><span class="mf">0.5</span><span class="p">);</span>
</span></span><span class="line"><span class="cl"><span class="n">ax</span><span class="o">.</span><span class="n">legend</span><span class="p">();</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="n">fig</span><span class="o">.</span><span class="n">suptitle</span><span class="p">(</span><span class="s1">&#39;Comparison Subset Selection&#39;</span><span class="p">,</span><span class="n">fontsize</span><span class="o">=</span><span class="mi">25</span><span class="p">,</span> <span class="n">y</span><span class="o">=</span><span class="mf">0.98</span><span class="p">);</span>
</span></span><span class="line"><span class="cl"><span class="n">fig</span><span class="o">.</span><span class="n">subplots_adjust</span><span class="p">(</span><span class="n">top</span><span class="o">=</span><span class="mf">0.8</span><span class="p">)</span>
</span></span><span class="line"><span class="cl"><span class="n">plt</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>
</span></span></code></pre></div><p>






  
  
<figure><img src="/posts/sl-ex3-subsetselection/output_46_0.png" alt="png" class="mx-auto my-0 rounded-md" />
</figure>
</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-python" data-lang="python"><span class="line"><span class="cl"><span class="c1"># Initialize the figure</span>
</span></span><span class="line"><span class="cl"><span class="n">width</span> <span class="o">=</span> <span class="mi">6</span>
</span></span><span class="line"><span class="cl"><span class="n">height</span> <span class="o">=</span> <span class="mi">6</span>
</span></span><span class="line"><span class="cl"><span class="n">nfig</span> <span class="o">=</span> <span class="mi">1</span>
</span></span><span class="line"><span class="cl"><span class="n">fig</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">figure</span><span class="p">(</span><span class="n">figsize</span> <span class="o">=</span> <span class="p">(</span><span class="n">width</span><span class="o">*</span><span class="n">nfig</span><span class="p">,</span><span class="n">height</span><span class="p">))</span>
</span></span><span class="line"><span class="cl"><span class="n">ax</span> <span class="o">=</span> <span class="n">fig</span><span class="o">.</span><span class="n">add_subplot</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="n">nfig</span><span class="p">,</span> <span class="mi">1</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="c1"># Best Selection</span>
</span></span><span class="line"><span class="cl"><span class="n">ax</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">df_BestS_RSS_test</span><span class="o">.</span><span class="n">numb_features</span><span class="p">,</span><span class="n">df_BestS_RSS_test</span><span class="o">.</span><span class="n">RSS_test</span><span class="p">,</span><span class="n">color</span> <span class="o">=</span> <span class="s1">&#39;r&#39;</span><span class="p">,</span> <span class="n">label</span> <span class="o">=</span> <span class="s1">&#39;Best subset&#39;</span><span class="p">);</span> <span class="c1"># line of best values</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="c1"># Forward Selection</span>
</span></span><span class="line"><span class="cl"><span class="n">ax</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">df_ForwardS</span><span class="o">.</span><span class="n">numb_features</span><span class="p">,</span><span class="n">df_ForwardS</span><span class="o">.</span><span class="n">min_RSS_test</span><span class="p">,</span><span class="n">color</span> <span class="o">=</span> <span class="s1">&#39;b&#39;</span><span class="p">,</span> <span class="n">label</span> <span class="o">=</span> <span class="s1">&#39;Best subset&#39;</span><span class="p">);</span> <span class="c1"># line of best values</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="c1"># Backward Selection</span>
</span></span><span class="line"><span class="cl"><span class="n">ax</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">df_BackwardS</span><span class="o">.</span><span class="n">numb_features</span><span class="p">,</span><span class="n">df_BackwardS</span><span class="o">.</span><span class="n">min_RSS_test</span><span class="p">,</span><span class="n">color</span> <span class="o">=</span> <span class="s1">&#39;g&#39;</span><span class="p">,</span> <span class="n">label</span> <span class="o">=</span> <span class="s1">&#39;Best subset&#39;</span><span class="p">);</span> <span class="c1"># line of best values</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="n">ax</span><span class="o">.</span><span class="n">grid</span><span class="p">(</span><span class="n">color</span><span class="o">=</span><span class="s1">&#39;grey&#39;</span><span class="p">,</span> <span class="n">linestyle</span><span class="o">=</span><span class="s1">&#39;-&#39;</span><span class="p">,</span> <span class="n">linewidth</span><span class="o">=</span><span class="mf">0.5</span><span class="p">);</span>
</span></span><span class="line"><span class="cl"><span class="n">ax</span><span class="o">.</span><span class="n">set_xlabel</span><span class="p">(</span><span class="s1">&#39;Subset Size k&#39;</span><span class="p">,</span><span class="n">fontsize</span><span class="o">=</span><span class="mi">14</span><span class="p">);</span>
</span></span><span class="line"><span class="cl"><span class="n">ax</span><span class="o">.</span><span class="n">set_ylabel</span><span class="p">(</span><span class="s1">&#39;RSS&#39;</span><span class="p">,</span><span class="n">fontsize</span><span class="o">=</span><span class="mi">14</span><span class="p">);</span>
</span></span><span class="line"><span class="cl"><span class="n">ax</span><span class="o">.</span><span class="n">set_title</span><span class="p">(</span><span class="s1">&#39;Comparison minimum RSS&#39;</span><span class="p">,</span><span class="n">fontsize</span><span class="o">=</span><span class="mi">18</span><span class="p">);</span>
</span></span><span class="line"><span class="cl"><span class="n">ax</span><span class="o">.</span><span class="n">legend</span><span class="p">([</span><span class="s1">&#39;best&#39;</span><span class="p">,</span><span class="s1">&#39;forward&#39;</span><span class="p">,</span><span class="s1">&#39;backward&#39;</span><span class="p">])</span>
</span></span><span class="line"><span class="cl">    
</span></span><span class="line"><span class="cl"><span class="n">plt</span><span class="o">.</span><span class="n">show</span><span class="p">();</span>
</span></span></code></pre></div><p>






  
  
<figure><img src="/posts/sl-ex3-subsetselection/output_47_0.png" alt="png" class="mx-auto my-0 rounded-md" />
</figure>
</p>
<h4>Best method from Subset Selection</h4>
<p>We see below the results of Best, Forward and Backward Subset Selection.</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-python" data-lang="python"><span class="line"><span class="cl"><span class="n">df_range</span> <span class="o">=</span> <span class="p">[</span><span class="n">df_BestS_RSS_test</span><span class="p">,</span> <span class="n">df_ForwardS</span><span class="p">,</span> <span class="n">df_BackwardS</span><span class="p">]</span>
</span></span><span class="line"><span class="cl"><span class="n">columns_range</span> <span class="o">=</span> <span class="p">[</span><span class="s1">&#39;RSS_test&#39;</span><span class="p">,</span><span class="s1">&#39;min_RSS_test&#39;</span><span class="p">,</span><span class="s1">&#39;min_RSS_test&#39;</span><span class="p">]</span>
</span></span><span class="line"><span class="cl"><span class="n">methods</span> <span class="o">=</span> <span class="p">[</span><span class="s1">&#39;Best Selection&#39;</span><span class="p">,</span> <span class="s1">&#39;Forward Selection&#39;</span><span class="p">,</span> <span class="s1">&#39;Backward Selection&#39;</span><span class="p">]</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="k">for</span> <span class="n">df</span><span class="p">,</span> <span class="n">col</span><span class="p">,</span> <span class="n">meth</span> <span class="ow">in</span> <span class="nb">zip</span><span class="p">(</span><span class="n">df_range</span><span class="p">,</span><span class="n">columns_range</span><span class="p">,</span><span class="n">methods</span><span class="p">):</span>
</span></span><span class="line"><span class="cl">    
</span></span><span class="line"><span class="cl">    <span class="n">idx</span> <span class="o">=</span> <span class="n">df</span><span class="p">[</span><span class="n">col</span><span class="p">]</span><span class="o">.</span><span class="n">idxmin</span><span class="p">()</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">    <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&#34;</span><span class="se">\n</span><span class="s2">For </span><span class="si">{</span><span class="n">meth</span><span class="si">}</span><span class="s2"> the best method has:</span><span class="se">\n\
</span></span></span><span class="line"><span class="cl"><span class="se"></span><span class="s2">n. features: </span><span class="si">{</span><span class="n">df</span><span class="p">[</span><span class="s1">&#39;numb_features&#39;</span><span class="p">][</span><span class="n">idx</span><span class="p">]</span><span class="si">}</span><span class="se">\n\
</span></span></span><span class="line"><span class="cl"><span class="se"></span><span class="s2">features: </span><span class="si">{</span><span class="n">df</span><span class="p">[</span><span class="s1">&#39;features&#39;</span><span class="p">][</span><span class="n">idx</span><span class="p">]</span><span class="si">}</span><span class="se">\n\
</span></span></span><span class="line"><span class="cl"><span class="se"></span><span class="s2">RSS test: </span><span class="si">{</span><span class="n">df</span><span class="p">[</span><span class="n">col</span><span class="p">][</span><span class="n">idx</span><span class="p">]</span><span class="si">}</span><span class="se">\n</span><span class="s2">&#34;</span><span class="p">)</span>
</span></span></code></pre></div><pre><code>For Best Selection the best method has:
n. features: 3
features: ('lcavol', 'svi', 'gleason')
RSS test: 11.484037587414818


For Forward Selection the best method has:
n. features: 3
features: ['lcavol', 'svi', 'gleason']
RSS test: 11.484037587414818


For Backward Selection the best method has:
n. features: 3
features: ['lcavol', 'svi', 'gleason']
RSS test: 11.484037587414818
</code></pre>
<h2 id="backward-selection-with-z-score" class="relative group"><strong>Backward selection with Z-score</strong> <span class="absolute top-0 w-6 transition-opacity opacity-0 -start-6 not-prose group-hover:opacity-100"><a class="group-hover:text-primary-300 dark:group-hover:text-neutral-700" style="text-decoration-line: none !important;" href="#backward-selection-with-z-score" aria-label="Anchor">#</a></span></h2><h4>11. Perform backward selection using the z-score as a statistics for selecting the predictor to drop</h4>
<pre><code>* Start from the full model
* Remove at each step the variable having the smallest Z-score (which library is more suitable for this purpose?)
</code></pre>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-python" data-lang="python"><span class="line"><span class="cl"><span class="c1"># a flag to print some info, values {0,1}</span>
</span></span><span class="line"><span class="cl"><span class="n">flag</span> <span class="o">=</span> <span class="mi">1</span>     <span class="c1"># for short info</span>
</span></span></code></pre></div><div class="highlight"><pre tabindex="0" class="chroma"><code class="language-python" data-lang="python"><span class="line"><span class="cl"><span class="c1">## range</span>
</span></span><span class="line"><span class="cl"><span class="n">variables</span> <span class="o">=</span> <span class="n">data</span><span class="o">.</span><span class="n">columns</span><span class="o">.</span><span class="n">tolist</span><span class="p">()</span>         <span class="c1"># excluding &#39;const&#39;</span>
</span></span><span class="line"><span class="cl"><span class="n">remaining_features</span> <span class="o">=</span> <span class="n">variables</span><span class="o">.</span><span class="n">copy</span><span class="p">()</span>
</span></span><span class="line"><span class="cl"><span class="n">tmpComb</span> <span class="o">=</span> <span class="n">remaining_features</span><span class="o">.</span><span class="n">copy</span><span class="p">()</span>
</span></span><span class="line"><span class="cl"><span class="n">dropped_features_list</span><span class="o">=</span> <span class="p">[]</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="c1">## Initialize the list where we temporarily store data</span>
</span></span><span class="line"><span class="cl"><span class="n">RSS_test_list</span><span class="p">,</span> <span class="n">R_squared_list</span> <span class="o">=</span> <span class="p">[],</span> <span class="p">[]</span>
</span></span><span class="line"><span class="cl"><span class="n">numb_features</span><span class="p">,</span> <span class="n">features_list</span> <span class="o">=</span> <span class="p">[],</span> <span class="p">[]</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="c1"># Loop over the number of variables</span>
</span></span><span class="line"><span class="cl"><span class="k">for</span> <span class="n">k</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">variables</span><span class="p">),</span><span class="mi">0</span><span class="p">,</span><span class="o">-</span><span class="mi">1</span><span class="p">):</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">    <span class="c1"># Compute the stats we need</span>
</span></span><span class="line"><span class="cl">    <span class="n">Zscores</span><span class="p">,</span> <span class="n">minZ</span><span class="p">,</span> <span class="n">idx_minZ</span> <span class="o">=</span> <span class="n">Zscore</span><span class="p">(</span><span class="n">X_train</span><span class="p">[</span><span class="n">tmpComb</span><span class="p">],</span><span class="n">Y_train</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">    <span class="n">_</span><span class="p">,</span> <span class="n">RSS_test</span><span class="p">,</span> <span class="n">R_squared</span> <span class="o">=</span> <span class="n">LinReg</span><span class="p">(</span><span class="n">X_train</span><span class="p">[</span><span class="n">tmpComb</span><span class="p">],</span> <span class="n">Y_train</span><span class="p">,</span> <span class="n">X_test</span><span class="p">[</span><span class="n">tmpComb</span><span class="p">],</span> <span class="n">Y_test</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">  
</span></span><span class="line"><span class="cl">    <span class="c1"># Save stats</span>
</span></span><span class="line"><span class="cl">    <span class="n">RSS_test_list</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">RSS_test</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">    <span class="n">R_squared_list</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">best_R_squared</span><span class="o">.</span><span class="n">copy</span><span class="p">())</span>
</span></span><span class="line"><span class="cl">    
</span></span><span class="line"><span class="cl">    <span class="c1"># Print some information, before upgrading the features</span>
</span></span><span class="line"><span class="cl">    <span class="k">if</span> <span class="n">flag</span> <span class="o">==</span> <span class="mi">1</span><span class="p">:</span>
</span></span><span class="line"><span class="cl">        <span class="n">features</span> <span class="o">=</span> <span class="p">[</span><span class="n">remaining_features</span><span class="p">,</span><span class="n">dropped_features_list</span><span class="p">]</span>
</span></span><span class="line"><span class="cl">        <span class="n">params</span> <span class="o">=</span> <span class="p">[</span><span class="n">RSS_test</span><span class="p">,</span><span class="n">R_squared_list</span><span class="p">,</span><span class="n">tmpComb</span><span class="p">]</span>
</span></span><span class="line"><span class="cl">        <span class="k">if</span> <span class="n">dropped_list</span><span class="p">:</span> <span class="c1"># only if dropped_feature is not an empty list</span>
</span></span><span class="line"><span class="cl">            <span class="n">dropped_feature</span> <span class="o">=</span> <span class="n">dropped_list</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
</span></span><span class="line"><span class="cl">            <span class="n">results</span> <span class="o">=</span> <span class="p">[</span><span class="n">idx_minZ</span><span class="p">,</span><span class="n">RSS_test</span><span class="p">]</span>
</span></span><span class="line"><span class="cl">        <span class="k">else</span><span class="p">:</span>
</span></span><span class="line"><span class="cl">            <span class="n">results</span> <span class="o">=</span> <span class="p">[</span><span class="n">RSS_test</span><span class="p">,[]]</span>
</span></span><span class="line"><span class="cl">            
</span></span><span class="line"><span class="cl">        <span class="n">get_info_backwardS_Zscore</span><span class="p">(</span><span class="n">k</span><span class="p">,</span><span class="n">features</span><span class="p">,</span><span class="n">params</span><span class="p">,</span><span class="n">results</span><span class="p">,</span><span class="n">detailed</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">        
</span></span><span class="line"><span class="cl">    <span class="c1"># Save features and number of features</span>
</span></span><span class="line"><span class="cl">    <span class="n">numb_features</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">k</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">    <span class="n">features_list</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">tmpComb</span><span class="o">.</span><span class="n">copy</span><span class="p">())</span>
</span></span><span class="line"><span class="cl">    
</span></span><span class="line"><span class="cl">    <span class="c1"># update combinations</span>
</span></span><span class="line"><span class="cl">    <span class="n">tmpComb</span><span class="o">.</span><span class="n">remove</span><span class="p">(</span><span class="n">idx_minZ</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">    <span class="n">dropped_list</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="nb">set</span><span class="p">(</span><span class="n">remaining_features</span><span class="p">)</span><span class="o">-</span><span class="nb">set</span><span class="p">(</span><span class="n">tmpComb</span><span class="p">))</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">    <span class="c1"># Updating variables for next loop</span>
</span></span><span class="line"><span class="cl">    <span class="k">if</span> <span class="n">dropped_list</span><span class="p">:</span> <span class="c1"># only if dropped_feature is not an empty list</span>
</span></span><span class="line"><span class="cl">        <span class="n">dropped_feature</span> <span class="o">=</span> <span class="n">dropped_list</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
</span></span><span class="line"><span class="cl">        <span class="n">remaining_features</span><span class="o">.</span><span class="n">remove</span><span class="p">(</span><span class="n">dropped_feature</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">        <span class="n">dropped_features_list</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">dropped_feature</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">    <span class="k">else</span><span class="p">:</span>
</span></span><span class="line"><span class="cl">        <span class="n">dropped_features_list</span><span class="o">.</span><span class="n">append</span><span class="p">([])</span> <span class="c1"># at the initial iteration we drop nothing!</span>
</span></span><span class="line"><span class="cl"> 
</span></span><span class="line"><span class="cl">       
</span></span><span class="line"><span class="cl"><span class="c1"># Store in DataFrame</span>
</span></span><span class="line"><span class="cl"><span class="n">df_BackwardS_minZ</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">({</span><span class="s1">&#39;numb_features&#39;</span><span class="p">:</span> <span class="n">numb_features</span><span class="p">,</span>\
</span></span><span class="line"><span class="cl">                             <span class="s1">&#39;RSS_test&#39;</span> <span class="p">:</span> <span class="n">RSS_test_list</span><span class="p">,</span>\
</span></span><span class="line"><span class="cl">                             <span class="s1">&#39;R_squared&#39;</span><span class="p">:</span> <span class="n">R_squared_list</span><span class="p">,</span>\
</span></span><span class="line"><span class="cl">                             <span class="s1">&#39;dropped_feature&#39;</span><span class="p">:</span> <span class="n">dropped_features_list</span><span class="p">,</span>\
</span></span><span class="line"><span class="cl">                             <span class="s1">&#39;features&#39;</span><span class="p">:</span> <span class="n">features_list</span><span class="p">})</span>
</span></span></code></pre></div><pre><code>==========================================================================================
Iter n.0:

At the beginning we have:
Remaining features: ['lcavol', 'lweight', 'age', 'lbph', 'svi', 'lcp', 'gleason', 'pgg45']
Dropped features: []


The Z-scores are:
 lcavol     5.366290
lweight    2.750789
age       -1.395909
lbph       2.055846
svi        2.469255
lcp       -1.866913
gleason   -0.146681
pgg45      1.737840
dtype: float64


At the end we have:
min RSS: 15.638220165228002
We drop: gleason
==========================================================================================

==========================================================================================
Iter n.1:

At the beginning we have:
Remaining features: ['lcavol', 'lweight', 'age', 'lbph', 'svi', 'lcp', 'pgg45']
Dropped features: ['gleason']


The Z-scores are:
 lcavol     5.462426
lweight    2.833132
age       -1.486490
lbph       2.068796
svi        2.519204
lcp       -1.877253
pgg45      2.182013
dtype: float64


At the end we have:
min RSS: 15.495404626758
We drop: age
==========================================================================================

==========================================================================================
Iter n.2:

At the beginning we have:
Remaining features: ['lcavol', 'lweight', 'lbph', 'svi', 'lcp', 'pgg45']
Dropped features: ['gleason', 'age']


The Z-scores are:
 lcavol     5.243670
lweight    2.589758
lbph       1.815545
svi        2.544601
lcp       -1.733570
pgg45      1.871654
dtype: float64


At the end we have:
min RSS: 16.457800398803407
We drop: lcp
==========================================================================================

==========================================================================================
Iter n.3:

At the beginning we have:
Remaining features: ['lcavol', 'lweight', 'lbph', 'svi', 'pgg45']
Dropped features: ['gleason', 'age', 'lcp']


The Z-scores are:
 lcavol     4.899985
lweight    2.551974
lbph       1.952740
svi        2.039752
pgg45      1.190849
dtype: float64


At the end we have:
min RSS: 14.577726321419373
We drop: pgg45
==========================================================================================

==========================================================================================
Iter n.4:

At the beginning we have:
Remaining features: ['lcavol', 'lweight', 'lbph', 'svi']
Dropped features: ['gleason', 'age', 'lcp', 'pgg45']


The Z-scores are:
 lcavol     5.461353
lweight    2.441316
lbph       1.988469
svi        2.458931
dtype: float64


At the end we have:
min RSS: 13.689963661204882
We drop: lbph
==========================================================================================

==========================================================================================
Iter n.5:

At the beginning we have:
Remaining features: ['lcavol', 'lweight', 'svi']
Dropped features: ['gleason', 'age', 'lcp', 'pgg45', 'lbph']


The Z-scores are:
 lcavol     5.507417
lweight    3.655671
svi        1.985388
dtype: float64


At the end we have:
min RSS: 12.015924403078804
We drop: svi
==========================================================================================

==========================================================================================
Iter n.6:

At the beginning we have:
Remaining features: ['lcavol', 'lweight']
Dropped features: ['gleason', 'age', 'lcp', 'pgg45', 'lbph', 'svi']


The Z-scores are:
 lcavol     7.938277
lweight    3.582135
dtype: float64


At the end we have:
min RSS: 14.77447043041511
We drop: lweight
==========================================================================================

==========================================================================================
Iter n.7:

At the beginning we have:
Remaining features: ['lcavol']
Dropped features: ['gleason', 'age', 'lcp', 'pgg45', 'lbph', 'svi', 'lweight']


The Z-scores are:
 lcavol    8.691694
dtype: float64


At the end we have:
min RSS: 14.392161587304827
We drop: lcavol
==========================================================================================
</code></pre>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-python" data-lang="python"><span class="line"><span class="cl"><span class="n">df_BackwardS_minZ</span>
</span></span></code></pre></div><div style="width:100%;overflow:scroll;">
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }
<pre><code>.dataframe tbody tr th {
    vertical-align: top;
}

.dataframe thead th {
    text-align: right;
}
</code></pre>
<p></style></p>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th style='text-align:center; vertical-align:middle'></th>
      <th style='text-align:center; vertical-align:middle'>numb_features</th>
      <th style='text-align:center; vertical-align:middle'>RSS_test</th>
      <th style='text-align:center; vertical-align:middle'>R_squared</th>
      <th style='text-align:center; vertical-align:middle'>dropped_feature</th>
      <th style='text-align:center; vertical-align:middle'>features</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th style='text-align:center; vertical-align:middle'>0</th>
      <td style='text-align:center; vertical-align:middle'>8</td>
      <td style='text-align:center; vertical-align:middle'>15.638220</td>
      <td style='text-align:center; vertical-align:middle'>0.537516</td>
      <td style='text-align:center; vertical-align:middle'>gleason</td>
      <td style='text-align:center; vertical-align:middle'>[lcavol, lweight, age, lbph, svi, lcp, gleason...</td>
    </tr>
    <tr>
      <th style='text-align:center; vertical-align:middle'>1</th>
      <td style='text-align:center; vertical-align:middle'>7</td>
      <td style='text-align:center; vertical-align:middle'>15.495405</td>
      <td style='text-align:center; vertical-align:middle'>0.537516</td>
      <td style='text-align:center; vertical-align:middle'>age</td>
      <td style='text-align:center; vertical-align:middle'>[lcavol, lweight, age, lbph, svi, lcp, pgg45]</td>
    </tr>
    <tr>
      <th style='text-align:center; vertical-align:middle'>2</th>
      <td style='text-align:center; vertical-align:middle'>6</td>
      <td style='text-align:center; vertical-align:middle'>16.457800</td>
      <td style='text-align:center; vertical-align:middle'>0.537516</td>
      <td style='text-align:center; vertical-align:middle'>lcp</td>
      <td style='text-align:center; vertical-align:middle'>[lcavol, lweight, lbph, svi, lcp, pgg45]</td>
    </tr>
    <tr>
      <th style='text-align:center; vertical-align:middle'>3</th>
      <td style='text-align:center; vertical-align:middle'>5</td>
      <td style='text-align:center; vertical-align:middle'>14.577726</td>
      <td style='text-align:center; vertical-align:middle'>0.537516</td>
      <td style='text-align:center; vertical-align:middle'>pgg45</td>
      <td style='text-align:center; vertical-align:middle'>[lcavol, lweight, lbph, svi, pgg45]</td>
    </tr>
    <tr>
      <th style='text-align:center; vertical-align:middle'>4</th>
      <td style='text-align:center; vertical-align:middle'>4</td>
      <td style='text-align:center; vertical-align:middle'>13.689964</td>
      <td style='text-align:center; vertical-align:middle'>0.537516</td>
      <td style='text-align:center; vertical-align:middle'>lbph</td>
      <td style='text-align:center; vertical-align:middle'>[lcavol, lweight, lbph, svi]</td>
    </tr>
    <tr>
      <th style='text-align:center; vertical-align:middle'>5</th>
      <td style='text-align:center; vertical-align:middle'>3</td>
      <td style='text-align:center; vertical-align:middle'>12.015924</td>
      <td style='text-align:center; vertical-align:middle'>0.537516</td>
      <td style='text-align:center; vertical-align:middle'>svi</td>
      <td style='text-align:center; vertical-align:middle'>[lcavol, lweight, svi]</td>
    </tr>
    <tr>
      <th style='text-align:center; vertical-align:middle'>6</th>
      <td style='text-align:center; vertical-align:middle'>2</td>
      <td style='text-align:center; vertical-align:middle'>14.774470</td>
      <td style='text-align:center; vertical-align:middle'>0.537516</td>
      <td style='text-align:center; vertical-align:middle'>lweight</td>
      <td style='text-align:center; vertical-align:middle'>[lcavol, lweight]</td>
    </tr>
    <tr>
      <th style='text-align:center; vertical-align:middle'>7</th>
      <td style='text-align:center; vertical-align:middle'>1</td>
      <td style='text-align:center; vertical-align:middle'>14.392162</td>
      <td style='text-align:center; vertical-align:middle'>0.537516</td>
      <td style='text-align:center; vertical-align:middle'>lcavol</td>
      <td style='text-align:center; vertical-align:middle'>[lcavol]</td>
    </tr>
  </tbody>
</table>
</div>
<h4>12. Generate a chart having</h4>
<pre><code>    * x-axis: the subset size
    * y-axis: the RSS for the test set of the models generated at step 11
* Compare it with the chart generated at point 10.
</code></pre>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-python" data-lang="python"><span class="line"><span class="cl"><span class="c1"># Initialize the figure</span>
</span></span><span class="line"><span class="cl"><span class="n">width</span> <span class="o">=</span> <span class="mi">6</span>
</span></span><span class="line"><span class="cl"><span class="n">height</span> <span class="o">=</span> <span class="mi">6</span>
</span></span><span class="line"><span class="cl"><span class="n">nfig</span> <span class="o">=</span> <span class="mi">1</span>
</span></span><span class="line"><span class="cl"><span class="n">fig</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">figure</span><span class="p">(</span><span class="n">figsize</span> <span class="o">=</span> <span class="p">(</span><span class="n">width</span><span class="o">*</span><span class="n">nfig</span><span class="p">,</span><span class="n">height</span><span class="p">))</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="c1"># 1. RSS Test set plot</span>
</span></span><span class="line"><span class="cl"><span class="n">tmp_df</span> <span class="o">=</span> <span class="n">df_BackwardS_minZ</span><span class="p">;</span>
</span></span><span class="line"><span class="cl"><span class="n">ax</span> <span class="o">=</span> <span class="n">fig</span><span class="o">.</span><span class="n">add_subplot</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="n">nfig</span><span class="p">,</span> <span class="mi">1</span><span class="p">)</span>
</span></span><span class="line"><span class="cl"><span class="n">ax</span><span class="o">.</span><span class="n">scatter</span><span class="p">(</span><span class="n">tmp_df</span><span class="o">.</span><span class="n">numb_features</span><span class="p">,</span><span class="n">tmp_df</span><span class="o">.</span><span class="n">RSS_test</span><span class="p">,</span> <span class="n">alpha</span> <span class="o">=</span> <span class="mf">.2</span><span class="p">,</span> <span class="n">color</span> <span class="o">=</span> <span class="s1">&#39;darkblue&#39;</span><span class="p">);</span>
</span></span><span class="line"><span class="cl">    
</span></span><span class="line"><span class="cl"><span class="n">ax</span><span class="o">.</span><span class="n">set_xlabel</span><span class="p">(</span><span class="s1">&#39;Subset Size k&#39;</span><span class="p">,</span><span class="n">fontsize</span><span class="o">=</span><span class="mi">14</span><span class="p">);</span>
</span></span><span class="line"><span class="cl"><span class="n">ax</span><span class="o">.</span><span class="n">set_ylabel</span><span class="p">(</span><span class="s1">&#39;RSS&#39;</span><span class="p">,</span><span class="n">fontsize</span><span class="o">=</span><span class="mi">14</span><span class="p">);</span>
</span></span><span class="line"><span class="cl"><span class="n">ax</span><span class="o">.</span><span class="n">set_title</span><span class="p">(</span><span class="s1">&#39;RSS on test set&#39;</span><span class="p">,</span><span class="n">fontsize</span><span class="o">=</span><span class="mi">18</span><span class="p">);</span>
</span></span><span class="line"><span class="cl"><span class="n">ax</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">tmp_df</span><span class="o">.</span><span class="n">numb_features</span><span class="p">,</span><span class="n">tmp_df</span><span class="o">.</span><span class="n">RSS_test</span><span class="p">,</span><span class="n">color</span> <span class="o">=</span> <span class="s1">&#39;r&#39;</span><span class="p">,</span> <span class="n">label</span> <span class="o">=</span> <span class="s1">&#39;Best subset&#39;</span><span class="p">);</span> <span class="c1"># line of best values</span>
</span></span><span class="line"><span class="cl"><span class="n">ax</span><span class="o">.</span><span class="n">grid</span><span class="p">(</span><span class="n">color</span><span class="o">=</span><span class="s1">&#39;grey&#39;</span><span class="p">,</span> <span class="n">linestyle</span><span class="o">=</span><span class="s1">&#39;-&#39;</span><span class="p">,</span> <span class="n">linewidth</span><span class="o">=</span><span class="mf">0.5</span><span class="p">);</span>
</span></span><span class="line"><span class="cl"><span class="n">ax</span><span class="o">.</span><span class="n">legend</span><span class="p">();</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="n">fig</span><span class="o">.</span><span class="n">suptitle</span><span class="p">(</span><span class="s1">&#39;Backward Subset Selection&#39;</span><span class="p">,</span><span class="n">fontsize</span><span class="o">=</span><span class="mi">25</span><span class="p">,</span> <span class="n">y</span><span class="o">=</span><span class="mf">0.98</span><span class="p">);</span>
</span></span><span class="line"><span class="cl"><span class="n">fig</span><span class="o">.</span><span class="n">subplots_adjust</span><span class="p">(</span><span class="n">top</span><span class="o">=</span><span class="mf">0.85</span><span class="p">)</span>
</span></span><span class="line"><span class="cl"><span class="n">plt</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>
</span></span></code></pre></div><p>






  
  
<figure><img src="/posts/sl-ex3-subsetselection/output_55_0.png" alt="png" class="mx-auto my-0 rounded-md" />
</figure>
</p>
<h3 id="comparison-with-z-score" class="relative group"><strong>Comparison with Z-score</strong> <span class="absolute top-0 w-6 transition-opacity opacity-0 -start-6 not-prose group-hover:opacity-100"><a class="group-hover:text-primary-300 dark:group-hover:text-neutral-700" style="text-decoration-line: none !important;" href="#comparison-with-z-score" aria-label="Anchor">#</a></span></h3><p>Now compare the results by choosing the best model not by minimizing RSS but maximizing Zscore.</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-python" data-lang="python"><span class="line"><span class="cl"><span class="n">df_range</span> <span class="o">=</span> <span class="p">[</span><span class="n">df_BestS_RSS_test</span><span class="p">,</span> <span class="n">df_ForwardS</span><span class="p">,</span> <span class="n">df_BackwardS</span><span class="p">,</span> <span class="n">df_BackwardS_minZ</span><span class="p">]</span>
</span></span><span class="line"><span class="cl"><span class="n">columns_range</span> <span class="o">=</span> <span class="p">[</span><span class="s1">&#39;RSS_test&#39;</span><span class="p">,</span><span class="s1">&#39;min_RSS_test&#39;</span><span class="p">,</span><span class="s1">&#39;min_RSS_test&#39;</span><span class="p">,</span><span class="s1">&#39;RSS_test&#39;</span><span class="p">]</span>
</span></span><span class="line"><span class="cl"><span class="n">methods</span> <span class="o">=</span> <span class="p">[</span><span class="s1">&#39;Best Selection - RSS test&#39;</span><span class="p">,</span> <span class="s1">&#39;Forward Selection - RSS test&#39;</span><span class="p">,</span> <span class="s1">&#39;Backward Selection - RSS test&#39;</span><span class="p">,</span> <span class="s1">&#39;Backward Selection - Z score&#39;</span><span class="p">]</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="k">for</span> <span class="n">df</span><span class="p">,</span> <span class="n">col</span><span class="p">,</span> <span class="n">meth</span> <span class="ow">in</span> <span class="nb">zip</span><span class="p">(</span><span class="n">df_range</span><span class="p">,</span><span class="n">columns_range</span><span class="p">,</span><span class="n">methods</span><span class="p">):</span>
</span></span><span class="line"><span class="cl">    
</span></span><span class="line"><span class="cl">    <span class="n">idx</span> <span class="o">=</span> <span class="n">df</span><span class="p">[</span><span class="n">col</span><span class="p">]</span><span class="o">.</span><span class="n">idxmin</span><span class="p">()</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">    <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&#34;</span><span class="se">\n</span><span class="s2">For </span><span class="si">{</span><span class="n">meth</span><span class="si">}</span><span class="s2">, the best method has:</span><span class="se">\n\
</span></span></span><span class="line"><span class="cl"><span class="se"></span><span class="s2">n. features: </span><span class="si">{</span><span class="n">df</span><span class="p">[</span><span class="s1">&#39;numb_features&#39;</span><span class="p">][</span><span class="n">idx</span><span class="p">]</span><span class="si">}</span><span class="se">\n\
</span></span></span><span class="line"><span class="cl"><span class="se"></span><span class="s2">features: </span><span class="si">{</span><span class="n">df</span><span class="p">[</span><span class="s1">&#39;features&#39;</span><span class="p">][</span><span class="n">idx</span><span class="p">]</span><span class="si">}</span><span class="se">\n\
</span></span></span><span class="line"><span class="cl"><span class="se"></span><span class="s2">RSS test: </span><span class="si">{</span><span class="n">df</span><span class="p">[</span><span class="n">col</span><span class="p">][</span><span class="n">idx</span><span class="p">]</span><span class="si">}</span><span class="se">\n</span><span class="s2">&#34;</span><span class="p">)</span>
</span></span></code></pre></div><pre><code>For Best Selection - RSS test, the best method has:
n. features: 3
features: ('lcavol', 'svi', 'gleason')
RSS test: 11.484037587414818


For Forward Selection - RSS test, the best method has:
n. features: 3
features: ['lcavol', 'svi', 'gleason']
RSS test: 11.484037587414818


For Backward Selection - RSS test, the best method has:
n. features: 3
features: ['lcavol', 'svi', 'gleason']
RSS test: 11.484037587414818


For Backward Selection - Z score, the best method has:
n. features: 3
features: ['lcavol', 'lweight', 'svi']
RSS test: 12.015924403078804
</code></pre>

      </div>
    </section>
    <footer class="max-w-prose pt-8 print:hidden">
      

      

      
  
    
    
    
    <div class="pt-8">
      <hr class="border-dotted border-neutral-300 dark:border-neutral-600" />
      <div class="flex justify-between pt-3">
        <span>
          
            <a class="group flex" href="http://localhost:1313/posts/some-exercise-about-statistical-learning/sl-ex2-prostatecancer/">
              <span
                class="me-2 text-neutral-700 transition-transform group-hover:-translate-x-[2px] group-hover:text-primary-600 dark:text-neutral dark:group-hover:text-primary-400"
                ><span class="ltr:inline rtl:hidden">&larr;</span
                ><span class="ltr:hidden rtl:inline">&rarr;</span></span
              >
              <span class="flex flex-col">
                <span
                  class="mt-[0.1rem] leading-6 group-hover:underline group-hover:decoration-primary-500"
                  >SL2: Analysis of Prostate Cancer dataset - linear regression model</span
                >
                <span class="mt-[0.1rem] text-xs text-neutral-500 dark:text-neutral-400">
                  
                </span>
              </span>
            </a>
          
        </span>
        <span>
          
            <a class="group flex text-right" href="http://localhost:1313/posts/some-exercise-about-statistical-learning/sl-ex4-prostate-shrinkage/">
              <span class="flex flex-col">
                <span
                  class="mt-[0.1rem] leading-6 group-hover:underline group-hover:decoration-primary-500"
                  >SL4: Analysis of Prostate Cancer dataset – shrinkage methods</span
                >
                <span class="mt-[0.1rem] text-xs text-neutral-500 dark:text-neutral-400">
                  
                </span>
              </span>
              <span
                class="ms-2 text-neutral-700 transition-transform group-hover:-translate-x-[-2px] group-hover:text-primary-600 dark:text-neutral dark:group-hover:text-primary-400"
                ><span class="ltr:inline rtl:hidden">&rarr;</span
                ><span class="ltr:hidden rtl:inline">&larr;</span></span
              >
            </a>
          
        </span>
      </div>
    </div>
  


      
    </footer>
  </article>

      </main>
      
        <div
          class="pointer-events-none absolute bottom-0 end-0 top-[100vh] w-12"
          id="to-top"
          hidden="true"
        >
          <a
            href="#the-top"
            class="pointer-events-auto sticky top-[calc(100vh-5.5rem)] flex h-12 w-12 items-center justify-center rounded-full bg-neutral/50 text-xl text-neutral-700 backdrop-blur hover:text-primary-600 dark:bg-neutral-800/50 dark:text-neutral dark:hover:text-primary-400"
            aria-label="Scroll to top"
            title="Scroll to top"
          >
            &uarr;
          </a>
        </div>
      <footer class="py-10 print:hidden">
  
  
  <div class="flex items-center justify-between">
    <div>
      
      
        <p class="text-sm text-neutral-500 dark:text-neutral-400">
            © 2025 Andrea Mortaro
        </p>
      
      
      
        <p class="text-xs text-neutral-500 dark:text-neutral-400">
          
          
          Powered by <a class="hover:underline hover:decoration-primary-400 hover:text-primary-500"
            href="https://gohugo.io/" target="_blank" rel="noopener noreferrer">Hugo</a> &amp; <a class="hover:underline hover:decoration-primary-400 hover:text-primary-500" href="https://github.com/jpanther/congo" target="_blank" rel="noopener noreferrer">Congo</a>
        </p>
      
    </div>
    <div class="flex flex-row items-center">
      
      
      
      
        <div
          class="me-14 cursor-pointer text-sm text-neutral-700 hover:text-primary-600 dark:text-neutral dark:hover:text-primary-400"
        >
          <button id="appearance-switcher-0" type="button" aria-label="appearance switcher">
            <div
              class="flex h-12 w-12 items-center justify-center dark:hidden"
              title="Switch to dark appearance"
            >
              <span class="icon relative inline-block px-1 align-text-bottom"><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 512 512"><path fill="currentColor" d="M32 256c0-123.8 100.3-224 223.8-224c11.36 0 29.7 1.668 40.9 3.746c9.616 1.777 11.75 14.63 3.279 19.44C245 86.5 211.2 144.6 211.2 207.8c0 109.7 99.71 193 208.3 172.3c9.561-1.805 16.28 9.324 10.11 16.95C387.9 448.6 324.8 480 255.8 480C132.1 480 32 379.6 32 256z"/></svg>
</span>
            </div>
            <div
              class="hidden h-12 w-12 items-center justify-center dark:flex"
              title="Switch to light appearance"
            >
              <span class="icon relative inline-block px-1 align-text-bottom"><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 512 512"><path fill="currentColor" d="M256 159.1c-53.02 0-95.1 42.98-95.1 95.1S202.1 351.1 256 351.1s95.1-42.98 95.1-95.1S309 159.1 256 159.1zM509.3 347L446.1 255.1l63.15-91.01c6.332-9.125 1.104-21.74-9.826-23.72l-109-19.7l-19.7-109c-1.975-10.93-14.59-16.16-23.72-9.824L256 65.89L164.1 2.736c-9.125-6.332-21.74-1.107-23.72 9.824L121.6 121.6L12.56 141.3C1.633 143.2-3.596 155.9 2.736 164.1L65.89 256l-63.15 91.01c-6.332 9.125-1.105 21.74 9.824 23.72l109 19.7l19.7 109c1.975 10.93 14.59 16.16 23.72 9.824L256 446.1l91.01 63.15c9.127 6.334 21.75 1.107 23.72-9.822l19.7-109l109-19.7C510.4 368.8 515.6 356.1 509.3 347zM256 383.1c-70.69 0-127.1-57.31-127.1-127.1c0-70.69 57.31-127.1 127.1-127.1s127.1 57.3 127.1 127.1C383.1 326.7 326.7 383.1 256 383.1z"/></svg>
</span>
            </div>
          </button>
        </div>
      
    </div>
  </div>
  
  
</footer>
<div
  id="search-wrapper"
  class="invisible fixed inset-0 z-50 flex h-screen w-screen cursor-default flex-col bg-neutral-500/50 p-4 backdrop-blur-sm dark:bg-neutral-900/50 sm:p-6 md:p-[10vh] lg:p-[12vh]"
  data-url="http://localhost:1313/"
>
  <div
    id="search-modal"
    class="top-20 mx-auto flex min-h-0 w-full max-w-3xl flex-col rounded-md border border-neutral-200 bg-neutral shadow-lg dark:border-neutral-700 dark:bg-neutral-800"
  >
    <header class="relative z-10 flex flex-none items-center justify-between px-2">
      <form class="flex min-w-0 flex-auto items-center">
        <div class="flex h-8 w-8 items-center justify-center text-neutral-400">
          <span class="icon relative inline-block px-1 align-text-bottom"><svg aria-hidden="true" focusable="false" data-prefix="fas" data-icon="search" class="svg-inline--fa fa-search fa-w-16" role="img" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 512 512"><path fill="currentColor" d="M505 442.7L405.3 343c-4.5-4.5-10.6-7-17-7H372c27.6-35.3 44-79.7 44-128C416 93.1 322.9 0 208 0S0 93.1 0 208s93.1 208 208 208c48.3 0 92.7-16.4 128-44v16.3c0 6.4 2.5 12.5 7 17l99.7 99.7c9.4 9.4 24.6 9.4 33.9 0l28.3-28.3c9.4-9.4 9.4-24.6.1-34zM208 336c-70.7 0-128-57.2-128-128 0-70.7 57.2-128 128-128 70.7 0 128 57.2 128 128 0 70.7-57.2 128-128 128z"/></svg>
</span>
        </div>
        <input
          type="search"
          id="search-query"
          class="mx-1 flex h-12 flex-auto appearance-none bg-transparent focus:outline-dotted focus:outline-2 focus:outline-transparent"
          placeholder="Search"
          tabindex="0"
        />
      </form>
      <button
        id="close-search-button"
        class="flex h-8 w-8 items-center justify-center text-neutral-700 hover:text-primary-600 dark:text-neutral dark:hover:text-primary-400"
        title="Close (Esc)"
      >
        <span class="icon relative inline-block px-1 align-text-bottom"><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 320 512"><path fill="currentColor" d="M310.6 361.4c12.5 12.5 12.5 32.75 0 45.25C304.4 412.9 296.2 416 288 416s-16.38-3.125-22.62-9.375L160 301.3L54.63 406.6C48.38 412.9 40.19 416 32 416S15.63 412.9 9.375 406.6c-12.5-12.5-12.5-32.75 0-45.25l105.4-105.4L9.375 150.6c-12.5-12.5-12.5-32.75 0-45.25s32.75-12.5 45.25 0L160 210.8l105.4-105.4c12.5-12.5 32.75-12.5 45.25 0s12.5 32.75 0 45.25l-105.4 105.4L310.6 361.4z"/></svg>
</span>
      </button>
    </header>
    <section class="flex-auto overflow-auto px-2">
      <ul id="search-results">
        
      </ul>
    </section>
  </div>
</div>

    </div>
  </body>
</html>
